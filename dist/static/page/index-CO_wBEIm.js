import{_ as a,a as e}from"./custom-form.vue_vue_type_script_setup_true_lang-BlN96ovS.js";/* empty css             *//* empty css                  *//* empty css                 */import"./el-tag-Dxm_Axr8.js";import{E as t,a as l}from"./el-select-Bf0uoiH2.js";import"./el-popper-ClYUeexH.js";import{d as r,x as s,c as o,a1 as i,ac as d,b as p,o as n,a3 as m,a9 as u,i as c,h as b,a4 as f,af as g,Z as v,X as w}from"./index-B5c3jFiu.js";import{C as h}from"./card-tabs-DNT8iyWf.js";import{A as y}from"./Api-99phi20S.js";import{E as j}from"./index-FXwX-Tc-.js";import{E as x}from"./index-CY3iw2TW.js";import{_}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./el-drawer-BeOw-O7q.js";import"./index-DguJ4OYc.js";import"./vnode-wHVxG6yF.js";import"./index-DwJjVrn6.js";import"./scroll-CGLW73hp.js";import"./index-EHUqHs3S.js";import"./el-overlay-DfJ2upq2.js";import"./el-form-item-ey1Wr8cE.js";import"./castArray-DrYRfuDR.js";import"./_Uint8Array-D9m7vkXT.js";import"./_initCloneObject-CUocRwYS.js";import"./custom-dialog-C2QYRSKW.js";import"./el-dialog-C9RVZp-L.js";import"./index-36sCsZ2B.js";import"./file-panel-w5NTE3Ff.js";/* empty css                   */import"./el-checkbox-WLPkjpqU.js";import"./isEqual-ClYigGjQ.js";import"./index-Ca4LNgmQ.js";/* empty css                          */function k(a,e,t){/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])(?:\s*,\s*(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9]))*$/.test(e)?t():t(new Error("请输入正确的IP地址"))}const I={class:"database-container"},V=_(r({__name:"index",setup(r){var _;const V=s({themeColor:{light:["#F7911C"],dark:["#EAB170"]},showTips:!0,tabs:{activeIndex:0,list:[{name:"MySQL",index:0,value:"mysql"},{name:"Redis",index:3,value:"redis"}],clickActive:a=>{V.tabs.activeIndex!==a.index&&(V.list.params={page:1,pageSize:10,type:"mysql"},V.tabs.activeIndex=a.index,V.list.params.type=a.value,V.form.data.value.type=a.value,V.list.loading=!1,V.list.total=0,V.list.data=[],d.router.push(`/database/${a.value}`))}},list:{loading:!0,data:[],total:0,params:{page:1,pageSize:10,type:"mysql"},columns:o((()=>{switch(V.list.params.type){case"mysql":return[{prop:"name",label:"数据库名"},{prop:"user",label:"用户名"},{prop:"password",label:"密码"},{prop:"capacity",label:"容量",placeholder:"未配置"},{prop:"p_addr",label:"数据库位置"},{prop:"action",label:"操作",align:"center"}];case"redis":return[{prop:"key",label:"键"},{prop:"type",label:"类型"},{prop:"length",label:"长度"},{prop:"expiration",label:"有效期"}];default:return[]}})),getData:async()=>{V.list.loading=!0;const a="redis"===V.list.params.type?y.getRedisList:y.getDatabaseList,{data:e}=await a(V.list.params);"redis"!==V.list.params.type&&e.data.forEach(((a,e)=>V.password.show[e]=!1)),V.list.loading=!1,V.list.total=e.total,V.list.data=e["redis"===V.list.params.type?"keys":"data"]}},password:{show:{},copy:async a=>{await navigator.clipboard.writeText(a),i.success("复制成功！")}},drawer:{show:!1,title:"添加数据库",type:"add",loading:!1,open:a=>{V.drawer.type=a,V.drawer.show=!0,V.drawer.title="添加数据库"},onClose:()=>{var a,e;null==(a=V.form.instance)||a.clearValidate(),null==(e=V.form.instance)||e.resetFields(),V.drawer.show=!1},onConfirm:()=>{var a;null==(a=V.form.instance)||a.validate((async a=>{a&&(V.drawer.loading=!0,await y.addDatabaseLib(V.form.data.value),V.drawer.loading=!1,i.success("添加成功！"),V.list.getData(),V.drawer.show=!1)}))}},form:{instance:null,data:{value:{encoding:"utf8",type:"mysql",password:"",auth:"all"},items:o((()=>"mysql"===V.list.params.type?[{label:"数据库名",prop:"name",type:"custom",rules:[{required:!0,message:"请输入数据库名",trigger:"blur"}]},{label:"用户名",prop:"root",type:"input",rules:[{required:!0,message:"请输入用户名",trigger:"blur"}]},{label:"密码",prop:"password",type:"custom",rules:[{required:!0,message:"请输入密码",trigger:"blur"}]},{label:"权限",prop:"auth",options:[{label:"所有人(%)",value:"all"},{label:"指定IP",value:"IP"}],type:"select",rules:[{required:!0,message:"请选择",trigger:"change"}]},{label:"        ",prop:"authIP",type:"custom",rules:[{validator:k,trigger:"blur"}]}]:[]))},handleRandomPassword:()=>{const a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let e="";for(let t=0;t<8;t++)e+=a.charAt(Math.floor(62*Math.random()));V.form.data.value.password=e}}}),P=null==(_=d.getRouterPath().match(new RegExp("(?<=\\/database\\/)\\w*")))?void 0:_[0];return V.tabs.activeIndex=V.tabs.list.find((a=>a.value===P)).index,V.list.params.type=P,(r,s)=>{const o=u,i=l,d=t,y=j,_=x,k=a,P=e;return n(),p("div",I,[m(h,{list:V.tabs.list,"active-index":V.tabs.activeIndex,"click-active":V.tabs.clickActive},null,8,["list","active-index","click-active"]),m(o,{conf:V},null,8,["conf"]),m(P,{visible:V.drawer.show,title:V.drawer.title,loading:V.drawer.loading,"on-close":V.drawer.onClose,"on-confirm":V.drawer.onConfirm},{default:c((()=>["add"===V.drawer.type?(n(),b(k,{key:0,data:V.form.data,"on-init":a=>V.form.instance=a},g({name:c((({row:a})=>[m(y,{modelValue:V.form.data.value.name,"onUpdate:modelValue":s[1]||(s[1]=a=>V.form.data.value.name=a),placeholder:a.placeholder},{append:c((()=>[m(d,{modelValue:V.form.data.value.encoding,"onUpdate:modelValue":s[0]||(s[0]=a=>V.form.data.value.encoding=a),style:{width:"120px"}},{default:c((()=>[m(i,{label:"utf8",value:"utf8"}),m(i,{label:"utf8mb4",value:"utf8mb4"}),m(i,{label:"gbk",value:"gbk"}),m(i,{label:"big5",value:"big5"})])),_:1},8,["modelValue"])])),_:2},1032,["modelValue","placeholder"])])),password:c((({row:a})=>[m(y,{modelValue:V.form.data.value.password,"onUpdate:modelValue":s[3]||(s[3]=a=>V.form.data.value.password=a),placeholder:a.placeholder,type:"password","show-password":""},{append:c((()=>[m(_,{onClick:s[2]||(s[2]=a=>V.form.handleRandomPassword())},{default:c((()=>s[5]||(s[5]=[v(" 随机密码 ")]))),_:1})])),_:2},1032,["modelValue","placeholder"])])),_:2},["IP"==V.form.data.value.auth?{name:"authIP",fn:c((({row:a})=>[m(y,{modelValue:V.form.data.value.authIP,"onUpdate:modelValue":s[4]||(s[4]=a=>V.form.data.value.authIP=a),placeholder:a.placeholder,type:"textarea"},null,8,["modelValue","placeholder"]),s[6]||(s[6]=w("span",{class:"auth-ip-tip"},"多个 ip 以逗号分隔，例：172.16.10.111,172.16.10.112",-1))])),key:"0"}:void 0]),1032,["data","on-init"])):f("",!0)])),_:1},8,["visible","title","loading","on-close","on-confirm"])])}}}),[["__scopeId","data-v-10c7eff5"]]);export{V as default};
