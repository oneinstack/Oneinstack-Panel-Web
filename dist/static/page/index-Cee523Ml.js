import{aZ as e,s as t,B as n,C as o,aS as s,E as a,_ as r,d as u,r as d,y as c,e as i,Q as l,V as f,G as v,z as p,p as m,R as E,h as b,o as y,bv as h,g as L}from"./index-BpgbG9_h.js";function w(e){return void 0===e}const T=e=>Array.from(e.querySelectorAll('a[href],button:not([disabled]),button:not([hidden]),:not([tabindex="-1"]),input:not([disabled]),input:not([type="hidden"]),select:not([disabled]),textarea:not([disabled])')).filter((e=>g(e)&&(e=>"fixed"!==getComputedStyle(e).position&&null!==e.offsetParent)(e))),g=e=>{if(e.tabIndex>0||0===e.tabIndex&&null!==e.getAttribute("tabIndex"))return!0;if(e.tabIndex<0||e.hasAttribute("disabled")||"true"===e.getAttribute("aria-disabled"))return!1;switch(e.nodeName){case"A":return!!e.href&&"ignore"!==e.rel;case"INPUT":return!("hidden"===e.type||"file"===e.type);case"BUTTON":case"SELECT":case"TEXTAREA":return!0;default:return!1}},A=function(e,t,...n){let o;o=t.includes("mouse")||t.includes("click")?"MouseEvents":t.includes("key")?"KeyboardEvent":"HTMLEvents";const s=document.createEvent(o);return s.initEvent(t,...n),e.dispatchEvent(s),e},x="focus-trap.focus-after-trapped",S="focus-trap.focus-after-released",k={cancelable:!0,bubbles:!1},R={cancelable:!0,bubbles:!1},I="focusAfterTrapped",N="focusAfterReleased",F=Symbol("elFocusTrap"),P=t(),K=t(0),_=t(0);let C=0;const O=e=>{const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0||e===document.activeElement?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t},B=(e,t)=>{for(const n of e)if(!j(n,t))return n},j=(e,t)=>{if("hidden"===getComputedStyle(e).visibility)return!0;for(;e;){if(t&&e===t)return!1;if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1},q=(t,n)=>{if(t&&t.focus){const o=document.activeElement;let s=!1;!e(t)||g(t)||t.getAttribute("tabindex")||(t.setAttribute("tabindex","-1"),s=!0),t.focus({preventScroll:!0}),_.value=window.performance.now(),t!==o&&(e=>e instanceof HTMLInputElement&&"select"in e)(t)&&n&&t.select(),e(t)&&s&&t.removeAttribute("tabindex")}};function M(e,t){const n=[...e],o=e.indexOf(t);return-1!==o&&n.splice(o,1),n}const U=(()=>{let e=[];return{push:t=>{const n=e[0];n&&t!==n&&n.pause(),e=M(e,t),e.unshift(t)},remove:t=>{var n,o;e=M(e,t),null==(o=null==(n=e[0])?void 0:n.resume)||o.call(n)}}})(),D=()=>{P.value="pointer",K.value=window.performance.now()},H=()=>{P.value="keyboard",K.value=window.performance.now()},$=e=>new CustomEvent("focus-trap.focusout-prevented",{...R,detail:e});let W=[];const z=e=>{e.code===a.esc&&W.forEach((t=>t(e)))};var G=r(u({name:"ElFocusTrap",inheritAttrs:!1,props:{loop:Boolean,trapped:Boolean,focusTrapEl:Object,focusStartEl:{type:[Object,String],default:"first"}},emits:[I,N,"focusin","focusout","focusout-prevented","release-requested"],setup(e,{emit:r}){const u=t();let d,m;const{focusReason:E}=(n((()=>{0===C&&(document.addEventListener("mousedown",D),document.addEventListener("touchstart",D),document.addEventListener("keydown",H)),C++})),o((()=>{C--,C<=0&&(document.removeEventListener("mousedown",D),document.removeEventListener("touchstart",D),document.removeEventListener("keydown",H))})),{focusReason:P,lastUserFocusTimestamp:K,lastAutomatedFocusTimestamp:_});var b;b=t=>{e.trapped&&!y.paused&&r("release-requested",t)},n((()=>{0===W.length&&document.addEventListener("keydown",z),s&&W.push(b)})),o((()=>{W=W.filter((e=>e!==b)),0===W.length&&s&&document.removeEventListener("keydown",z)}));const y={paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}},h=t=>{if(!e.loop&&!e.trapped)return;if(y.paused)return;const{code:n,altKey:o,ctrlKey:s,metaKey:u,currentTarget:d,shiftKey:c}=t,{loop:i}=e,l=n===a.tab&&!o&&!s&&!u,f=document.activeElement;if(l&&f){const e=d,[n,o]=(e=>{const t=O(e);return[B(t,e),B(t.reverse(),e)]})(e);if(n&&o)if(c||f!==o){if(c&&[n,e].includes(f)){const e=$({focusReason:E.value});r("focusout-prevented",e),e.defaultPrevented||(t.preventDefault(),i&&q(o,!0))}}else{const e=$({focusReason:E.value});r("focusout-prevented",e),e.defaultPrevented||(t.preventDefault(),i&&q(n,!0))}else if(f===e){const e=$({focusReason:E.value});r("focusout-prevented",e),e.defaultPrevented||t.preventDefault()}}};p(F,{focusTrapRef:u,onKeydown:h}),c((()=>e.focusTrapEl),(e=>{e&&(u.value=e)}),{immediate:!0}),c([u],(([e],[t])=>{e&&(e.addEventListener("keydown",h),e.addEventListener("focusin",T),e.addEventListener("focusout",g)),t&&(t.removeEventListener("keydown",h),t.removeEventListener("focusin",T),t.removeEventListener("focusout",g))}));const L=e=>{r(I,e)},w=e=>r(N,e),T=t=>{const n=i(u);if(!n)return;const o=t.target,s=t.relatedTarget,a=o&&n.contains(o);if(!e.trapped){s&&n.contains(s)||(d=s)}a&&r("focusin",t),y.paused||e.trapped&&(a?m=o:q(m,!0))},g=t=>{const n=i(u);if(!y.paused&&n)if(e.trapped){const o=t.relatedTarget;l(o)||n.contains(o)||setTimeout((()=>{if(!y.paused&&e.trapped){const e=$({focusReason:E.value});r("focusout-prevented",e),e.defaultPrevented||q(m,!0)}}),0)}else{const e=t.target;e&&n.contains(e)||r("focusout",t)}};async function A(){await f();const t=i(u);if(t){U.push(y);const n=t.contains(document.activeElement)?d:document.activeElement;d=n;if(!t.contains(n)){const o=new Event(x,k);t.addEventListener(x,L),t.dispatchEvent(o),o.defaultPrevented||f((()=>{let o=e.focusStartEl;v(o)||(q(o),document.activeElement!==o&&(o="first")),"first"===o&&((e,t=!1)=>{const n=document.activeElement;for(const o of e)if(q(o,t),document.activeElement!==n)return})(O(t),!0),document.activeElement!==n&&"container"!==o||q(t)}))}}}function R(){const e=i(u);if(e){e.removeEventListener(x,L);const t=new CustomEvent(S,{...k,detail:{focusReason:E.value}});e.addEventListener(S,w),e.dispatchEvent(t),t.defaultPrevented||"keyboard"!=E.value&&K.value>_.value&&!e.contains(document.activeElement)||q(null!=d?d:document.body),e.removeEventListener(S,w),U.remove(y)}}return n((()=>{e.trapped&&A(),c((()=>e.trapped),(e=>{e?A():R()}))})),o((()=>{e.trapped&&R(),u.value&&(u.value.removeEventListener("keydown",h),u.value.removeEventListener("focusin",T),u.value.removeEventListener("focusout",g),u.value=void 0)})),{onKeydown:h}}}),[["render",function(e,t,n,o,s,a){return d(e.$slots,"default",{handleKeydown:e.onKeydown})}],["__file","focus-trap.vue"]]);const Q=L(r(u({__name:"teleport",props:m({to:{type:E([String,Object]),required:!0},disabled:Boolean}),setup:e=>(e,t)=>e.disabled?d(e.$slots,"default",{key:0}):(y(),b(h,{key:1,to:e.to},[d(e.$slots,"default")],8,["to"]))}),[["__file","teleport.vue"]]));export{G as E,F,w as a,Q as b,q as c,g as i,T as o,A as t};
