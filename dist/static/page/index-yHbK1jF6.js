import{d as e,x as r,a1 as t,b as i,o as a,X as l,a3 as s,J as o,a5 as p,i as n,h as u,a4 as m,H as d,I as c}from"./index-BJjfPnyH.js";import v from"./file-list-DPZwTyKU.js";import{_ as b,a as f}from"./custom-form.vue_vue_type_script_setup_true_lang-CAzyHkDW.js";import{A as g}from"./Api-D-M6Obau.js";import{_ as j}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./file-panel-Df9AY8zl.js";/* empty css             *//* empty css                   */import"./el-checkbox-CrPCccUF.js";import"./index-DE8f9FJy.js";import"./isEqual-Ai17W6Q8.js";import"./_Uint8Array-Ik12j-RK.js";import"./el-select-Bwq_6nmq.js";import"./el-popper-B255Np42.js";import"./index-BQE0cEfW.js";import"./castArray-DWWiYOsI.js";import"./index-CXS_p1oq.js";import"./scroll-CPnK1sXk.js";import"./el-tag-yAT8BjOt.js";import"./index-cGrDTBC5.js";import"./el-form-item-CgmraheN.js";import"./_initCloneObject-MiKUVYQK.js";import"./el-alert-OHlBRi9t.js";/* empty css                  *//* empty css                        */import"./el-dropdown-Z3XfnFo5.js";import"./index-BRUeVUFU.js";import"./el-dialog-DILa8Wz7.js";import"./index-BWcw6JbV.js";import"./vnode-xBXC_NUn.js";import"./el-overlay-BTuoOT1q.js";import"./index-DLfiFkmB.js";import"./el-space-C9C_wg7T.js";/* empty css                 */import"./custom-dialog-BxqsFKc1.js";import"./custom-table-fi-8IKh4.js";import"./el-pagination-CJTBz1jJ.js";import"./el-table-column-DHRhYKSf.js";import"./el-tooltip-l0sNRNKZ.js";import"./el-drawer-DmnWQlXU.js";/* empty css                          */const h={class:"file-container relative"},w={class:"absolute fit-width",style:{"padding-bottom":"30px"}},P=j(e({__name:"index",setup(e){const j={owner:["0400","0200","0100"],group:["0040","0020","0010"],public:["0004","0002","0001"]},P=e=>{const r=[];for(let t=0;t<8;t++){const i=[];4&t&&i.push(e[0]),2&t&&i.push(e[1]),1&t&&i.push(e[2]),r.push(i)}return r},E=(e,r,t="0000")=>{let i=t.split("");const a=e.reduce(((e,t)=>e+parseInt(t[r])),0);return i[r]=a.toString(),i.join("")},y=r({theme:{light:["#626262"],dark:["#DBDBDB"]},tab:{list:[{path:["/"],active:!0,instance:null}],handleAddTab:()=>{if(y.tab.list.length>=10)return t.warning("最多只能打开10个文件夹");y.tab.list.push({path:["/"],active:!0,instance:null})},handleCloseTab:e=>{1!==y.tab.list.length&&(y.tab.list[e-1].active=!0,y.tab.list.splice(e,1))}},handleUpdatePath:(e,r)=>{y.tab.list.forEach(((e,t)=>e.active=t===r)),y.tab.list[r].path=e},drawer:{visible:!1,openType:"create",type:"file",title:"创建",open:(e,r,t)=>{switch(y.drawer.openType=e,e){case"create":y.drawer.title="创建";break;case"editPER":case"editUser":y.form.editPER.value.isDir=t.isDir,y.form.editPER.value.perm=t.permissions.padEnd(4,"0"),y.form.editPER.value.recursive=t.recursive,y.form.editPER.value.owner=P(j.owner)[t.permissions[1]],y.form.editPER.value.group=P(j.group)[t.permissions[2]],y.form.editPER.value.public=P(j.public)[t.permissions[3]],y.form.editPER.value.name=t.name,y.form.editUser.value.isDir=t.isDir,y.form.editUser.value.user=t.user,y.form.editUser.value.group=t.group,y.drawer.title="editPER"===e?"编辑权限":"修改用户和用户组"}y.drawer.type=r,y.drawer.visible=!0},close:()=>{var e,r;y.drawer.visible=!1,null==(e=y.form.instance)||e.resetFields(),null==(r=y.form.instance)||r.clearValidate()},confirm:()=>{var e;null==(e=y.form.instance)||e.validate((async e=>{var r;if(!e)return;const i=y.tab.list.find((e=>e.active)),a=null==i?void 0:i.path.join("/").replace(/\/\//g,"/");let l,s=g.createFile;switch(y.drawer.openType){case"create":s=g.createFile,l={path:`${"/"===a?"":a}/${y.form.create.value.name}`,type:y.drawer.type};break;case"editPER":case"editUser":s=g.updateFilePerm,l={path:`${"/"===a?"":a}/${y.form.editPER.value.name}`,perm:y.form.editPER.value.perm,user:y.form.editUser.value.user,group:y.form.editUser.value.group,recursive:y.form.editPER.value.recursive||y.form.editUser.value.recursive}}const{data:o}=await s(l);null==(r=null==i?void 0:i.instance)||r.refresh(),t.success(o),y.drawer.close()}))}},form:{instance:null,create:{value:{type:"file",name:""},items:[{label:"名称",type:"input",prop:"name",rules:[{required:!0,message:"请输入名称",trigger:"blur"}]}]},editPER:{value:{owner:[],group:[],public:[],perm:"",recursive:!1},items:[{label:"所有者",type:"checkbox-group",prop:"owner",options:[{label:"读取",value:"0400"},{label:"写入",value:"0200"},{label:"可执行",value:"0100"}],change:e=>{y.form.editPER.value.perm=E(e,1,y.form.editPER.value.perm)}},{label:"用户组",type:"checkbox-group",prop:"group",options:[{label:"读取",value:"0040"},{label:"写入",value:"0020"},{label:"可执行",value:"0010"}],change:e=>{y.form.editPER.value.perm=E(e,2,y.form.editPER.value.perm)}},{label:"公共",type:"checkbox-group",prop:"public",options:[{label:"读取",value:"0004"},{label:"写入",value:"0002"},{label:"可执行",value:"0001"}],change:e=>{y.form.editPER.value.perm=E(e,3,y.form.editPER.value.perm)}},{label:"权限",type:"input",prop:"perm",rules:[{required:!0,message:"请输入权限",trigger:"blur"},{pattern:/^[0-7]{4}$/,message:"权限错误",trigger:"blur"}],change:e=>{4===e.length&&(y.form.editPER.value.owner=P(j.owner)[+e[1]],y.form.editPER.value.group=P(j.group)[+e[2]],y.form.editPER.value.public=P(j.public)[+e[3]])}},{ifShow:e=>e.isDir,label:"同时修改子文件属性",type:"checkbox",prop:"recursive"}]},editUser:{value:{user:"",group:""},items:[{label:"用户",type:"input",prop:"user",rules:[{required:!0,message:"请输入用户",trigger:"blur"}]},{label:"用户组",type:"input",prop:"group",rules:[{required:!0,message:"请输入用户组",trigger:"blur"}]}]}}});return(e,r)=>(a(),i("div",h,[l("div",w,[(a(!0),i(o,null,p(y.tab.list,((e,r)=>d((a(),u(v,{ref_for:!0,ref:e=>e&&(y.tab.list[r].instance=e),key:r,"onUpdate:path":e=>y.handleUpdatePath(e,r),onOpenDrawer:y.drawer.open},null,8,["onUpdate:path","onOpenDrawer"])),[[c,y.tab.list[r].active]]))),128))]),s(f,{visible:y.drawer.visible,title:y.drawer.title,"on-close":y.drawer.close,"on-confirm":y.drawer.confirm},{default:n((()=>[y.drawer.visible?(a(),u(b,{key:0,data:y.form[y.drawer.openType],"on-init":e=>y.form.instance=e},null,8,["data","on-init"])):m("",!0)])),_:1},8,["visible","title","on-close","on-confirm"])]))}}),[["__scopeId","data-v-a4d7514e"]]);export{P as default};
