/* empty css             */import{E as e}from"./el-dialog-C9RVZp-L.js";import"./el-overlay-DfJ2upq2.js";/* empty css                  */import{E as l,a}from"./el-form-item-ey1Wr8cE.js";import{E as r,a as t}from"./el-radio-D8A1MTN9.js";/* empty css                 */import"./el-tag-Dxm_Axr8.js";import{E as o,a as i}from"./el-select-Bf0uoiH2.js";import"./el-popper-ClYUeexH.js";import{A as d}from"./Api-99phi20S.js";import{E as s}from"./index-CY3iw2TW.js";import{E as u}from"./index-FXwX-Tc-.js";import{d as p,s as m,y as n,h as c,o as v,i as f,X as g,a3 as y,Z as j,a4 as _,$ as b,a1 as V}from"./index-B5c3jFiu.js";import{_ as h}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./index-DguJ4OYc.js";import"./vnode-wHVxG6yF.js";import"./index-DwJjVrn6.js";import"./scroll-CGLW73hp.js";import"./index-EHUqHs3S.js";import"./index-36sCsZ2B.js";import"./castArray-DrYRfuDR.js";import"./_Uint8Array-D9m7vkXT.js";import"./_initCloneObject-CUocRwYS.js";import"./isEqual-ClYigGjQ.js";const x={class:"firewall-dialog-header"},w={class:"firewall-dialog-header-title"},q={class:"firewall-dialog-header-title-text"},E={style:{flex:"auto"}},k=h(p({__name:"addfirewall",props:{type:{type:Boolean,default:!0},formData:{type:Object,default:()=>({})}},emits:["close"],setup(p,{emit:h}){const k=m(!1),U=m("rtl");m("Option 1");const I=m({id:"",direction:"in",protocol:"tcp",ips:"",ports:"",state:1,remark:"",strategy:"allow"}),P=m(),F=m({protocol:[{required:!0,message:"请选择协议类型",trigger:"change"}],ports:[{required:!0,message:"请输入端口",trigger:"blur"},{validator:(e,l,a)=>{!l||/^(\d+(-\d+)?)(,\d+(-\d+)?)*$/.test(l)?a():a(new Error("端口格式不正确"))},trigger:"blur"}],ips:[{validator:(e,l,a)=>{if("true"===I.value.ips){if(!C.value)return void a(new Error("请输入IP地址"));if(!/^((\d{1,3}\.){3}\d{1,3}(\/\d{1,2})?|(\d{1,3}\.){3}\d{1,3}-(\d{1,3}\.){3}\d{1,3})(,((\d{1,3}\.){3}\d{1,3}(\/\d{1,2})?|(\d{1,3}\.){3}\d{1,3}-(\d{1,3}\.){3}\d{1,3}))*$/.test(C.value))return void a(new Error("IP地址格式不正确"));const e=C.value.split(",");for(const l of e)if(l.includes("-")){const[e,r]=l.split("-"),t=e.split(".").map(Number),o=r.split(".").map(Number);for(let l=0;l<4;l++)if(t[l]>o[l])return void a(new Error("IP范围格式不正确,起始IP不能大于结束IP"))}}a()},trigger:"blur"}],strategy:[{required:!0,message:"请选择策略类型",trigger:"change"}],direction:[{required:!0,message:"请选择规则方向",trigger:"change"}],state:[{required:!0,message:"请选择状态",trigger:"change"}]}),C=m("");m(!0),m([]),m([]);const R=()=>{k.value=!1,A("close",!1)},$=p;n((()=>$.formData),(e=>{!$.type&&e&&(I.value={...I.value,...e},e.ips?(I.value.ips="true",C.value=e.ips):(I.value.ips="",C.value=""))}),{immediate:!0}),n((()=>$.type),(e=>{e&&(I.value.state=1)}),{immediate:!0});const A=h;function O(){P.value&&P.value.validate((async e=>{if(e)try{const{id:e,direction:l,protocol:a,ports:r,state:t,remark:o,strategy:i}=I.value,s={direction:l,protocol:a,ports:r,state:t,remark:o,strategy:i,id:$.type?void 0:e,ips:"true"===I.value.ips?C.value:""};let u;if($.type){const{data:e}=await d.addFirewallRule(s);u=e}else{const{data:e}=await d.updateFirewallRule(s);u=e}u?(V.success($.type?"添加成功":"修改成功"),k.value=!1,A("close",!1)):V.error(u.message||($.type?"添加失败":"修改失败"))}catch(l){V.error("操作失败")}}))}return(d,p)=>{const m=i,n=o,V=a,h=u,A=t,B=r,D=l,N=s,X=e;return v(),c(X,{modelValue:k.value,"onUpdate:modelValue":p[9]||(p[9]=e=>k.value=e),width:"560px",direction:U.value,"show-close":!0,onClose:R,style:{"padding-top":"0"}},{header:f((()=>[g("div",x,[g("div",w,[g("span",q,b($.type?"添加防火墙":"更新防火墙"),1)])])])),default:f((()=>[y(D,{style:{padding:"0 20px"},ref_key:"ruleFormRef",ref:P,model:I.value,rules:F.value,class:"demo-ruleForm","status-icon":""},{default:f((()=>[y(V,{label:"协议",prop:"protocol",required:!0},{default:f((()=>[y(n,{modelValue:I.value.protocol,"onUpdate:modelValue":p[0]||(p[0]=e=>I.value.protocol=e),placeholder:"请选择协议类型"},{default:f((()=>[y(m,{label:"tcp",value:"tcp"}),y(m,{label:"udp",value:"udp"}),y(m,{label:"icmp",value:"icmp"})])),_:1},8,["modelValue"])])),_:1}),y(V,{label:"端口",prop:"ports",required:!0},{default:f((()=>[y(h,{modelValue:I.value.ports,"onUpdate:modelValue":p[1]||(p[1]=e=>I.value.ports=e),placeholder:"支持多个端口，如:80,88"},null,8,["modelValue"])])),_:1}),y(V,{label:"来源",prop:"ips",required:"true"===I.value.ips},{default:f((()=>[y(B,{modelValue:I.value.ips,"onUpdate:modelValue":p[2]||(p[2]=e=>I.value.ips=e),onChange:p[3]||(p[3]=e=>{var l;return null==(l=d.$refs.ruleFormRef)?void 0:l.validateField("ips")})},{default:f((()=>[y(A,{value:""},{default:f((()=>p[10]||(p[10]=[j("全部IP")]))),_:1}),y(A,{value:"true"},{default:f((()=>p[11]||(p[11]=[j("部分IP")]))),_:1})])),_:1},8,["modelValue"]),"true"===I.value.ips?(v(),c(h,{key:0,modelValue:C.value,"onUpdate:modelValue":p[4]||(p[4]=e=>C.value=e),placeholder:"支持多个IP地址，如：192.168.1.1,192.168.1.0/24",onBlur:p[5]||(p[5]=e=>{var l;return null==(l=d.$refs.ruleFormRef)?void 0:l.validateField("ips")})},null,8,["modelValue"])):_("",!0)])),_:1},8,["required"]),y(V,{label:"策略",prop:"strategy",required:!0},{default:f((()=>[y(n,{modelValue:I.value.strategy,"onUpdate:modelValue":p[6]||(p[6]=e=>I.value.strategy=e),placeholder:"请选择策略类型"},{default:f((()=>[y(m,{label:"放行",value:"allow"}),y(m,{label:"禁止",value:"deny"})])),_:1},8,["modelValue"])])),_:1}),y(V,{label:"方向",prop:"direction",required:!0},{default:f((()=>[y(n,{modelValue:I.value.direction,"onUpdate:modelValue":p[7]||(p[7]=e=>I.value.direction=e),placeholder:"请选择规则方向"},{default:f((()=>[y(m,{label:"入站",value:"in"}),y(m,{label:"出站",value:"out"})])),_:1},8,["modelValue"])])),_:1}),y(V,{label:"备注",prop:"remark"},{default:f((()=>[y(h,{modelValue:I.value.remark,"onUpdate:modelValue":p[8]||(p[8]=e=>I.value.remark=e),placeholder:"可为空"},null,8,["modelValue"])])),_:1}),p[12]||(p[12]=g("div",{class:"textbox"},[g("div",{class:"tagbox"},"* "),j(" 支持添加多个端口,如:80,88 ")],-1))])),_:1},8,["model","rules"])])),footer:f((()=>[g("div",E,[y(N,{onClick:R},{default:f((()=>p[13]||(p[13]=[j("取消")]))),_:1}),y(N,{type:"primary",onClick:O},{default:f((()=>p[14]||(p[14]=[j("确定")]))),_:1})])])),_:1},8,["modelValue","direction"])}}}),[["__scopeId","data-v-5e7c2c64"]]);export{k as default};
