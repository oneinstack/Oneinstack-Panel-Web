/* empty css             */import{E as e,a}from"./el-table-column-CmDaQHVS.js";import"./el-checkbox-DBaZw9db.js";import"./el-tooltip-l0sNRNKZ.js";import"./el-popper-DuiXp9eT.js";import"./el-tag-hrDeqNMc.js";import{E as t,a as l}from"./el-select-DASP7Wfd.js";import{E as n}from"./el-card-DtTnWWCT.js";import{S as r}from"./search-input-CXxzY4aR.js";import{E as i}from"./el-space-DYaOROx8.js";import{E as o}from"./el-button-CghqIf1m.js";import{d as s,s as c,x as d,B as p,b as u,o as m,X as f,a3 as y,i as g,Z as h,aM as b,e as _,aG as k,ae as v,F as w,ck as x,cl as j,$ as S,h as C,a1 as T,ab as $}from"./index-BpgbG9_h.js";import{A as P}from"./Api-DIELJlCh.js";import B from"./add-task-BKrI-px4.js";import{E as z}from"./index-DDnEUui0.js";import{_ as V}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./index-vgTml2Xy.js";import"./_Uint8Array-CjQH01s2.js";import"./_initCloneObject-Dm3var8j.js";import"./isEqual-DSpmu0jQ.js";import"./index-Cee523Ml.js";import"./castArray-rxr1KqzA.js";import"./index-B5k-8-YQ.js";import"./scroll-BAvMHt_N.js";/* empty css                 */import"./vnode-CjD2MH5P.js";import"./el-drawer-_L3C1oIg.js";import"./index-E4qH6n_1.js";import"./el-overlay-ghEGIsKl.js";import"./el-form-item-CGp8wt0Y.js";import"./validator-ByUU-WJ0.js";import"./index-BLMo0UPX.js";function E(e){if(!e)return"";const a=e.split(","),t=[];return a.forEach((e=>{const a=e.split(" ");if(5!==a.length)return void t.push(`无效的 cron 表达式: ${e}`);const[l,n,r,i,o]=a;let s="";if("*"===i)s+="每月";else{if(!/^\d+$/.test(i))return void t.push(`无效的月份部分: ${i}`);s+=`每年 ${i} 月`}if("*"===r)"*"===o&&(s+="每日");else{if(!/^\d+$/.test(r))return void t.push(`无效的日期部分: ${r}`);s+=` ${r} 日`}if("*"!==o&&/^\d+$/.test(o)){s+=` 每周 ${["周日","周一","周二","周三","周四","周五","周六"][parseInt(o)]}`}if("*"===n&&"*"===l)s+=" 整时整分";else if("*"===n)s+=` 每分钟的第 ${l} 分`;else if("*"===l)s+=` 每小时的第 ${n} 时`;else{if(!/^\d+$/.test(n)||!/^\d+$/.test(l))return void t.push(`无效的时间部分: ${n}:${l}`);s+=` ${n}:${String(l).padStart(2,"0")}分`}t.push(s.trim())})),t.join("<br>")}const M={class:"container"},A={class:"card-box"},F={class:"",style:{display:"flex"}},U={class:"demo-form-inline flex",style:{"margin-left":"auto"}},D={class:"box2"},H={style:{display:"flex","flex-direction":"row","align-items":"center",cursor:"pointer"}},L=["onClick"],q=["onClick"],I={style:{display:"flex","flex-direction":"row","align-items":"center",cursor:"pointer"}},O=["innerHTML"],X={style:{display:"flex","flex-direction":"row","align-items":"center",cursor:"pointer"}},Y={colspan:"6"},Z={class:"table-pagination"},G=V(s({__name:"scheduled",setup(s){const V=c(),G=c([]),N=d({currentPage:1,pageSize:10,total:0}),Q=()=>{V.value&&V.value.clearSelection()};let R=c("");const J=c([]),K=async()=>{G.value=[];try{const{data:e}=await P.getPlanTaskList({page:N.currentPage,pageSize:N.pageSize,q:R.value});e?(J.value=e.data||[],N.total=e.total||0):T.error((null==e?void 0:e.message)||"获取数据失败")}catch(e){T.error("获取数据失败"),J.value=[],N.total=0}};c(["传统项目","swoole异步项目","thinkphp异步项目","异步项目","一键部署","批量创建"]),d({user:"",region:"",date:""});const W=()=>{N.pageSize=10,N.currentPage=1,R.value="",K()};c(),d({name:"Hello",region:"",count:"",desc:""});let ee=c(!0),ae=c({name:"",cron_type:"",schedule:"",created_at:"",deleted_at:"",id:"",command:"",enabled:!0,updated_at:""});c("");const te=e=>{if(!e)return"";const a=new Date(e);return`${a.getFullYear()}年${String(a.getMonth()+1).padStart(2,"0")}月${String(a.getDate()).padStart(2,"0")}日 ${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}:${String(a.getSeconds()).padStart(2,"0")}`},le=c(!1),ne=()=>{ee.value=!0,le.value=!0,ae.value={name:"",cron_type:"",schedule:"",created_at:"",deleted_at:"",id:"",command:"",enabled:!0,updated_at:""}},re=e=>{K()},ie=e=>{G.value=e},oe=async()=>{0!==G.value.length?z.confirm("确定要删除选中的任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=G.value.map((e=>e.id));try{await P.deletePlanTask({ids:e}),T.success("删除成功"),K()}catch(a){T.error("删除失败")}})).catch((()=>{T.info("取消删除")})):T.warning("请选择要删除的任务")},se=async()=>{const e=G.value.filter((e=>!0===e.enabled));0!==e.length?z.confirm("确定要禁止选中的任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const a=e.map((e=>e.id));try{await P.disablePlanTask({ids:a}),T.success("禁止成功"),K(),Q()}catch(t){T.error("禁止失败")}})).catch((()=>{T.info("取消禁止")})):T.warning("请选择运行中的任务进行禁止")},ce=async()=>{const e=G.value.filter((e=>!1===e.enabled));0!==e.length?z.confirm("确定要开启选中的任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const a=e.map((e=>e.id));try{await P.enablePlanTask({ids:a}),T.success("开启成功"),K(),Q()}catch(t){T.error("开启失败")}})).catch((()=>{T.info("取消开启")})):T.warning("请选择已停用的任务进行开启")},de=async e=>{!1!==e.enabled?z.confirm("确定要禁用该任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{try{await P.disablePlanTask({ids:[e.id]}),T.success("禁用成功"),K()}catch(a){T.error("禁用失败")}})).catch((()=>{T.info("取消禁用")})):T.warning("该任务已停用，无需再次禁用")},pe=async e=>{!0!==e.enabled?z.confirm("确定要开启该任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{try{await P.enablePlanTask({ids:[e.id]}),T.success("开启成功"),K()}catch(a){T.error("开启失败")}})).catch((()=>{T.info("取消开启")})):T.warning("该任务正在运行，无需再次开启")},ue=e=>!0,me=()=>{N.currentPage>1&&(N.currentPage--,K())},fe=()=>{const e=Math.ceil(N.total/N.pageSize);N.currentPage<e&&(N.currentPage++,K())},ye=e=>{N.pageSize=e,N.currentPage=1,K()};return p((()=>{K()})),(s,c)=>{const d=o,p=i,G=r,ge=n,he=e,be=w,_e=l,ke=t,ve=a;return m(),u("div",M,[f("div",A,[y(ge,null,{default:g((()=>[f("div",F,[y(p,{class:"btn-group"},{default:g((()=>[y(d,{type:"primary",onClick:ne},{default:g((()=>c[4]||(c[4]=[h("添加任务")]))),_:1}),y(d,{type:"primary",onClick:ce},{default:g((()=>c[5]||(c[5]=[h("启动任务")]))),_:1}),y(d,{type:"primary",onClick:se},{default:g((()=>c[6]||(c[6]=[h("停止任务")]))),_:1}),y(d,{type:"primary",onClick:oe},{default:g((()=>c[7]||(c[7]=[h("删除任务")]))),_:1})])),_:1}),f("div",U,[y(G,{placeholder:"请输入域名或备注",style:{"margin-right":"18px"},modelValue:_(R),"onUpdate:modelValue":c[0]||(c[0]=e=>b(R)?R.value=e:R=e),onSearch:c[1]||(c[1]=e=>K())},null,8,["modelValue"]),y(d,{icon:_(k),type:"primary",onClick:W,style:{"margin-left":"auto"}},null,8,["icon"])])])])),_:1})]),f("div",D,[y(ve,{ref_key:"tableRef",ref:V,"header-cell-style":{"border-right":"1px solid #8B8B8B30","text-align":"center"},class:"fileTable",data:J.value,border:"",style:{width:"100%"},onSelectionChange:ie,"select-on-indeterminate":!1,"row-selectable":ue,"row-key":e=>e.id,"empty-text":"暂无数据"},{footer:g((()=>[f("tr",null,[f("td",Y,[f("div",Z,[y(ke,{modelValue:N.pageSize,"onUpdate:modelValue":c[2]||(c[2]=e=>N.pageSize=e),onChange:ye},{default:g((()=>[y(_e,{label:"10",value:"10"}),y(_e,{label:"20",value:"20"}),y(_e,{label:"50",value:"50"})])),_:1},8,["modelValue"]),c[17]||(c[17]=f("span",null,"条/页",-1)),y(d,{onClick:me,disabled:1===N.currentPage},{default:g((()=>c[15]||(c[15]=[h("上一页")]))),_:1},8,["disabled"]),f("span",null,S(N.currentPage)+" / "+S(Math.ceil(N.total/N.pageSize)),1),y(d,{onClick:fe,disabled:N.currentPage===Math.ceil(N.total/N.pageSize)},{default:g((()=>c[16]||(c[16]=[h("下一页")]))),_:1},8,["disabled"]),f("span",null,"共 "+S(N.total)+" 条记录",1)])])])])),default:g((()=>[y(he,{type:"selection",width:"55","reserve-selection":!0,selectable:ue}),y(he,{prop:"name",label:"任务名称",width:"180"}),y(he,{prop:"enabled",label:"状态",width:"180"},{default:g((e=>[f("div",H,[e.row.enabled?(m(),u("a",{key:0,style:{color:"#64ffc9","text-decoration":"underline",display:"flex"},class:"abox",onClick:a=>de(e.row)},[c[8]||(c[8]=h(" 运行中 ")),y(be,null,{default:g((()=>[y(_(x))])),_:1})],8,L)):e.row.enabled?v("",!0):(m(),u("a",{key:1,style:{color:"#FF4848","text-decoration":"underline"},class:"abox",onClick:a=>pe(e.row)},[y(be,null,{default:g((()=>[y(_(j))])),_:1}),c[9]||(c[9]=h(" 已停用 "))],8,q))])])),_:1}),y(he,{prop:"address",label:"执行周期"},{default:g((e=>[f("div",I,[f("span",{innerHTML:_(E)(e.row.schedule)},null,8,O)])])),_:1}),y(he,{prop:"updated_at",label:"上次执行时间"},{default:g((e=>[f("div",X,[f("span",null,S(te(e.row.updated_at)),1)])])),_:1}),y(he,{prop:"address",label:"操作"},{default:g((e=>[e.row.enabled?v("",!0):(m(),C(d,{key:0,link:"",type:"primary",size:"small",onClick:a=>pe(e.row)},{default:g((()=>c[10]||(c[10]=[h(" 开启 ")]))),_:2},1032,["onClick"])),e.row.enabled?(m(),C(d,{key:1,link:"",type:"primary",size:"small",onClick:a=>de(e.row)},{default:g((()=>c[11]||(c[11]=[h(" 禁用 ")]))),_:2},1032,["onClick"])):v("",!0),y(d,{link:"",type:"primary",size:"small",onClick:a=>(async e=>{z.confirm("确定要删除该任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{try{await P.deletePlanTask({ids:[e.id]}),T.success("删除成功"),K(),Q()}catch(a){T.error("删除失败")}})).catch((()=>{T.info("取消删除")}))})(e.row)},{default:g((()=>c[12]||(c[12]=[h(" 删除 ")]))),_:2},1032,["onClick"]),y(d,{link:"",type:"primary",size:"small",onClick:a=>(async e=>{ee.value=!1,le.value=!0,ae.value={name:e.name,cron_type:e.cron_type,schedule:e.schedule,created_at:e.created_at,deleted_at:e.deleted_at,id:e.id,command:e.command,enabled:e.enabled,updated_at:e.updated_at}})(e.row)},{default:g((()=>c[13]||(c[13]=[h(" 更新 ")]))),_:2},1032,["onClick"]),y(d,{link:"",type:"primary",size:"small",onClick:a=>(async e=>{$.router.push("/task/log");let{data:a}=await P.getPlanTaskLog({id:e.id})})(e.row)},{default:g((()=>c[14]||(c[14]=[h(" 查看日志 ")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","row-key"])]),y(B,{modelValue:le.value,"onUpdate:modelValue":c[3]||(c[3]=e=>le.value=e),type:_(ee),onTaskAdded:re,formData:_(ae)},null,8,["modelValue","type","formData"])])}}}),[["__scopeId","data-v-596edf47"]]);export{G as default};
