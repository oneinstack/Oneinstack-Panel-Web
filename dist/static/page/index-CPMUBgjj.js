import{_ as e}from"./custom-dialog-BxqsFKc1.js";/* empty css             */import{E as a}from"./el-alert-OHlBRi9t.js";import{_ as t,a as i}from"./custom-form.vue_vue_type_script_setup_true_lang-CAzyHkDW.js";/* empty css                 */import"./el-tag-yAT8BjOt.js";import{E as l,a as r}from"./el-select-Bwq_6nmq.js";import"./el-popper-B255Np42.js";import{E as o}from"./el-space-C9C_wg7T.js";/* empty css                  */import{S as s}from"./search-input-B9rjs1AQ.js";import{d as n,x as p,c as d,a1 as m,al as c,b as u,o as g,a3 as b,X as w,a4 as h,n as f,i as y,Z as v,e as x,aG as j,F as _,cm as k,h as C}from"./index-BJjfPnyH.js";import{C as D}from"./card-tabs-D8iTYIaD.js";import{C as A}from"./custom-table-fi-8IKh4.js";import{A as V}from"./Api-D-M6Obau.js";import{d as I}from"./dayjs.min-BUzY7owL.js";import{E as z}from"./index-BRUeVUFU.js";import{E as F}from"./index-CXS_p1oq.js";import{_ as S}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./el-dialog-DILa8Wz7.js";import"./index-BWcw6JbV.js";import"./vnode-xBXC_NUn.js";import"./index-DE8f9FJy.js";import"./scroll-CPnK1sXk.js";import"./index-BQE0cEfW.js";import"./el-overlay-BTuoOT1q.js";import"./index-DLfiFkmB.js";import"./el-drawer-DmnWQlXU.js";import"./el-form-item-CgmraheN.js";import"./castArray-DWWiYOsI.js";import"./_Uint8Array-Ik12j-RK.js";import"./_initCloneObject-MiKUVYQK.js";import"./file-panel-Df9AY8zl.js";/* empty css                   */import"./el-checkbox-CrPCccUF.js";import"./isEqual-Ai17W6Q8.js";import"./index-cGrDTBC5.js";/* empty css                          */import"./el-pagination-CJTBz1jJ.js";import"./el-table-column-DHRhYKSf.js";import"./el-tooltip-l0sNRNKZ.js";const W={class:"website-container"},U={class:"main-content"},Z={class:"tool-bar"},E={class:"demo-form-inline"},P={class:"box2"},Y={key:0,class:"mask-tip"},q=S(n({__name:"index",setup(n){const S=p({tabs:{activeIndex:0,list:[{name:"PHP项目",index:0,value:"php"},{name:"反向代理",index:5,value:"proxy"}],clickActive:e=>{S.website.getWebsiteInfo(),S.tabs.activeIndex=e.index,S.website.params.type=e.value,S.website.getData()}},website:{data:[],total:0,selection:[],columns:[{prop:"name",label:"网站名",width:200},{prop:"domain",label:"其他域名",width:250},{prop:"dir",label:"目录",width:200},{prop:"type",label:"类型",width:200},{prop:"remark",label:"备注",width:200},{prop:"create_time",label:"创建时间",width:200,formatter:e=>e.create_time?I(e.create_time).format("YYYY-MM-DD HH:mm:ss"):"-"},{prop:"action",label:"操作"}],handleSelectionChange:e=>{S.website.selection=e},params:{type:"php",page:1,pageSize:10},loading:!0,getData:async()=>{S.website.loading=!0;const{data:e}=await V.getWebsiteList(S.website.params);S.website.loading=!1,S.website.total=e.total,S.website.data=e.data},handleAdd:()=>{S.drawer.open("add"),S.form.data.value.type=S.website.params.type},websiteInfo:!1,getWebsiteInfo:async()=>{try{const{data:e}=await V.getWebsiteInfo();return S.website.websiteInfo=e,e}catch(e){return m.error("获取网站信息失败"),null}}},drawer:{show:!1,title:"创建网站",type:"add",loading:!1,open:(e,a)=>{var t;if(S.drawer.title="创建网站",S.drawer.type=e,"edit"===e){S.drawer.title="设置网站";const e=structuredClone(c(a)),i=null==(t=e.domain)?void 0:t.split(",");S.form.data.value=e,S.form.data.value.hostDomain=i[0].trim(),i.shift(),S.form.data.value.otherDomain=i.join("\n")}S.drawer.show=!0},onConfirm:()=>{var e;null==(e=S.form.instance)||e.validate((async e=>{if(e)try{S.drawer.loading=!0;const e="add"===S.drawer.type?V.addWebsite:V.updateWebsite,{data:a}=await e(S.form.data.value);m({type:"success",message:"add"===S.drawer.type?"创建网站成功":"更新网站成功"}),S.drawer.show=!1,S.website.getData()}catch(a){}finally{S.drawer.loading=!1}}))},onClose:()=>{var e,a;S.form.data.value={},null==(e=S.form.instance)||e.resetFields(),null==(a=S.form.instance)||a.clearValidate(),S.drawer.show=!1}},form:{instance:null,data:{value:{},items:d((()=>{switch(S.website.params.type){case"php":case"static":return[{label:"主域名",type:"input",placeholder:"支持域名:端口",prop:"name",rules:[{required:!0,message:"请输入主域名",trigger:"blur"},{pattern:/^(([a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}|((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))(:\d{1,5})?$/,message:"域名格式错误",trigger:"blur"}],change:e=>{if(!e)return;const a=e.split(":")[0];S.form.data.value.dir=`/${a}`}},{label:"其他域名",type:"textarea",placeholder:'一行一个域名，支持*和IP地址，支持"域名:端口"',prop:"domain"},{label:"目录",type:"input",prop:"dir",rules:[{required:!0,message:"请选择根目录",trigger:"blur"}]},{label:"备注",type:"textarea",prop:"remark"}];case"proxy":return S.form.data.value.pact="http",S.form.data.value.tar_url="$http_host",[{label:"主域名",type:"input",placeholder:"支持域名:端口",prop:"name",rules:[{required:!0,message:"请输入主域名",trigger:"blur"},{pattern:/^([0-9a-zA-Z-]{1,}\.)+([a-zA-Z]{2,})$/,message:"域名格式错误",trigger:"blur"}]},{label:"其他域名",type:"textarea",placeholder:'一行一个域名，支持*和IP地址，支持"域名:端口"',prop:"domain"},{label:"代理地址",type:"custom",placeholder:"例：127.0.0.1:8080",prop:"send_url",rules:[{required:!0,message:"请输入代理地址",trigger:"blur"}]},{label:"备注",type:"textarea",prop:"remark"}];default:return[]}}))}},dialog:{show:!1,title:"网站删除确认",type:"delete",row:{},open:(e,a)=>{if(S.dialog.type=e,S.dialog.row=a,"delete"===e)S.dialog.title="网站删除确认";S.dialog.show=!0},close:()=>{S.dialog.show=!1},confirm:async()=>{await V.delWebsite({id:S.dialog.row.id}),S.website.getData(),S.dialog.show=!1}}}),q=()=>{S.website.websiteInfo=!0,m({type:"warning",message:"功能开发中..."})};return S.website.getData(),(n,p)=>{const d=z,m=o,c=_,V=r,I=l,$=F,H=t,N=i,L=a,M=e;return g(),u("div",W,[b(D,{list:S.tabs.list,"active-index":S.tabs.activeIndex,"click-active":S.tabs.clickActive},null,8,["list","active-index","click-active"]),w("div",U,[w("div",{class:f({"blur-mask":!S.website.websiteInfo})},[w("div",Z,[b(m,{class:"btn-group",size:14},{default:y((()=>[b(d,{type:"primary",onClick:S.website.handleAdd},{default:y((()=>p[7]||(p[7]=[v("添加站点")]))),_:1},8,["onClick"])])),_:1}),w("div",E,[b(m,{class:"btn-group",size:14},{default:y((()=>[b(s,{modelValue:S.website.params.name,"onUpdate:modelValue":p[0]||(p[0]=e=>S.website.params.name=e),placeholder:"请输入域名",style:{"margin-right":"18px"},onSearch:p[1]||(p[1]=e=>S.website.getData())},null,8,["modelValue"]),b(d,{icon:x(j),type:"primary",onClick:p[2]||(p[2]=e=>S.website.getData())},null,8,["icon"])])),_:1})])]),w("div",P,[b(A,{page:S.website.params.page,"onUpdate:page":[p[3]||(p[3]=e=>S.website.params.page=e),S.website.getData],loading:S.website.loading,"empty-text":"暂无数据",data:S.website.data,columns:S.website.columns,"auto-pagination":!1,total:S.website.total,"page-size":S.website.params.pageSize,selection:!0,onSelectionChange:S.website.handleSelectionChange},{action:y((({row:e})=>[b(d,{type:"primary",link:"",style:{"margin-right":"8px"}},{default:y((()=>p[8]||(p[8]=[v("统计")]))),_:1}),p[12]||(p[12]=w("span",{style:{"border-right":"1px solid #D9D9D9",height:"12px","margin-right":"8px"}},null,-1)),b(d,{type:"primary",link:"",style:{"margin-right":"8px"}},{default:y((()=>p[9]||(p[9]=[v("WAF")]))),_:1}),p[13]||(p[13]=w("span",{style:{"border-right":"1px solid #D9D9D9",height:"12px","margin-right":"8px"}},null,-1)),b(d,{type:"primary",link:"",style:{"margin-right":"8px"},onClick:a=>S.dialog.open("delete",e)},{default:y((()=>p[10]||(p[10]=[v("设置")]))),_:2},1032,["onClick"]),p[14]||(p[14]=w("span",{style:{"border-right":"1px solid #D9D9D9",height:"12px","margin-right":"8px"}},null,-1)),b(d,{type:"danger",link:"",style:{color:"#FF4D4F","--el-button-hover-text-color":"#D9363E","--el-button-disabled-text-color":"#FFCCC7"},onClick:a=>S.dialog.open("delete",e)},{default:y((()=>p[11]||(p[11]=[v(" 删除 ")]))),_:2},1032,["onClick"])])),_:1},8,["page","loading","data","columns","total","page-size","onSelectionChange","onUpdate:page"])])],2)]),S.website.websiteInfo?h("",!0):(g(),u("div",Y,[p[16]||(p[16]=w("img",{src:"/static/page/ins-Plugin-BHYTFVLQ.png",alt:"",class:"tip-image"},null,-1)),p[17]||(p[17]=w("div",{class:"tip-text"},[v(" 未安装运行环境，请点击下方按钮"),w("span",{class:"highlight"},"安装Nginx"),v("否则无法使用改页面 ")],-1)),b(d,{type:"primary",class:"install-btn",onClick:q},{default:y((()=>[p[15]||(p[15]=v(" 安装Nginx ")),b(c,{class:"el-icon--right"},{default:y((()=>[b(x(k))])),_:1})])),_:1})])),b(N,{visible:S.drawer.show,title:S.drawer.title,"empty-text":"暂无数据",loading:S.drawer.loading,"on-close":S.drawer.onClose,"on-confirm":S.drawer.onConfirm},{default:y((()=>[S.drawer.show?(g(),C(H,{key:0,data:S.form.data,"on-init":e=>S.form.instance=e},{send_url:y((({row:e})=>[b($,{modelValue:S.form.data.value.send_url,"onUpdate:modelValue":p[5]||(p[5]=e=>S.form.data.value.send_url=e),placeholder:e.placeholder},{prepend:y((()=>[b(I,{modelValue:S.form.data.value.pact,"onUpdate:modelValue":p[4]||(p[4]=e=>S.form.data.value.pact=e),style:{width:"80px"}},{default:y((()=>[b(V,{label:"http",value:"http://"}),b(V,{label:"https",value:"https://"})])),_:1},8,["modelValue"])])),_:2},1032,["modelValue","placeholder"])])),_:1},8,["data","on-init"])):h("",!0)])),_:1},8,["visible","title","loading","on-close","on-confirm"]),b(M,{modelValue:S.dialog.show,"onUpdate:modelValue":p[6]||(p[6]=e=>S.dialog.show=e),title:S.dialog.title},{footer:y((()=>[b(d,{onClick:S.dialog.close},{default:y((()=>p[18]||(p[18]=[v("取消")]))),_:1},8,["onClick"]),b(d,{type:"primary",onClick:S.dialog.confirm},{default:y((()=>p[19]||(p[19]=[v("确认")]))),_:1},8,["onClick"])])),default:y((()=>["delete"===S.dialog.type?(g(),C(L,{key:0,title:"确定删除所选网站？",type:"warning","show-icon":"",closable:!1})):h("",!0)])),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-74485ccb"]]);export{q as default};
