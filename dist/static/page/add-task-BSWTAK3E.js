/* empty css             */import{E as e}from"./el-drawer-BeOw-O7q.js";import"./el-overlay-DfJ2upq2.js";import{E as a,a as l}from"./el-form-item-ey1Wr8cE.js";/* empty css                  *//* empty css                 */import"./el-tag-Dxm_Axr8.js";import{E as t,a as n}from"./el-select-Bf0uoiH2.js";import"./el-popper-ClYUeexH.js";import{A as u}from"./Api-99phi20S.js";import{at as o,aI as r,Q as s,p as i,br as d,_ as m,d as p,ao as c,a as y,s as v,x as f,c as h,bc as b,y as V,B as x,aR as g,b as _,o as k,H as w,a4 as N,a3 as I,e as U,av as $,n as j,r as M,i as C,h as E,t as T,cj as A,F as S,c7 as F,ca as B,af as H,ad as D,G as O,w as K,X as P,$ as q,J as z,a5 as L,ay as R,Z as Y,a1 as G}from"./index-B5c3jFiu.js";import{E as W,i as X}from"./index-FXwX-Tc-.js";import{U as Z,I as J,C as Q,a as ee,g as ae,h as le,u as te,d as ne,t as ue}from"./index-DwJjVrn6.js";import{E as oe}from"./index-CY3iw2TW.js";import{_ as re}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./index-DguJ4OYc.js";import"./vnode-wHVxG6yF.js";import"./scroll-CGLW73hp.js";import"./index-EHUqHs3S.js";import"./castArray-DrYRfuDR.js";import"./_Uint8Array-D9m7vkXT.js";import"./_initCloneObject-CUocRwYS.js";import"./isEqual-ClYigGjQ.js";const se=100,ie=600,de={beforeMount(e,a){const l=a.value,{interval:t=se,delay:n=ie}=o(l)?{}:l;let u,r;const s=()=>o(l)?l():l.handler(),i=()=>{r&&(clearTimeout(r),r=void 0),u&&(clearInterval(u),u=void 0)};e.addEventListener("mousedown",(e=>{0===e.button&&(i(),s(),document.addEventListener("mouseup",(()=>i()),{once:!0}),r=setTimeout((()=>{u=setInterval((()=>{s()}),t)}),n))}))}},me=i({id:{type:String,default:void 0},step:{type:Number,default:1},stepStrictly:Boolean,max:{type:Number,default:Number.POSITIVE_INFINITY},min:{type:Number,default:Number.NEGATIVE_INFINITY},modelValue:Number,readonly:Boolean,disabled:Boolean,size:d,controls:{type:Boolean,default:!0},controlsPosition:{type:String,default:"",values:["","right"]},valueOnClear:{type:[String,Number,null],validator:e=>null===e||r(e)||["min","max"].includes(e),default:null},name:String,placeholder:String,precision:{type:Number,validator:e=>e>=0&&e===Number.parseInt(`${e}`,10)},validateEvent:{type:Boolean,default:!0},...ee(["ariaLabel"])}),pe={[Q]:(e,a)=>a!==e,blur:e=>e instanceof FocusEvent,focus:e=>e instanceof FocusEvent,[J]:e=>r(e)||s(e),[Z]:e=>r(e)||s(e)},ce=p({name:"ElInputNumber"});const ye=K(m(p({...ce,props:me,emits:pe,setup(e,{expose:a,emit:l}){const t=e,{t:n}=c(),u=y("input-number"),o=v(),i=f({currentValue:t.modelValue,userInput:null}),{formItem:d}=ae(),m=h((()=>r(t.modelValue)&&t.modelValue<=t.min)),p=h((()=>r(t.modelValue)&&t.modelValue>=t.max)),K=h((()=>{const e=Y(t.step);return b(t.precision)?Math.max(Y(t.modelValue),e):(t.precision,t.precision)})),P=h((()=>t.controls&&"right"===t.controlsPosition)),q=le(),z=te(),L=h((()=>{if(null!==i.userInput)return i.userInput;let e=i.currentValue;if(s(e))return"";if(r(e)){if(Number.isNaN(e))return"";b(t.precision)||(e=e.toFixed(t.precision))}return e})),R=(e,a)=>{if(b(a)&&(a=K.value),0===a)return Math.round(e);let l=String(e);const t=l.indexOf(".");if(-1===t)return e;if(!l.replace(".","").split("")[t+a])return e;const n=l.length;return"5"===l.charAt(n-1)&&(l=`${l.slice(0,Math.max(0,n-1))}6`),Number.parseFloat(Number(l).toFixed(a))},Y=e=>{if(s(e))return 0;const a=e.toString(),l=a.indexOf(".");let t=0;return-1!==l&&(t=a.length-l-1),t},G=(e,a=1)=>r(e)?R(e+t.step*a):i.currentValue,ee=()=>{if(t.readonly||z.value||p.value)return;const e=Number(L.value)||0,a=G(e);se(a),l(J,i.currentValue),ye()},oe=()=>{if(t.readonly||z.value||m.value)return;const e=Number(L.value)||0,a=G(e,-1);se(a),l(J,i.currentValue),ye()},re=(e,a)=>{const{max:n,min:u,step:o,precision:r,stepStrictly:i,valueOnClear:d}=t;n<u&&ue("InputNumber","min should not be greater than max.");let m=Number(e);if(s(e)||Number.isNaN(m))return null;if(""===e){if(null===d)return null;m=O(d)?{min:u,max:n}[d]:d}return i&&(m=R(Math.round(m/o)*o,r),m!==e&&a&&l(Z,m)),b(r)||(m=R(m,r)),(m>n||m<u)&&(m=m>n?n:u,a&&l(Z,m)),m},se=(e,a=!0)=>{var n;const u=i.currentValue,o=re(e);a?u===o&&e||(i.userInput=null,l(Z,o),u!==o&&l(Q,o,u),t.validateEvent&&(null==(n=null==d?void 0:d.validate)||n.call(d,"change").catch((e=>ne()))),i.currentValue=o):l(Z,o)},ie=e=>{i.userInput=e;const a=""===e?null:Number(e);l(J,a),se(a,!1)},me=e=>{const a=""!==e?Number(e):"";(r(a)&&!Number.isNaN(a)||""===e)&&se(a),ye(),i.userInput=null},pe=e=>{l("focus",e)},ce=e=>{var a,n;i.userInput=null,X()&&null===i.currentValue&&(null==(a=o.value)?void 0:a.input)&&(o.value.input.value=""),l("blur",e),t.validateEvent&&(null==(n=null==d?void 0:d.validate)||n.call(d,"blur").catch((e=>ne())))},ye=()=>{i.currentValue!==t.modelValue&&(i.currentValue=t.modelValue)},ve=e=>{document.activeElement===e.target&&e.preventDefault()};return V((()=>t.modelValue),((e,a)=>{const l=re(e,!0);null===i.userInput&&l!==a&&(i.currentValue=l)}),{immediate:!0}),x((()=>{var e;const{min:a,max:n,modelValue:u}=t,s=null==(e=o.value)?void 0:e.input;if(s.setAttribute("role","spinbutton"),Number.isFinite(n)?s.setAttribute("aria-valuemax",String(n)):s.removeAttribute("aria-valuemax"),Number.isFinite(a)?s.setAttribute("aria-valuemin",String(a)):s.removeAttribute("aria-valuemin"),s.setAttribute("aria-valuenow",i.currentValue||0===i.currentValue?String(i.currentValue):""),s.setAttribute("aria-disabled",String(z.value)),!r(u)&&null!=u){let e=Number(u);Number.isNaN(e)&&(e=null),l(Z,e)}s.addEventListener("wheel",ve,{passive:!1})})),g((()=>{var e,a;const l=null==(e=o.value)?void 0:e.input;null==l||l.setAttribute("aria-valuenow",`${null!=(a=i.currentValue)?a:""}`)})),a({focus:()=>{var e,a;null==(a=null==(e=o.value)?void 0:e.focus)||a.call(e)},blur:()=>{var e,a;null==(a=null==(e=o.value)?void 0:e.blur)||a.call(e)}}),(e,a)=>(k(),_("div",{class:j([U(u).b(),U(u).m(U(q)),U(u).is("disabled",U(z)),U(u).is("without-controls",!e.controls),U(u).is("controls-right",U(P))]),onDragstart:D((()=>{}),["prevent"])},[e.controls?w((k(),_("span",{key:0,role:"button","aria-label":U(n)("el.inputNumber.decrease"),class:j([U(u).e("decrease"),U(u).is("disabled",U(m))]),onKeydown:$(oe,["enter"])},[M(e.$slots,"decrease-icon",{},(()=>[I(U(S),null,{default:C((()=>[U(P)?(k(),E(U(T),{key:0})):(k(),E(U(A),{key:1}))])),_:1})]))],42,["aria-label","onKeydown"])),[[U(de),oe]]):N("v-if",!0),e.controls?w((k(),_("span",{key:1,role:"button","aria-label":U(n)("el.inputNumber.increase"),class:j([U(u).e("increase"),U(u).is("disabled",U(p))]),onKeydown:$(ee,["enter"])},[M(e.$slots,"increase-icon",{},(()=>[I(U(S),null,{default:C((()=>[U(P)?(k(),E(U(F),{key:0})):(k(),E(U(B),{key:1}))])),_:1})]))],42,["aria-label","onKeydown"])),[[U(de),ee]]):N("v-if",!0),I(U(W),{id:e.id,ref_key:"input",ref:o,type:"number",step:e.step,"model-value":U(L),placeholder:e.placeholder,readonly:e.readonly,disabled:U(z),size:U(q),max:e.max,min:e.min,name:e.name,"aria-label":e.ariaLabel,"validate-event":!1,onKeydown:[$(D(ee,["prevent"]),["up"]),$(D(oe,["prevent"]),["down"])],onBlur:ce,onFocus:pe,onInput:ie,onChange:me},H({_:2},[e.$slots.prefix?{name:"prefix",fn:C((()=>[M(e.$slots,"prefix")]))}:void 0,e.$slots.suffix?{name:"suffix",fn:C((()=>[M(e.$slots,"suffix")]))}:void 0]),1032,["id","step","model-value","placeholder","readonly","disabled","size","max","min","name","aria-label","onKeydown"])],42,["onDragstart"]))}}),[["__file","input-number.vue"]])),ve={class:"drawer-header",style:{padding:"20px","font-size":"16px"}},fe={class:"title"},he={class:"code-editor-wrapper"},be={class:"time-input-group"},Ve={class:"time-input-group"},xe={class:"time-input-group"},ge={class:"cycle-actions"},_e={class:"cycle-actions",style:{width:"100%"}},ke={style:{flex:"auto","text-align":"right",padding:"0 20px"}},we=re(p({__name:"add-task",props:{modelValue:{type:Boolean},type:{type:Boolean},formData:{}},emits:["update:modelValue","success","taskAdded"],setup(o,{emit:r}){const s=o,i=r,d=v(null),m=v(!1),p=v("rtl"),c=v(),y=v(""),h=[{day:"一",value:1},{day:"二",value:2},{day:"三",value:3},{day:"四",value:4},{day:"五",value:5},{day:"六",value:6},{day:"日",value:7}],b=f({name:"",command:"",cycles:[{type:"day",monthTimes:[{day:1,hour:0,minute:0}],weekTimes:[{day:1,hour:0,minute:0}],dayHour:0,dayMinute:0,hourMinute:0,customCron:"",n_minute:1}]}),x=f({name:[{required:!0,message:"请输入任务名称",trigger:"blur"}],command:[{required:!0,message:"请输入脚本内容",trigger:"blur",validator:(e,a,l)=>{a?l():l(new Error("请输入脚本内容"))}}]}),g=()=>{m.value=!1,i("update:modelValue",!1)},w=async()=>{c.value&&(b.cycles&&0!==b.cycles.length?await c.value.validate((async e=>{if(e)try{const e=b.cycles.flatMap((e=>{switch(e.type){case"minute":return["* * * * *"];case"hour":return[`${e.hourMinute} * * * *`];case"day":return[`${e.dayMinute} ${e.dayHour} * * *`];case"week":return e.weekTimes.map((e=>`${e.minute} ${e.hour} * * ${e.day}`));case"month":return e.monthTimes.map((e=>`${e.minute} ${e.hour} ${e.day} * *`));case"n_minute":return[M(e.n_minute,0)];default:return[]}}));let a={name:b.name,schedule:e,command:b.command,enabled:!0};!s.type&&s.formData&&s.formData.id?a.id=s.formData.id:delete a.id;const{data:l}=await u[s.type?"addPlanTask":"updataPlanTask"](a);i("taskAdded",l),G.success(s.type?"添加成功":"修改成功"),i("success"),g()}catch(a){G.error("操作失败")}})):G.error("请设置执行周期"))};V((()=>s.modelValue),(e=>{m.value=e})),V((()=>s.formData),(e=>{if(e&&!s.type){const a=e.schedule.split(",");b.name=e.name,b.cycles=[],b.command=e.command,b.name=e.name,y.value=e.command,a.forEach((e=>{const[a,l,t,n,u]=e.split(" ");let o={customCron:e};"* * * * *"===e?o.type="minute":"*"===l&&a.startsWith("*/")?(o.type="n_minute",o.n_minute=parseInt(a.split("/")[1])):"0"===l&&"0"===a&&"*"===t&&"*"===n&&"*"===u?(o.type="day",o.dayHour=0,o.dayMinute=0):"*"===t&&"*"===n&&/^\d+$/.test(u)?(o.type="week",o.weekTimes=[{day:parseInt(u),hour:parseInt(l),minute:parseInt(a)}]):"*"===n&&/^\d+$/.test(t)?(o.type="month",o.monthTimes=[{day:parseInt(t),hour:parseInt(l),minute:parseInt(a)}]):"*"===t&&"*"===n&&"*"===u&&(o.type="day",o.dayHour=parseInt(l),o.dayMinute=parseInt(a)),b.cycles.push(o)}))}else b.name="",b.command="",y.value="",b.cycles=[{type:"day",monthTimes:[{day:1,hour:0,minute:0}],weekTimes:[{day:1,hour:0,minute:0}],dayHour:0,dayMinute:0,hourMinute:0,customCron:"",n_minute:1}]}),{immediate:!0});const $=()=>{b.cycles.push({type:"day",monthTimes:[{day:1,hour:0,minute:0}],weekTimes:[{day:1,hour:0,minute:0}],dayHour:0,dayMinute:0,hourMinute:0,customCron:"",n_minute:1})};function M(e,a){let l=e%60,t=Math.floor(e/60)+a,n=1,u=1;return t>=24&&(n+=Math.floor(t/24),t%=24),n>30&&(u+=Math.floor(n/30),n%=30,0===n&&(n=30)),u>12&&(u%=12,0===u&&(u=12)),`${l} ${t} ${n} ${u} *`}const T=e=>{const a=e.target;a&&(b.command=a.innerText)};return(u,o)=>{const r=W,s=l,i=n,v=t,f=ye,V=S,M=oe,A=a,F=e;return k(),E(F,{modelValue:m.value,"onUpdate:modelValue":o[1]||(o[1]=e=>m.value=e),direction:p.value,size:"50%","before-close":g},{header:C((()=>[P("div",ve,[P("span",fe,q(u.type?"添加计划任务":"修改计划任务"),1)])])),footer:C((()=>[P("div",ke,[I(M,{onClick:g},{default:C((()=>o[11]||(o[11]=[Y("取消")]))),_:1}),I(M,{type:"primary",onClick:w},{default:C((()=>o[12]||(o[12]=[Y("确定")]))),_:1})])])),default:C((()=>[I(A,{ref_key:"ruleFormRef",ref:c,model:b,rules:x,"label-position":"top",style:{padding:"0 20px"}},{default:C((()=>[I(s,{label:"任务名称",prop:"name",required:""},{default:C((()=>[I(r,{modelValue:b.name,"onUpdate:modelValue":o[0]||(o[0]=e=>b.name=e),placeholder:"请输入任务名称"},null,8,["modelValue"])])),_:1}),I(s,{label:"脚本内容",prop:"command"},{default:C((()=>[P("div",he,[P("pre",{class:"code-editor",contenteditable:"true",spellcheck:"false",onInput:T,ref_key:"codeEditorRef",ref:d},q(y.value),545)])])),_:1}),I(s,{label:"执行周期",required:""},{default:C((()=>[(k(!0),_(z,null,L(b.cycles,((e,a)=>(k(),_("div",{key:a,class:"cycle-row"},[I(v,{modelValue:e.type,"onUpdate:modelValue":a=>e.type=a,onChange:e=>((e,a)=>{const l=b.cycles[a];switch(e){case"minute":l.customCron="* * * * *";break;case"hour":l.customCron="0 * * * *";break;case"day":l.customCron="0 0 * * *";break;case"week":l.customCron="0 0 * * 0";break;case"month":l.customCron="0 0 1 * *";break;case"n_minute":l.customCron=`*/${l.n_minute} * * * *`}})(e,a),placeholder:"请选择执行周期",style:{width:"100px"}},{default:C((()=>[I(i,{label:"每分钟",value:"minute"}),I(i,{label:"每小时",value:"hour"}),I(i,{label:"每天",value:"day"}),I(i,{label:"每周",value:"week"}),I(i,{label:"每月",value:"month"})])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),P("div",{class:j(["cycle-inputs",e.type])},["month"===e.type?(k(!0),_(z,{key:0},L(e.monthTimes,((e,a)=>(k(),_("div",{key:a,class:"time-row"},[P("div",be,[I(f,{"controls-position":"right",modelValue:e.day,"onUpdate:modelValue":a=>e.day=a,min:1,max:31,placeholder:"请输入",style:{width:"120px"}},{suffix:C((()=>o[2]||(o[2]=[P("span",null,"日",-1)]))),_:2},1032,["modelValue","onUpdate:modelValue"])]),P("div",Ve,[I(f,{"controls-position":"right",modelValue:e.hour,"onUpdate:modelValue":a=>e.hour=a,min:0,max:23,placeholder:"请输入",style:{width:"120px"}},{suffix:C((()=>o[3]||(o[3]=[P("span",null,"时",-1)]))),_:2},1032,["modelValue","onUpdate:modelValue"])]),P("div",xe,[I(f,{"controls-position":"right",modelValue:e.minute,"onUpdate:modelValue":a=>e.minute=a,min:0,max:59,placeholder:"请输入",style:{width:"120px"}},{suffix:C((()=>o[4]||(o[4]=[P("span",null,"分",-1)]))),_:2},1032,["modelValue","onUpdate:modelValue"])])])))),128)):N("",!0),"week"===e.type?(k(!0),_(z,{key:1},L(e.weekTimes,((e,a)=>(k(),_("div",{key:a,class:"time-row"},[I(v,{modelValue:e.day,"onUpdate:modelValue":a=>e.day=a,placeholder:"请输入"},{default:C((()=>[(k(),_(z,null,L(h,(e=>I(i,{key:e.value,label:`周${e.day}`,value:e.value},null,8,["label","value"]))),64))])),_:2},1032,["modelValue","onUpdate:modelValue"]),I(f,{"controls-position":"right",modelValue:e.hour,"onUpdate:modelValue":a=>e.hour=a,min:0,max:23,placeholder:"请输入",style:{width:"120px"}},{suffix:C((()=>o[5]||(o[5]=[P("span",null,"时",-1)]))),_:2},1032,["modelValue","onUpdate:modelValue"]),I(f,{"controls-position":"right",modelValue:e.minute,"onUpdate:modelValue":a=>e.minute=a,min:0,max:59,placeholder:"请输入",style:{width:"120px"}},{suffix:C((()=>o[6]||(o[6]=[P("span",null,"分",-1)]))),_:2},1032,["modelValue","onUpdate:modelValue"])])))),128)):N("",!0),"day"===e.type?(k(),_(z,{key:2},[I(f,{"controls-position":"right",modelValue:e.dayHour,"onUpdate:modelValue":a=>e.dayHour=a,min:0,max:23,placeholder:"请输入",style:{width:"120px"}},{suffix:C((()=>o[7]||(o[7]=[P("span",null,"时",-1)]))),_:2},1032,["modelValue","onUpdate:modelValue"]),I(f,{"controls-position":"right",modelValue:e.dayMinute,"onUpdate:modelValue":a=>e.dayMinute=a,min:0,max:59,placeholder:"请输入",style:{width:"120px"}},{suffix:C((()=>o[8]||(o[8]=[P("span",null,"分",-1)]))),_:2},1032,["modelValue","onUpdate:modelValue"])],64)):N("",!0),"hour"===e.type?(k(),E(f,{key:3,"controls-position":"right",modelValue:e.hourMinute,"onUpdate:modelValue":a=>e.hourMinute=a,min:0,max:59,placeholder:"请输入",style:{width:"120px"}},{suffix:C((()=>o[9]||(o[9]=[P("span",null,"分",-1)]))),_:2},1032,["modelValue","onUpdate:modelValue"])):N("",!0),"n_minute"===e.type?(k(),E(f,{key:4,"controls-position":"right",modelValue:e.n_minute,"onUpdate:modelValue":a=>e.n_minute=a,min:1,placeholder:"请输入N值",style:{width:"120px"}},null,8,["modelValue","onUpdate:modelValue"])):N("",!0)],2),P("div",ge,[b.cycles.length>1?(k(),E(M,{key:0,type:"danger",link:"",onClick:e=>(e=>{b.cycles.length>1&&b.cycles.splice(e,1)})(a)},{default:C((()=>[I(V,null,{default:C((()=>[I(U(R))])),_:1})])),_:2},1032,["onClick"])):N("",!0)])])))),128)),P("div",_e,[I(M,{type:"primary",onClick:$},{default:C((()=>[I(V,null,{default:C((()=>[I(U(B)),o[10]||(o[10]=Y("添加"))])),_:1})])),_:1})])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","direction"])}}}),[["__scopeId","data-v-4e604b90"]]);export{we as default};
