/* empty css             */import{E as e}from"./el-drawer-qVVuOe4K.js";import"./el-overlay-n5HYZiIu.js";import{E as a,a as l}from"./el-form-item-DBl2iH2x.js";import{E as t}from"./el-button-C6SlJWJv.js";import{U as n,I as u,C as o,c as r,f as s,a as i,u as d,E as m,d as c,t as p,x as y}from"./el-input-CCiT4Pw-.js";import{E as v,a as f}from"./el-select-Diq8nzxA.js";import"./el-popper-CgqLQvxz.js";import{A as h}from"./Api-BE344Hwh.js";import{as as b,aI as V,Q as x,p as g,aO as _,_ as k,d as w,ao as N,a as I,s as $,x as U,c as M,bk as C,y as E,B as T,aV as j,b as A,o as S,H as F,ae as B,a3 as D,e as H,au as O,n as K,r as P,i as q,h as z,t as L,cj as Y,F as G,ca as R,cd as W,aD as X,ac as Z,G as J,g as Q,X as ee,$ as ae,J as le,a5 as te,ax as ne,Z as ue,a1 as oe}from"./index-B0-DY18Y.js";import{_ as re}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./index-B8-5ocmZ.js";import"./vnode-C-JGoUos.js";import"./index-DSCusJxK.js";import"./castArray-DHQk_f1a.js";import"./_Uint8Array-D0RYPAnJ.js";import"./_initCloneObject-B_s4quhu.js";import"./isEqual-C6HWhcNO.js";const se=100,ie=600,de={beforeMount(e,a){const l=a.value,{interval:t=se,delay:n=ie}=b(l)?{}:l;let u,o;const r=()=>b(l)?l():l.handler(),s=()=>{o&&(clearTimeout(o),o=void 0),u&&(clearInterval(u),u=void 0)};e.addEventListener("mousedown",(e=>{0===e.button&&(s(),r(),document.addEventListener("mouseup",(()=>s()),{once:!0}),o=setTimeout((()=>{u=setInterval((()=>{r()}),t)}),n))}))}},me=g({id:{type:String,default:void 0},step:{type:Number,default:1},stepStrictly:Boolean,max:{type:Number,default:Number.POSITIVE_INFINITY},min:{type:Number,default:Number.NEGATIVE_INFINITY},modelValue:Number,readonly:Boolean,disabled:Boolean,size:_,controls:{type:Boolean,default:!0},controlsPosition:{type:String,default:"",values:["","right"]},valueOnClear:{type:[String,Number,null],validator:e=>null===e||V(e)||["min","max"].includes(e),default:null},name:String,placeholder:String,precision:{type:Number,validator:e=>e>=0&&e===Number.parseInt(`${e}`,10)},validateEvent:{type:Boolean,default:!0},...r(["ariaLabel"])}),ce={[o]:(e,a)=>a!==e,blur:e=>e instanceof FocusEvent,focus:e=>e instanceof FocusEvent,[u]:e=>V(e)||x(e),[n]:e=>V(e)||x(e)},pe=w({name:"ElInputNumber"});const ye=Q(k(w({...pe,props:me,emits:ce,setup(e,{expose:a,emit:l}){const t=e,{t:r}=N(),v=I("input-number"),f=$(),h=U({currentValue:t.modelValue,userInput:null}),{formItem:b}=s(),g=M((()=>V(t.modelValue)&&t.modelValue<=t.min)),_=M((()=>V(t.modelValue)&&t.modelValue>=t.max)),k=M((()=>{const e=te(t.step);return C(t.precision)?Math.max(te(t.modelValue),e):(t.precision,t.precision)})),w=M((()=>t.controls&&"right"===t.controlsPosition)),Q=i(),ee=d(),ae=M((()=>{if(null!==h.userInput)return h.userInput;let e=h.currentValue;if(x(e))return"";if(V(e)){if(Number.isNaN(e))return"";C(t.precision)||(e=e.toFixed(t.precision))}return e})),le=(e,a)=>{if(C(a)&&(a=k.value),0===a)return Math.round(e);let l=String(e);const t=l.indexOf(".");if(-1===t)return e;if(!l.replace(".","").split("")[t+a])return e;const n=l.length;return"5"===l.charAt(n-1)&&(l=`${l.slice(0,Math.max(0,n-1))}6`),Number.parseFloat(Number(l).toFixed(a))},te=e=>{if(x(e))return 0;const a=e.toString(),l=a.indexOf(".");let t=0;return-1!==l&&(t=a.length-l-1),t},ne=(e,a=1)=>V(e)?le(e+t.step*a):h.currentValue,ue=()=>{if(t.readonly||ee.value||_.value)return;const e=Number(ae.value)||0,a=ne(e);se(a),l(u,h.currentValue),ye()},oe=()=>{if(t.readonly||ee.value||g.value)return;const e=Number(ae.value)||0,a=ne(e,-1);se(a),l(u,h.currentValue),ye()},re=(e,a)=>{const{max:u,min:o,step:r,precision:s,stepStrictly:i,valueOnClear:d}=t;u<o&&p("InputNumber","min should not be greater than max.");let m=Number(e);if(x(e)||Number.isNaN(m))return null;if(""===e){if(null===d)return null;m=J(d)?{min:o,max:u}[d]:d}return i&&(m=le(Math.round(m/r)*r,s),m!==e&&a&&l(n,m)),C(s)||(m=le(m,s)),(m>u||m<o)&&(m=m>u?u:o,a&&l(n,m)),m},se=(e,a=!0)=>{var u;const r=h.currentValue,s=re(e);a?r===s&&e||(h.userInput=null,l(n,s),r!==s&&l(o,s,r),t.validateEvent&&(null==(u=null==b?void 0:b.validate)||u.call(b,"change").catch((e=>c()))),h.currentValue=s):l(n,s)},ie=e=>{h.userInput=e;const a=""===e?null:Number(e);l(u,a),se(a,!1)},me=e=>{const a=""!==e?Number(e):"";(V(a)&&!Number.isNaN(a)||""===e)&&se(a),ye(),h.userInput=null},ce=e=>{l("focus",e)},pe=e=>{var a,n;h.userInput=null,y()&&null===h.currentValue&&(null==(a=f.value)?void 0:a.input)&&(f.value.input.value=""),l("blur",e),t.validateEvent&&(null==(n=null==b?void 0:b.validate)||n.call(b,"blur").catch((e=>c())))},ye=()=>{h.currentValue!==t.modelValue&&(h.currentValue=t.modelValue)},ve=e=>{document.activeElement===e.target&&e.preventDefault()};return E((()=>t.modelValue),((e,a)=>{const l=re(e,!0);null===h.userInput&&l!==a&&(h.currentValue=l)}),{immediate:!0}),T((()=>{var e;const{min:a,max:u,modelValue:o}=t,r=null==(e=f.value)?void 0:e.input;if(r.setAttribute("role","spinbutton"),Number.isFinite(u)?r.setAttribute("aria-valuemax",String(u)):r.removeAttribute("aria-valuemax"),Number.isFinite(a)?r.setAttribute("aria-valuemin",String(a)):r.removeAttribute("aria-valuemin"),r.setAttribute("aria-valuenow",h.currentValue||0===h.currentValue?String(h.currentValue):""),r.setAttribute("aria-disabled",String(ee.value)),!V(o)&&null!=o){let e=Number(o);Number.isNaN(e)&&(e=null),l(n,e)}r.addEventListener("wheel",ve,{passive:!1})})),j((()=>{var e,a;const l=null==(e=f.value)?void 0:e.input;null==l||l.setAttribute("aria-valuenow",`${null!=(a=h.currentValue)?a:""}`)})),a({focus:()=>{var e,a;null==(a=null==(e=f.value)?void 0:e.focus)||a.call(e)},blur:()=>{var e,a;null==(a=null==(e=f.value)?void 0:e.blur)||a.call(e)}}),(e,a)=>(S(),A("div",{class:K([H(v).b(),H(v).m(H(Q)),H(v).is("disabled",H(ee)),H(v).is("without-controls",!e.controls),H(v).is("controls-right",H(w))]),onDragstart:Z((()=>{}),["prevent"])},[e.controls?F((S(),A("span",{key:0,role:"button","aria-label":H(r)("el.inputNumber.decrease"),class:K([H(v).e("decrease"),H(v).is("disabled",H(g))]),onKeydown:O(oe,["enter"])},[P(e.$slots,"decrease-icon",{},(()=>[D(H(G),null,{default:q((()=>[H(w)?(S(),z(H(L),{key:0})):(S(),z(H(Y),{key:1}))])),_:1})]))],42,["aria-label","onKeydown"])),[[H(de),oe]]):B("v-if",!0),e.controls?F((S(),A("span",{key:1,role:"button","aria-label":H(r)("el.inputNumber.increase"),class:K([H(v).e("increase"),H(v).is("disabled",H(_))]),onKeydown:O(ue,["enter"])},[P(e.$slots,"increase-icon",{},(()=>[D(H(G),null,{default:q((()=>[H(w)?(S(),z(H(R),{key:0})):(S(),z(H(W),{key:1}))])),_:1})]))],42,["aria-label","onKeydown"])),[[H(de),ue]]):B("v-if",!0),D(H(m),{id:e.id,ref_key:"input",ref:f,type:"number",step:e.step,"model-value":H(ae),placeholder:e.placeholder,readonly:e.readonly,disabled:H(ee),size:H(Q),max:e.max,min:e.min,name:e.name,"aria-label":e.ariaLabel,"validate-event":!1,onKeydown:[O(Z(ue,["prevent"]),["up"]),O(Z(oe,["prevent"]),["down"])],onBlur:pe,onFocus:ce,onInput:ie,onChange:me},X({_:2},[e.$slots.prefix?{name:"prefix",fn:q((()=>[P(e.$slots,"prefix")]))}:void 0,e.$slots.suffix?{name:"suffix",fn:q((()=>[P(e.$slots,"suffix")]))}:void 0]),1032,["id","step","model-value","placeholder","readonly","disabled","size","max","min","name","aria-label","onKeydown"])],42,["onDragstart"]))}}),[["__file","input-number.vue"]])),ve={class:"drawer-header",style:{padding:"20px","font-size":"16px"}},fe={class:"title"},he={class:"code-editor-wrapper"},be={class:"time-input-group"},Ve={class:"time-input-group"},xe={class:"time-input-group"},ge={class:"cycle-actions"},_e={class:"cycle-actions",style:{width:"100%"}},ke={style:{flex:"auto","text-align":"right",padding:"0 20px"}},we=re(w({__name:"add-task",props:{modelValue:{type:Boolean},type:{type:Boolean},formData:{}},emits:["update:modelValue","success","taskAdded"],setup(n,{emit:u}){const o=n,r=u,s=$(null),i=$(!1),d=$("rtl"),c=$(),p=$(""),y=[{day:"一",value:1},{day:"二",value:2},{day:"三",value:3},{day:"四",value:4},{day:"五",value:5},{day:"六",value:6},{day:"日",value:7}],b=U({name:"",command:"",cycles:[{type:"day",monthTimes:[{day:1,hour:0,minute:0}],weekTimes:[{day:1,hour:0,minute:0}],dayHour:0,dayMinute:0,hourMinute:0,customCron:"",n_minute:1}]}),V=U({name:[{required:!0,message:"请输入任务名称",trigger:"blur"}],command:[{required:!0,message:"请输入脚本内容",trigger:"blur",validator:(e,a,l)=>{a?l():l(new Error("请输入脚本内容"))}}]}),x=()=>{i.value=!1,r("update:modelValue",!1)},g=async()=>{c.value&&(b.cycles&&0!==b.cycles.length?await c.value.validate((async e=>{if(e)try{const e=b.cycles.flatMap((e=>{switch(e.type){case"minute":return["* * * * *"];case"hour":return[`${e.hourMinute} * * * *`];case"day":return[`${e.dayMinute} ${e.dayHour} * * *`];case"week":return e.weekTimes.map((e=>`${e.minute} ${e.hour} * * ${e.day}`));case"month":return e.monthTimes.map((e=>`${e.minute} ${e.hour} ${e.day} * *`));case"n_minute":return[k(e.n_minute,0)];default:return[]}}));let a={name:b.name,schedule:e,command:b.command,enabled:!0};!o.type&&o.formData&&o.formData.id?a.id=o.formData.id:delete a.id;const{data:l}=await h[o.type?"addPlanTask":"updataPlanTask"](a);r("taskAdded",l),oe.success(o.type?"添加成功":"修改成功"),r("success"),x()}catch(a){oe.error("操作失败")}})):oe.error("请设置执行周期"))};E((()=>o.modelValue),(e=>{i.value=e})),E((()=>o.formData),(e=>{if(e&&!o.type){const a=e.schedule.split(",");b.name=e.name,b.cycles=[],b.command=e.command,b.name=e.name,p.value=e.command,a.forEach((e=>{const[a,l,t,n,u]=e.split(" ");let o={customCron:e};"* * * * *"===e?o.type="minute":"*"===l&&a.startsWith("*/")?(o.type="n_minute",o.n_minute=parseInt(a.split("/")[1])):"0"===l&&"0"===a&&"*"===t&&"*"===n&&"*"===u?(o.type="day",o.dayHour=0,o.dayMinute=0):"*"===t&&"*"===n&&/^\d+$/.test(u)?(o.type="week",o.weekTimes=[{day:parseInt(u),hour:parseInt(l),minute:parseInt(a)}]):"*"===n&&/^\d+$/.test(t)?(o.type="month",o.monthTimes=[{day:parseInt(t),hour:parseInt(l),minute:parseInt(a)}]):"*"===t&&"*"===n&&"*"===u&&(o.type="day",o.dayHour=parseInt(l),o.dayMinute=parseInt(a)),b.cycles.push(o)}))}else b.name="",b.command="",p.value="",b.cycles=[{type:"day",monthTimes:[{day:1,hour:0,minute:0}],weekTimes:[{day:1,hour:0,minute:0}],dayHour:0,dayMinute:0,hourMinute:0,customCron:"",n_minute:1}]}),{immediate:!0});const _=()=>{b.cycles.push({type:"day",monthTimes:[{day:1,hour:0,minute:0}],weekTimes:[{day:1,hour:0,minute:0}],dayHour:0,dayMinute:0,hourMinute:0,customCron:"",n_minute:1})};function k(e,a){let l=e%60,t=Math.floor(e/60)+a,n=1,u=1;return t>=24&&(n+=Math.floor(t/24),t%=24),n>30&&(u+=Math.floor(n/30),n%=30,0===n&&(n=30)),u>12&&(u%=12,0===u&&(u=12)),`${l} ${t} ${n} ${u} *`}const w=e=>{const a=e.target;a&&(b.command=a.innerText)};return(n,u)=>{const o=m,r=l,h=f,k=v,N=ye,I=G,$=t,U=a,M=e;return S(),z(M,{modelValue:i.value,"onUpdate:modelValue":u[1]||(u[1]=e=>i.value=e),direction:d.value,size:"50%","before-close":x},{header:q((()=>[ee("div",ve,[ee("span",fe,ae(n.type?"添加计划任务":"修改计划任务"),1)])])),footer:q((()=>[ee("div",ke,[D($,{onClick:x},{default:q((()=>u[11]||(u[11]=[ue("取消")]))),_:1}),D($,{type:"primary",onClick:g},{default:q((()=>u[12]||(u[12]=[ue("确定")]))),_:1})])])),default:q((()=>[D(U,{ref_key:"ruleFormRef",ref:c,model:b,rules:V,"label-position":"top",style:{padding:"0 20px"}},{default:q((()=>[D(r,{label:"任务名称",prop:"name",required:""},{default:q((()=>[D(o,{modelValue:b.name,"onUpdate:modelValue":u[0]||(u[0]=e=>b.name=e),placeholder:"请输入任务名称"},null,8,["modelValue"])])),_:1}),D(r,{label:"脚本内容",prop:"command"},{default:q((()=>[ee("div",he,[ee("pre",{class:"code-editor",contenteditable:"true",spellcheck:"false",onInput:w,ref_key:"codeEditorRef",ref:s},ae(p.value),545)])])),_:1}),D(r,{label:"执行周期",required:""},{default:q((()=>[(S(!0),A(le,null,te(b.cycles,((e,a)=>(S(),A("div",{key:a,class:"cycle-row"},[D(k,{modelValue:e.type,"onUpdate:modelValue":a=>e.type=a,onChange:e=>((e,a)=>{const l=b.cycles[a];switch(e){case"minute":l.customCron="* * * * *";break;case"hour":l.customCron="0 * * * *";break;case"day":l.customCron="0 0 * * *";break;case"week":l.customCron="0 0 * * 0";break;case"month":l.customCron="0 0 1 * *";break;case"n_minute":l.customCron=`*/${l.n_minute} * * * *`}})(e,a),placeholder:"请选择执行周期",style:{width:"100px"}},{default:q((()=>[D(h,{label:"每分钟",value:"minute"}),D(h,{label:"每小时",value:"hour"}),D(h,{label:"每天",value:"day"}),D(h,{label:"每周",value:"week"}),D(h,{label:"每月",value:"month"})])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),ee("div",{class:K(["cycle-inputs",e.type])},["month"===e.type?(S(!0),A(le,{key:0},te(e.monthTimes,((e,a)=>(S(),A("div",{key:a,class:"time-row"},[ee("div",be,[D(N,{"controls-position":"right",modelValue:e.day,"onUpdate:modelValue":a=>e.day=a,min:1,max:31,placeholder:"请输入",style:{width:"120px"}},{suffix:q((()=>u[2]||(u[2]=[ee("span",null,"日",-1)]))),_:2},1032,["modelValue","onUpdate:modelValue"])]),ee("div",Ve,[D(N,{"controls-position":"right",modelValue:e.hour,"onUpdate:modelValue":a=>e.hour=a,min:0,max:23,placeholder:"请输入",style:{width:"120px"}},{suffix:q((()=>u[3]||(u[3]=[ee("span",null,"时",-1)]))),_:2},1032,["modelValue","onUpdate:modelValue"])]),ee("div",xe,[D(N,{"controls-position":"right",modelValue:e.minute,"onUpdate:modelValue":a=>e.minute=a,min:0,max:59,placeholder:"请输入",style:{width:"120px"}},{suffix:q((()=>u[4]||(u[4]=[ee("span",null,"分",-1)]))),_:2},1032,["modelValue","onUpdate:modelValue"])])])))),128)):B("",!0),"week"===e.type?(S(!0),A(le,{key:1},te(e.weekTimes,((e,a)=>(S(),A("div",{key:a,class:"time-row"},[D(k,{modelValue:e.day,"onUpdate:modelValue":a=>e.day=a,placeholder:"请输入"},{default:q((()=>[(S(),A(le,null,te(y,(e=>D(h,{key:e.value,label:`周${e.day}`,value:e.value},null,8,["label","value"]))),64))])),_:2},1032,["modelValue","onUpdate:modelValue"]),D(N,{"controls-position":"right",modelValue:e.hour,"onUpdate:modelValue":a=>e.hour=a,min:0,max:23,placeholder:"请输入",style:{width:"120px"}},{suffix:q((()=>u[5]||(u[5]=[ee("span",null,"时",-1)]))),_:2},1032,["modelValue","onUpdate:modelValue"]),D(N,{"controls-position":"right",modelValue:e.minute,"onUpdate:modelValue":a=>e.minute=a,min:0,max:59,placeholder:"请输入",style:{width:"120px"}},{suffix:q((()=>u[6]||(u[6]=[ee("span",null,"分",-1)]))),_:2},1032,["modelValue","onUpdate:modelValue"])])))),128)):B("",!0),"day"===e.type?(S(),A(le,{key:2},[D(N,{"controls-position":"right",modelValue:e.dayHour,"onUpdate:modelValue":a=>e.dayHour=a,min:0,max:23,placeholder:"请输入",style:{width:"120px"}},{suffix:q((()=>u[7]||(u[7]=[ee("span",null,"时",-1)]))),_:2},1032,["modelValue","onUpdate:modelValue"]),D(N,{"controls-position":"right",modelValue:e.dayMinute,"onUpdate:modelValue":a=>e.dayMinute=a,min:0,max:59,placeholder:"请输入",style:{width:"120px"}},{suffix:q((()=>u[8]||(u[8]=[ee("span",null,"分",-1)]))),_:2},1032,["modelValue","onUpdate:modelValue"])],64)):B("",!0),"hour"===e.type?(S(),z(N,{key:3,"controls-position":"right",modelValue:e.hourMinute,"onUpdate:modelValue":a=>e.hourMinute=a,min:0,max:59,placeholder:"请输入",style:{width:"120px"}},{suffix:q((()=>u[9]||(u[9]=[ee("span",null,"分",-1)]))),_:2},1032,["modelValue","onUpdate:modelValue"])):B("",!0),"n_minute"===e.type?(S(),z(N,{key:4,"controls-position":"right",modelValue:e.n_minute,"onUpdate:modelValue":a=>e.n_minute=a,min:1,placeholder:"请输入N值",style:{width:"120px"}},null,8,["modelValue","onUpdate:modelValue"])):B("",!0)],2),ee("div",ge,[b.cycles.length>1?(S(),z($,{key:0,type:"danger",link:"",onClick:e=>(e=>{b.cycles.length>1&&b.cycles.splice(e,1)})(a)},{default:q((()=>[D(I,null,{default:q((()=>[D(H(ne))])),_:1})])),_:2},1032,["onClick"])):B("",!0)])])))),128)),ee("div",_e,[D($,{type:"primary",onClick:_},{default:q((()=>[D(I,null,{default:q((()=>[D(H(W)),u[10]||(u[10]=ue("添加"))])),_:1})])),_:1})])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","direction"])}}}),[["__scopeId","data-v-4e604b90"]]);export{we as default};
