import{_ as a,a as e}from"./custom-form.vue_vue_type_script_setup_true_lang-C6_HscmN.js";/* empty css             *//* empty css                 */import"./el-tag-hrDeqNMc.js";import{E as t,a as s}from"./el-select-DASP7Wfd.js";import"./el-popper-DuiXp9eT.js";import{d as r,x as l,c as i,a1 as o,ab as d,b as p,o as n,a3 as m,a8 as c,i as u,h as b,ae as g}from"./index-BpgbG9_h.js";import{C as v}from"./card-tabs-S2z8Lr1_.js";import{A as f}from"./Api-DIELJlCh.js";import{E as y}from"./index-B5k-8-YQ.js";import{_ as w}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./el-drawer-_L3C1oIg.js";import"./index-E4qH6n_1.js";import"./vnode-CjD2MH5P.js";import"./index-vgTml2Xy.js";import"./scroll-BAvMHt_N.js";import"./index-Cee523Ml.js";import"./el-overlay-ghEGIsKl.js";import"./el-button-CghqIf1m.js";import"./el-form-item-CGp8wt0Y.js";import"./castArray-rxr1KqzA.js";import"./_Uint8Array-CjQH01s2.js";import"./_initCloneObject-Dm3var8j.js";import"./custom-dialog-BYISrEhD.js";import"./el-dialog-DDfsOjX0.js";import"./index-BLMo0UPX.js";import"./refs-D38PEvv-.js";import"./file-panel-ClhRzc_o.js";/* empty css                   */import"./el-checkbox-DBaZw9db.js";import"./isEqual-DSpmu0jQ.js";import"./index-DZi90au_.js";/* empty css                          */const j={class:"database-container"},x=w(r({__name:"index",setup(r){var w;const x=l({themeColor:{light:["#F7911C"],dark:["#EAB170"]},showTips:!0,tabs:{activeIndex:0,list:[{name:"MySQL",index:0,value:"mysql"},{name:"Redis",index:3,value:"redis"}],clickActive:a=>{x.tabs.activeIndex!==a.index&&(x.list.params={page:1,pageSize:10,type:"mysql"},x.tabs.activeIndex=a.index,x.list.params.type=a.value,x.form.data.value.type=a.value,x.list.loading=!1,x.list.total=0,x.list.data=[],d.router.push(`/database/${a.value}`))}},list:{loading:!0,data:[],total:0,params:{page:1,pageSize:10,type:"mysql"},columns:i((()=>{switch(x.list.params.type){case"mysql":return[{prop:"name",label:"数据库名"},{prop:"user",label:"用户名"},{prop:"password",label:"密码"},{prop:"capacity",label:"容量",placeholder:"未配置"},{prop:"p_addr",label:"数据库位置"},{prop:"action",label:"操作"}];case"redis":return[{prop:"key",label:"键"},{prop:"type",label:"类型"},{prop:"length",label:"长度"},{prop:"expiration",label:"有效期"}];default:return[]}})),getData:async()=>{x.list.loading=!0;const a="redis"===x.list.params.type?f.getRedisList:f.getDatabaseList,{data:e}=await a(x.list.params);"redis"!==x.list.params.type&&e.data.forEach(((a,e)=>x.password.show[e]=!1)),x.list.loading=!1,x.list.total=e.total,x.list.data=e["redis"===x.list.params.type?"keys":"data"]}},password:{show:{},copy:async a=>{await navigator.clipboard.writeText(a),o.success("复制成功！")}},drawer:{show:!1,title:"添加数据库",type:"add",loading:!1,open:a=>{x.drawer.type=a,x.drawer.show=!0,x.drawer.title="添加数据库"},onClose:()=>{var a,e;null==(a=x.form.instance)||a.clearValidate(),null==(e=x.form.instance)||e.resetFields(),x.drawer.show=!1},onConfirm:()=>{var a;null==(a=x.form.instance)||a.validate((async a=>{a&&(x.drawer.loading=!0,await f.addDatabaseLib(x.form.data.value),x.drawer.loading=!1,o.success("添加成功！"),x.list.getData(),x.drawer.show=!1)}))}},form:{instance:null,data:{value:{encoding:"utf8",type:"mysql"},items:i((()=>"mysql"===x.list.params.type?[{label:"数据库名",prop:"name",type:"custom",rules:[{required:!0,message:"请输入数据库名",trigger:"blur"}]},{label:"用户名",prop:"root",type:"input",rules:[{required:!0,message:"请输入用户名",trigger:"blur"}]},{label:"密码",prop:"password",type:"password",rules:[{required:!0,message:"请输入密码",trigger:"blur"}]},{label:"添加至",prop:"id",asyncOptions:async()=>{const{data:a}=await f.getConnlist(x.list.params);return x.form.data.value.id=a[0].id,a.map((a=>({label:a.remark?`${a.remark}(${a.addr})`:a.addr,value:a.id})))},type:"select",rules:[{required:!0,message:"请选择",trigger:"change"}]}]:[]))}}}),h=null==(w=d.getRouterPath().match(new RegExp("(?<=\\/database\\/)\\w*")))?void 0:w[0];return x.tabs.activeIndex=x.tabs.list.find((a=>a.value===h)).index,x.list.params.type=h,(r,l)=>{const i=c,o=s,d=t,f=y,w=a,h=e;return n(),p("div",j,[m(v,{list:x.tabs.list,"active-index":x.tabs.activeIndex,"click-active":x.tabs.clickActive},null,8,["list","active-index","click-active"]),m(i,{conf:x},null,8,["conf"]),m(h,{visible:x.drawer.show,title:x.drawer.title,loading:x.drawer.loading,"on-close":x.drawer.onClose,"on-confirm":x.drawer.onConfirm},{default:u((()=>["add"===x.drawer.type?(n(),b(w,{key:0,data:x.form.data,"on-init":a=>x.form.instance=a},{name:u((({row:a})=>[m(f,{modelValue:x.form.data.value.name,"onUpdate:modelValue":l[1]||(l[1]=a=>x.form.data.value.name=a),placeholder:a.placeholder},{append:u((()=>[m(d,{modelValue:x.form.data.value.encoding,"onUpdate:modelValue":l[0]||(l[0]=a=>x.form.data.value.encoding=a),style:{width:"120px"}},{default:u((()=>[m(o,{label:"utf8",value:"utf8"}),m(o,{label:"utf8mb4",value:"utf8mb4"}),m(o,{label:"gbk",value:"gbk"}),m(o,{label:"big5",value:"big5"})])),_:1},8,["modelValue"])])),_:2},1032,["modelValue","placeholder"])])),_:1},8,["data","on-init"])):g("",!0)])),_:1},8,["visible","title","loading","on-close","on-confirm"])])}}}),[["__scopeId","data-v-85f030db"]]);export{x as default};
