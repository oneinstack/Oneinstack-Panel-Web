import{_ as e}from"./custom-dialog-BYISrEhD.js";/* empty css             */import{E as a}from"./el-alert-G8K2VdKw.js";import{_ as t,a as o}from"./custom-form.vue_vue_type_script_setup_true_lang-C6_HscmN.js";/* empty css                 */import"./el-tag-hrDeqNMc.js";import{E as r,a as l}from"./el-select-DASP7Wfd.js";import"./el-popper-DuiXp9eT.js";import{E as i}from"./el-space-DYaOROx8.js";import{E as s}from"./el-button-CghqIf1m.js";import{S as d}from"./search-input-CXxzY4aR.js";import{d as p,x as n,c as m,a1 as u,al as c,b as g,o as w,a3 as b,X as f,i as h,Z as v,e as y,aG as _,h as j,ae as x}from"./index-BpgbG9_h.js";import{C as k}from"./card-tabs-S2z8Lr1_.js";import{_ as A}from"./custom-table.vue_vue_type_script_setup_true_lang-DrKOEP8-.js";import{A as C}from"./Api-DIELJlCh.js";import{E as D}from"./index-B5k-8-YQ.js";import"./el-dialog-DDfsOjX0.js";import"./index-E4qH6n_1.js";import"./vnode-CjD2MH5P.js";import"./index-vgTml2Xy.js";import"./scroll-BAvMHt_N.js";import"./index-Cee523Ml.js";import"./el-overlay-ghEGIsKl.js";import"./index-BLMo0UPX.js";import"./refs-D38PEvv-.js";import"./_plugin-vue_export-helper-BCo6x5W8.js";import"./el-drawer-_L3C1oIg.js";import"./el-form-item-CGp8wt0Y.js";import"./castArray-rxr1KqzA.js";import"./_Uint8Array-CjQH01s2.js";import"./_initCloneObject-Dm3var8j.js";import"./file-panel-ClhRzc_o.js";/* empty css                   */import"./el-checkbox-DBaZw9db.js";import"./isEqual-DSpmu0jQ.js";import"./index-DZi90au_.js";/* empty css                          */import"./el-pagination-jkW4z2yl.js";import"./el-table-column-CmDaQHVS.js";import"./el-tooltip-l0sNRNKZ.js";const z={class:"website-container"},V={class:"tool-bar"},Z={class:"demo-form-inline"},$={class:"box2"},U=p({__name:"index",setup(p){const U=n({tabs:{activeIndex:0,list:[{name:"PHP项目",index:0,value:"php"},{name:"反向代理",index:5,value:"proxy"},{name:"HTML项目",index:6,value:"static"}],clickActive:e=>{U.tabs.activeIndex=e.index,U.website.params.type=e.value,U.website.getData()}},website:{data:[],total:0,columns:[{prop:"name",label:"网站名",width:200},{prop:"domain",label:"域名",width:200},{prop:"root_dir",label:"根目录"},{prop:"remark",label:"备注",width:200},{prop:"action",label:"操作"}],params:{type:"php",page:1,pageSize:10},loading:!0,getData:async()=>{U.website.loading=!0;const{data:e}=await C.getWebsiteList(U.website.params);U.website.loading=!1,U.website.total=e.total,U.website.data=e.data},handleAdd:()=>{U.drawer.open("add"),U.form.data.value.type=U.website.params.type}},drawer:{show:!1,title:"创建网站",type:"add",loading:!1,open:(e,a)=>{var t;if(U.drawer.title="创建网站",U.drawer.type=e,"edit"===e){U.drawer.title="设置网站";const e=structuredClone(c(a)),o=null==(t=e.domain)?void 0:t.split(",");U.form.data.value=e,U.form.data.value.hostDomain=o[0].trim(),o.shift(),U.form.data.value.otherDomain=o.join("\n")}U.drawer.show=!0},onConfirm:()=>{var e;null==(e=U.form.instance)||e.validate((async e=>{var a;if(!e)return;let t="";t=U.form.data.value.otherDomain?null==(a=U.form.data.value.otherDomain)?void 0:a.split("\n"):"",U.form.data.value.domain=""!=t?`${U.form.data.value.hostDomain.trim()},${t}`:U.form.data.value.hostDomain;try{U.drawer.loading=!0;const e="add"===U.drawer.type?C.addWebsite:C.updateWebsite,{data:a}=await e(U.form.data.value);u({type:"success",message:"add"===U.drawer.type?"创建网站成功":"更新网站成功"}),U.drawer.show=!1,U.website.getData()}catch(o){u({type:"error",message:o.message||"操作失败"})}finally{U.drawer.loading=!1}}))},onClose:()=>{var e,a;U.form.data.value={},null==(e=U.form.instance)||e.resetFields(),null==(a=U.form.instance)||a.clearValidate(),U.drawer.show=!1}},form:{instance:null,data:{value:{},items:m((()=>{switch(U.website.params.type){case"php":case"static":return[{label:"主域名",type:"input",placeholder:"支持域名:端口",prop:"hostDomain",rules:[{required:!0,message:"请输入主域名",trigger:"blur"},{pattern:/^(([a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}|((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))(:\d{1,5})?$/,message:"域名格式错误",trigger:"blur"}],change:e=>{if(e&&!U.form.data.value.root_dir&&/^(([a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}|((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))(:\d{1,5})?$/.test(e)){const a=e.split(":")[0];U.form.data.value.root_dir=`${a}`}}},{label:"其他域名",type:"textarea",placeholder:'一行一个域名，支持*和IP地址，支持"域名:端口"',prop:"otherDomain"},{label:"根目录",type:"input",prop:"root_dir",rules:[{required:!0,message:"请选择根目录",trigger:"blur"},{pattern:/^\/(?:[^/]+\/)*[^/]+$/,message:"路径格式错误"}]},{label:"备注",type:"textarea",prop:"remark"}];case"proxy":return U.form.data.value.pact="http",U.form.data.value.tar_url="$http_host",[{label:"主域名",type:"input",placeholder:"支持域名:端口",prop:"hostDomain",rules:[{required:!0,message:"请输入主域名",trigger:"blur"},{pattern:/^([0-9a-zA-Z-]{1,}\.)+([a-zA-Z]{2,})$/,message:"域名格式错误",trigger:"blur"}]},{label:"其他域名",type:"textarea",placeholder:'一行一个域名，支持*和IP地址，支持"域名:端口"',prop:"otherDomain"},{label:"代理地址",type:"custom",placeholder:"例：127.0.0.1:8080",prop:"send_url",rules:[{required:!0,message:"请输入代理地址",trigger:"blur"}]},{label:"备注",type:"textarea",prop:"remark"}];default:return[]}}))}},dialog:{show:!1,title:"网站删除确认",type:"delete",row:{},open:(e,a)=>{if(U.dialog.type=e,U.dialog.row=a,"delete"===e)U.dialog.title="网站删除确认";U.dialog.show=!0},close:()=>{U.dialog.show=!1},confirm:async()=>{await C.delWebsite({id:U.dialog.row.id}),U.website.getData(),U.dialog.show=!1}}});return U.website.getData(),(p,n)=>{const m=s,u=i,c=l,C=r,q=D,E=t,I=o,P=a,W=e;return w(),g("div",z,[b(k,{list:U.tabs.list,"active-index":U.tabs.activeIndex,"click-active":U.tabs.clickActive},null,8,["list","active-index","click-active"]),f("div",V,[b(u,{class:"btn-group",size:14,style:{width:"100%"}},{default:h((()=>[b(m,{type:"primary",onClick:U.website.handleAdd},{default:h((()=>n[7]||(n[7]=[v("添加站点")]))),_:1},8,["onClick"])])),_:1}),f("div",Z,[b(u,{class:"btn-group",size:14},{default:h((()=>[b(d,{modelValue:U.website.params.name,"onUpdate:modelValue":n[0]||(n[0]=e=>U.website.params.name=e),placeholder:"请输入域名",style:{"margin-right":"18px"},onSearch:n[1]||(n[1]=e=>U.website.getData())},null,8,["modelValue"]),b(m,{icon:y(_),type:"primary",onClick:n[2]||(n[2]=e=>U.website.getData())},null,8,["icon"])])),_:1})])]),f("div",$,[b(A,{page:U.website.params.page,"onUpdate:page":[n[3]||(n[3]=e=>U.website.params.page=e),U.website.getData],loading:U.website.loading,"empty-text":"暂无数据",data:U.website.data,columns:U.website.columns,"auto-pagination":!1,total:U.website.total,"page-size":U.website.params.pageSize},{action:h((({row:e})=>[b(m,{type:"primary",link:"",onClick:a=>U.drawer.open("edit",e)},{default:h((()=>n[8]||(n[8]=[v("设置")]))),_:2},1032,["onClick"]),b(m,{type:"danger",link:"",onClick:a=>U.dialog.open("delete",e)},{default:h((()=>n[9]||(n[9]=[v("删除")]))),_:2},1032,["onClick"])])),_:1},8,["page","loading","data","columns","total","page-size","onUpdate:page"])]),b(I,{visible:U.drawer.show,title:U.drawer.title,"empty-text":"暂无数据",loading:U.drawer.loading,"on-close":U.drawer.onClose,"on-confirm":U.drawer.onConfirm},{default:h((()=>[U.drawer.show?(w(),j(E,{key:0,data:U.form.data,"on-init":e=>U.form.instance=e},{send_url:h((({row:e})=>[b(q,{modelValue:U.form.data.value.send_url,"onUpdate:modelValue":n[5]||(n[5]=e=>U.form.data.value.send_url=e),placeholder:e.placeholder},{prepend:h((()=>[b(C,{modelValue:U.form.data.value.pact,"onUpdate:modelValue":n[4]||(n[4]=e=>U.form.data.value.pact=e),style:{width:"80px"}},{default:h((()=>[b(c,{label:"http",value:"http://"}),b(c,{label:"https",value:"https://"})])),_:1},8,["modelValue"])])),_:2},1032,["modelValue","placeholder"])])),_:1},8,["data","on-init"])):x("",!0)])),_:1},8,["visible","title","loading","on-close","on-confirm"]),b(W,{modelValue:U.dialog.show,"onUpdate:modelValue":n[6]||(n[6]=e=>U.dialog.show=e),title:U.dialog.title},{footer:h((()=>[b(m,{onClick:U.dialog.close},{default:h((()=>n[10]||(n[10]=[v("取消")]))),_:1},8,["onClick"]),b(m,{type:"primary",onClick:U.dialog.confirm},{default:h((()=>n[11]||(n[11]=[v("确认")]))),_:1},8,["onClick"])])),default:h((()=>["delete"===U.dialog.type?(w(),j(P,{key:0,title:"确定删除所选网站？",type:"warning","show-icon":"",closable:!1})):x("",!0)])),_:1},8,["modelValue","title"])])}}});export{U as default};
