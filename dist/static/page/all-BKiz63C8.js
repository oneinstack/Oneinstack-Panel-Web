/* empty css             *//* empty css                 */import{_ as e}from"./custom-dialog-BYISrEhD.js";import{E as s}from"./el-button-CghqIf1m.js";import"./el-tag-hrDeqNMc.js";import{E as l,a as t}from"./el-select-DASP7Wfd.js";import"./el-popper-DuiXp9eT.js";/* empty css                        */import{E as o}from"./el-dropdown-BieYIwxX.js";import{_ as a}from"./empty-Ckx_bKPU.js";import{_ as i,a as n}from"./custom-form.vue_vue_type_script_setup_true_lang-C6_HscmN.js";import{A as r}from"./Api-DIELJlCh.js";import{d as u,s as m,x as c,aL as p,b as d,o as v,X as f,a3 as y,J as j,a5 as h,i as g,h as k,Z as w,ae as _,$ as b,n as C,a1 as x}from"./index-BpgbG9_h.js";import{E as V}from"./index-B5k-8-YQ.js";import{_ as I}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./el-dialog-DDfsOjX0.js";import"./index-E4qH6n_1.js";import"./vnode-CjD2MH5P.js";import"./index-vgTml2Xy.js";import"./scroll-BAvMHt_N.js";import"./index-Cee523Ml.js";import"./el-overlay-ghEGIsKl.js";import"./index-BLMo0UPX.js";import"./refs-D38PEvv-.js";import"./_Uint8Array-CjQH01s2.js";import"./isEqual-DSpmu0jQ.js";import"./castArray-rxr1KqzA.js";import"./el-drawer-_L3C1oIg.js";import"./el-form-item-CGp8wt0Y.js";import"./_initCloneObject-Dm3var8j.js";import"./file-panel-ClhRzc_o.js";/* empty css                   */import"./el-checkbox-DBaZw9db.js";import"./index-DZi90au_.js";/* empty css                          */const S={class:"list"},E={class:"item"},N={style:{padding:"28px 26px"}},O={class:"sundry"},U={class:"icon"},A=["src"],J={class:"content"},q={class:"menuTitle"},$={key:0,class:"remark"},L=["onClick"],T={class:"tip"},X={class:"below"},Z={class:"flex items-center",style:{color:"var(--font-color-gray-light)"}},F=["onClick"],Q={key:1,class:"no-data"},R={class:"version-select-container"},W=I(u({__name:"all",props:{list:{default:()=>[]}},emits:["refresh"],setup(u,{emit:I}){const W=I,Y=m(null),z=c({show:!1,title:"安装",onClose:()=>{var e,s;null==(e=Y.value)||e.clearValidate(),null==(s=Y.value)||s.resetFields(),z.show=!1},onConfirm:()=>{var e;null==(e=Y.value)||e.validate((e=>{e&&(M(),z.show=!1)}))}}),B=c({value:{key:"",version:""},items:[]}),D=c({show:!1,currentItem:null,onClose:()=>{D.show=!1,D.currentItem=null},onConfirm:()=>{D.show=!1,G(D.currentItem)}}),G=e=>{if(""!=B.value.version&&e&&e.versions&&e.versions.includes(B.value.version)?H(B.value.version,e):H(e.versions[0],e),!e.params)return M();const s=JSON.parse(e.params);B.items=s.map((e=>({label:e.name,type:"input",prop:e.key,rules:[{required:"true"===e.required,message:`请输入${e.name}`,trigger:"blur"}]}))),z.show=!0},H=(e,s)=>{B.value.key=s.key,B.value.version=e},K=m(JSON.parse(localStorage.getItem("installedVersions")||"{}")),M=async()=>{const{data:e}=await r.installSoft(B.value);K.value[B.value.key]=B.value.version,localStorage.setItem("installedVersions",JSON.stringify(K.value)),se(e.installName)},P=c({show:!1,content:"",onClose:()=>{ee&&ee.clear(),W("refresh")}}),ee=p.Scope.Timer(),se=async e=>{P.show=!0,ee.on((async()=>{const{data:s}=await r.getInstallLog({fn:e});P.content=s.logs}),2e3,!0)};return(r,u)=>{const m=o,c=t,p=l,I=s,W=e,H=V;return v(),d("div",null,[u[10]||(u[10]=f("div",{class:"title"},"应用",-1)),f("div",S,[r.list.length?(v(!0),d(j,{key:0},h(r.list,(e=>(v(),d("div",E,[f("div",N,[f("div",O,[f("div",U,[f("img",{src:e.icon,alt:""},null,8,A)]),f("div",J,[f("div",null,[f("span",q,b(e.name),1),e.tags?(v(),d("span",$,"（"+b(e.tags)+"）",1)):_("",!0),0!==e.status?(v(),d("span",{key:1,class:C(["status ml-2",{error:3===e.status,success:2===e.status,installing:1===e.status}]),onClick:s=>se(e.log)},b(1===e.status?"安装中":2===e.status?"已安装":"安装失败"),11,L)):_("",!0)]),f("div",T,b(e.describe),1)])]),u[5]||(u[5]=f("div",{class:"xian"},null,-1)),f("div",X,[f("div",null,[y(m,{disabled:!(e.versions.length>1)},{default:g((()=>[f("span",Z,[0===e.status?(v(),d(j,{key:0},[w(" 未安装 ")],64)):(v(),d(j,{key:1},[u[4]||(u[4]=f("span",null,"已安装版本：",-1)),w(" "+b(K.value[e.key]),1)],64))])])),_:2},1032,["disabled"])]),f("div",{class:C(["btn",{installed:2===e.status||K.value[e.key],uninstall:2===e.status||K.value[e.key]}]),onClick:s=>2===e.status||K.value[e.key]?void x({type:"warning",message:"卸载功能开发中..."}):(e=>{e.versions.length>1?(D.currentItem=e,D.show=!0):G(e)})(e)},b(2===e.status||K.value[e.key]?"卸载":"安装"),11,F)])])])))),256)):(v(),d("div",Q,u[6]||(u[6]=[f("img",{src:a,alt:""},null,-1),f("span",null,"暂无应用",-1)])))]),y(n,{visible:z.show,title:z.title,"on-close":z.onClose,"on-confirm":z.onConfirm},{default:g((()=>[y(i,{data:B,"on-init":e=>Y.value=e},null,8,["data","on-init"])])),_:1},8,["visible","title","on-close","on-confirm"]),y(W,{show:D.show,"onUpdate:show":u[1]||(u[1]=e=>D.show=e),title:"版本选择","on-close":D.onClose},{footer:g((()=>[y(I,{onClick:D.onClose},{default:g((()=>u[8]||(u[8]=[w("取消")]))),_:1},8,["onClick"]),y(I,{type:"primary",onClick:D.onConfirm},{default:g((()=>u[9]||(u[9]=[w("安装")]))),_:1},8,["onClick"])])),default:g((()=>[f("div",R,[u[7]||(u[7]=f("div",{class:"version-label"},"版本",-1)),y(p,{modelValue:B.value.version,"onUpdate:modelValue":u[0]||(u[0]=e=>B.value.version=e),placeholder:"请选择版本",style:{width:"100%"},"popper-class":"version-select-dropdown"},{default:g((()=>{var e;return[(v(!0),d(j,null,h(null==(e=D.currentItem)?void 0:e.versions,(e=>(v(),k(c,{key:e,label:e,value:e},null,8,["label","value"])))),128))]})),_:1},8,["modelValue"])])])),_:1},8,["show","on-close"]),y(W,{show:P.show,"onUpdate:show":u[3]||(u[3]=e=>P.show=e),title:"安装日志","on-close":P.onClose},{default:g((()=>[y(H,{modelValue:P.content,"onUpdate:modelValue":u[2]||(u[2]=e=>P.content=e),type:"textarea",readonly:"",style:{"min-height":"200px"}},null,8,["modelValue"])])),_:1},8,["show","on-close"])])}}}),[["__scopeId","data-v-5c4600cc"]]);export{W as default};
