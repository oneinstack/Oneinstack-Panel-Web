/* empty css             */import{E as e,a}from"./el-table-column-QyJit_Aw.js";import"./el-checkbox-WLPkjpqU.js";import"./el-tooltip-l0sNRNKZ.js";import"./el-popper-ClYUeexH.js";import"./el-tag-Dxm_Axr8.js";import{E as t,a as l}from"./el-select-Bf0uoiH2.js";import{E as n}from"./el-card-BmzcsBQT.js";import{S as r}from"./search-input-Db0Tvbde.js";import{E as i}from"./el-space-DkFKfvgh.js";/* empty css                  */import{d as o,s,x as c,B as d,b as p,o as u,X as m,a3 as f,i as y,Z as g,aM as h,e as _,aG as b,a4 as k,F as v,ck as w,cl as x,$ as j,h as S,a1 as $,ac as C}from"./index-B5c3jFiu.js";import{A as T}from"./Api-99phi20S.js";import P from"./add-task-BSWTAK3E.js";import{E as z}from"./index-CY3iw2TW.js";import{E as B}from"./index-BUoe9cYv.js";import{_ as V}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./index-DwJjVrn6.js";import"./_Uint8Array-D9m7vkXT.js";import"./_initCloneObject-CUocRwYS.js";import"./isEqual-ClYigGjQ.js";import"./index-EHUqHs3S.js";import"./castArray-DrYRfuDR.js";import"./index-FXwX-Tc-.js";import"./scroll-CGLW73hp.js";/* empty css                 */import"./vnode-wHVxG6yF.js";import"./el-drawer-BeOw-O7q.js";import"./index-DguJ4OYc.js";import"./el-overlay-DfJ2upq2.js";import"./el-form-item-ey1Wr8cE.js";import"./validator-BC9Abt-3.js";import"./index-36sCsZ2B.js";function E(e){if(!e)return"";const a=e.split(","),t=[];return a.forEach((e=>{const a=e.split(" ");if(5!==a.length)return void t.push(`无效的 cron 表达式: ${e}`);const[l,n,r,i,o]=a;let s="";if("*"===i)s+="每月";else{if(!/^\d+$/.test(i))return void t.push(`无效的月份部分: ${i}`);s+=`每年 ${i} 月`}if("*"===r)"*"===o&&(s+="每日");else{if(!/^\d+$/.test(r))return void t.push(`无效的日期部分: ${r}`);s+=` ${r} 日`}if("*"!==o&&/^\d+$/.test(o)){s+=` 每周 ${["周日","周一","周二","周三","周四","周五","周六"][parseInt(o)]}`}if("*"===n&&"*"===l)s+=" 整时整分";else if("*"===n)s+=` 每分钟的第 ${l} 分`;else if("*"===l)s+=` 每小时的第 ${n} 时`;else{if(!/^\d+$/.test(n)||!/^\d+$/.test(l))return void t.push(`无效的时间部分: ${n}:${l}`);s+=` ${n}:${String(l).padStart(2,"0")}分`}t.push(s.trim())})),t.join("<br>")}const M={class:"container"},A={class:"card-box"},F={class:"",style:{display:"flex"}},U={class:"demo-form-inline flex",style:{"margin-left":"auto"}},D={class:"box2"},H={style:{display:"flex","flex-direction":"row","align-items":"center",cursor:"pointer"}},L=["onClick"],q=["onClick"],I={style:{display:"flex","flex-direction":"row","align-items":"center",cursor:"pointer"}},O=["innerHTML"],R={style:{display:"flex","flex-direction":"row","align-items":"center",cursor:"pointer"}},X={colspan:"6"},Y={class:"table-pagination"},Z=V(o({__name:"scheduled",setup(o){const V=s(),Z=s([]),G=c({currentPage:1,pageSize:10,total:0}),Q=()=>{V.value&&V.value.clearSelection()};let W=s("");const J=s([]),K=async()=>{Z.value=[];try{const{data:e}=await T.getPlanTaskList({page:G.currentPage,pageSize:G.pageSize,q:W.value});e?(J.value=e.data||[],G.total=e.total||0):$.error((null==e?void 0:e.message)||"获取数据失败")}catch(e){$.error("获取数据失败"),J.value=[],G.total=0}};s(["传统项目","swoole异步项目","thinkphp异步项目","异步项目","一键部署","批量创建"]),c({user:"",region:"",date:""});const N=()=>{G.pageSize=10,G.currentPage=1,W.value="",K()};s(),c({name:"Hello",region:"",count:"",desc:""});let ee=s(!0),ae=s({name:"",cron_type:"",schedule:"",created_at:"",deleted_at:"",id:"",command:"",enabled:!0,updated_at:""});s("");const te=e=>{if(!e)return"";const a=new Date(e);return`${a.getFullYear()}年${String(a.getMonth()+1).padStart(2,"0")}月${String(a.getDate()).padStart(2,"0")}日 ${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}:${String(a.getSeconds()).padStart(2,"0")}`},le=s(!1),ne=()=>{ee.value=!0,le.value=!0,ae.value={name:"",cron_type:"",schedule:"",created_at:"",deleted_at:"",id:"",command:"",enabled:!0,updated_at:""}},re=e=>{K()},ie=e=>{Z.value=e},oe=async()=>{0!==Z.value.length?B.confirm("确定要删除选中的任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=Z.value.map((e=>e.id));try{await T.deletePlanTask({ids:e}),$.success("删除成功"),K()}catch(a){$.error("删除失败")}})).catch((()=>{$.info("取消删除")})):$.warning("请选择要删除的任务")},se=async()=>{const e=Z.value.filter((e=>!0===e.enabled));0!==e.length?B.confirm("确定要禁止选中的任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const a=e.map((e=>e.id));try{await T.disablePlanTask({ids:a}),$.success("禁止成功"),K(),Q()}catch(t){$.error("禁止失败")}})).catch((()=>{$.info("取消禁止")})):$.warning("请选择运行中的任务进行禁止")},ce=async()=>{const e=Z.value.filter((e=>!1===e.enabled));0!==e.length?B.confirm("确定要开启选中的任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const a=e.map((e=>e.id));try{await T.enablePlanTask({ids:a}),$.success("开启成功"),K(),Q()}catch(t){$.error("开启失败")}})).catch((()=>{$.info("取消开启")})):$.warning("请选择已停用的任务进行开启")},de=async e=>{!1!==e.enabled?B.confirm("确定要禁用该任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{try{await T.disablePlanTask({ids:[e.id]}),$.success("禁用成功"),K()}catch(a){$.error("禁用失败")}})).catch((()=>{$.info("取消禁用")})):$.warning("该任务已停用，无需再次禁用")},pe=async e=>{!0!==e.enabled?B.confirm("确定要开启该任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{try{await T.enablePlanTask({ids:[e.id]}),$.success("开启成功"),K()}catch(a){$.error("开启失败")}})).catch((()=>{$.info("取消开启")})):$.warning("该任务正在运行，无需再次开启")},ue=e=>!0,me=()=>{G.currentPage>1&&(G.currentPage--,K())},fe=()=>{const e=Math.ceil(G.total/G.pageSize);G.currentPage<e&&(G.currentPage++,K())},ye=e=>{G.pageSize=e,G.currentPage=1,K()};return d((()=>{K()})),(o,s)=>{const c=z,d=i,Z=r,ge=n,he=e,_e=v,be=l,ke=t,ve=a;return u(),p("div",M,[m("div",A,[f(ge,null,{default:y((()=>[m("div",F,[f(d,{class:"btn-group"},{default:y((()=>[f(c,{type:"primary",onClick:ne},{default:y((()=>s[4]||(s[4]=[g("添加任务")]))),_:1}),f(c,{type:"primary",onClick:ce},{default:y((()=>s[5]||(s[5]=[g("启动任务")]))),_:1}),f(c,{type:"primary",onClick:se},{default:y((()=>s[6]||(s[6]=[g("停止任务")]))),_:1}),f(c,{type:"primary",onClick:oe},{default:y((()=>s[7]||(s[7]=[g("删除任务")]))),_:1})])),_:1}),m("div",U,[f(Z,{placeholder:"请输入域名或备注",style:{"margin-right":"18px"},modelValue:_(W),"onUpdate:modelValue":s[0]||(s[0]=e=>h(W)?W.value=e:W=e),onSearch:s[1]||(s[1]=e=>K())},null,8,["modelValue"]),f(c,{icon:_(b),type:"primary",onClick:N,style:{"margin-left":"auto"}},null,8,["icon"])])])])),_:1})]),m("div",D,[f(ve,{ref_key:"tableRef",ref:V,class:"fileTable",data:J.value,style:{width:"100%"},onSelectionChange:ie,"select-on-indeterminate":!1,"row-selectable":ue,"row-key":e=>e.id,"empty-text":"暂无数据"},{footer:y((()=>[m("tr",null,[m("td",X,[m("div",Y,[f(ke,{modelValue:G.pageSize,"onUpdate:modelValue":s[2]||(s[2]=e=>G.pageSize=e),onChange:ye},{default:y((()=>[f(be,{label:"10",value:"10"}),f(be,{label:"20",value:"20"}),f(be,{label:"50",value:"50"})])),_:1},8,["modelValue"]),s[17]||(s[17]=m("span",null,"条/页",-1)),f(c,{onClick:me,disabled:1===G.currentPage},{default:y((()=>s[15]||(s[15]=[g("上一页")]))),_:1},8,["disabled"]),m("span",null,j(G.currentPage)+" / "+j(Math.ceil(G.total/G.pageSize)),1),f(c,{onClick:fe,disabled:G.currentPage===Math.ceil(G.total/G.pageSize)},{default:y((()=>s[16]||(s[16]=[g("下一页")]))),_:1},8,["disabled"]),m("span",null,"共 "+j(G.total)+" 条记录",1)])])])])),default:y((()=>[f(he,{type:"selection",width:"55","reserve-selection":!0,selectable:ue,align:"center"}),f(he,{prop:"name",label:"任务名称",width:"180"}),f(he,{prop:"enabled",label:"状态",width:"180"},{default:y((e=>[m("div",H,[e.row.enabled?(u(),p("a",{key:0,style:{color:"#64ffc9","text-decoration":"underline",display:"flex"},class:"abox",onClick:a=>de(e.row)},[s[8]||(s[8]=g(" 运行中 ")),f(_e,null,{default:y((()=>[f(_(w))])),_:1})],8,L)):e.row.enabled?k("",!0):(u(),p("a",{key:1,style:{color:"#FF4848","text-decoration":"underline"},class:"abox",onClick:a=>pe(e.row)},[f(_e,null,{default:y((()=>[f(_(x))])),_:1}),s[9]||(s[9]=g(" 已停用 "))],8,q))])])),_:1}),f(he,{prop:"address",label:"执行周期"},{default:y((e=>[m("div",I,[m("span",{innerHTML:_(E)(e.row.schedule)},null,8,O)])])),_:1}),f(he,{prop:"updated_at",label:"上次执行时间"},{default:y((e=>[m("div",R,[m("span",null,j(te(e.row.updated_at)),1)])])),_:1}),f(he,{prop:"address",label:"操作",align:"center"},{default:y((e=>[e.row.enabled?k("",!0):(u(),S(c,{key:0,link:"",type:"primary",size:"small",onClick:a=>pe(e.row)},{default:y((()=>s[10]||(s[10]=[g(" 开启 ")]))),_:2},1032,["onClick"])),e.row.enabled?(u(),S(c,{key:1,link:"",type:"primary",size:"small",onClick:a=>de(e.row)},{default:y((()=>s[11]||(s[11]=[g(" 禁用 ")]))),_:2},1032,["onClick"])):k("",!0),f(c,{link:"",type:"primary",size:"small",onClick:a=>(async e=>{B.confirm("确定要删除该任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{try{await T.deletePlanTask({ids:[e.id]}),$.success("删除成功"),K(),Q()}catch(a){$.error("删除失败")}})).catch((()=>{$.info("取消删除")}))})(e.row)},{default:y((()=>s[12]||(s[12]=[g(" 删除 ")]))),_:2},1032,["onClick"]),f(c,{link:"",type:"primary",size:"small",onClick:a=>(async e=>{ee.value=!1,le.value=!0,ae.value={name:e.name,cron_type:e.cron_type,schedule:e.schedule,created_at:e.created_at,deleted_at:e.deleted_at,id:e.id,command:e.command,enabled:e.enabled,updated_at:e.updated_at}})(e.row)},{default:y((()=>s[13]||(s[13]=[g(" 更新 ")]))),_:2},1032,["onClick"]),f(c,{link:"",type:"primary",size:"small",onClick:a=>(async e=>{C.router.push("/task/log");let{data:a}=await T.getPlanTaskLog({id:e.id})})(e.row)},{default:y((()=>s[14]||(s[14]=[g(" 查看日志 ")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","row-key"])]),f(P,{modelValue:le.value,"onUpdate:modelValue":s[3]||(s[3]=e=>le.value=e),type:_(ee),onTaskAdded:re,formData:_(ae)},null,8,["modelValue","type","formData"])])}}}),[["__scopeId","data-v-90b0ec3b"]]);export{Z as default};
