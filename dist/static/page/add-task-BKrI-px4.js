/* empty css             */import{E as e}from"./el-drawer-_L3C1oIg.js";import"./el-overlay-ghEGIsKl.js";import{E as a,a as l}from"./el-form-item-CGp8wt0Y.js";import{E as t}from"./el-button-CghqIf1m.js";/* empty css                 */import"./el-tag-hrDeqNMc.js";import{E as n,a as u}from"./el-select-DASP7Wfd.js";import"./el-popper-DuiXp9eT.js";import{A as o}from"./Api-DIELJlCh.js";import{as as r,aI as s,Q as i,p as d,aO as m,_ as c,d as p,ao as y,a as v,s as f,x as h,c as b,bi as V,y as x,B as g,aV as _,b as k,o as w,H as N,ae as I,a3 as $,e as U,au as j,n as M,r as C,i as E,h as T,t as A,cj as S,F,ca as B,cd as D,aD as H,ac as O,G as K,g as q,X as z,$ as L,J as P,a5 as Y,ax as G,Z as Q,a1 as R}from"./index-BpgbG9_h.js";import{E as X,i as Z}from"./index-B5k-8-YQ.js";import{U as J,I as W,C as ee,c as ae,f as le,a as te,u as ne,d as ue,t as oe}from"./index-vgTml2Xy.js";import{_ as re}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./index-E4qH6n_1.js";import"./vnode-CjD2MH5P.js";import"./scroll-BAvMHt_N.js";import"./index-Cee523Ml.js";import"./castArray-rxr1KqzA.js";import"./_Uint8Array-CjQH01s2.js";import"./_initCloneObject-Dm3var8j.js";import"./isEqual-DSpmu0jQ.js";const se=100,ie=600,de={beforeMount(e,a){const l=a.value,{interval:t=se,delay:n=ie}=r(l)?{}:l;let u,o;const s=()=>r(l)?l():l.handler(),i=()=>{o&&(clearTimeout(o),o=void 0),u&&(clearInterval(u),u=void 0)};e.addEventListener("mousedown",(e=>{0===e.button&&(i(),s(),document.addEventListener("mouseup",(()=>i()),{once:!0}),o=setTimeout((()=>{u=setInterval((()=>{s()}),t)}),n))}))}},me=d({id:{type:String,default:void 0},step:{type:Number,default:1},stepStrictly:Boolean,max:{type:Number,default:Number.POSITIVE_INFINITY},min:{type:Number,default:Number.NEGATIVE_INFINITY},modelValue:Number,readonly:Boolean,disabled:Boolean,size:m,controls:{type:Boolean,default:!0},controlsPosition:{type:String,default:"",values:["","right"]},valueOnClear:{type:[String,Number,null],validator:e=>null===e||s(e)||["min","max"].includes(e),default:null},name:String,placeholder:String,precision:{type:Number,validator:e=>e>=0&&e===Number.parseInt(`${e}`,10)},validateEvent:{type:Boolean,default:!0},...ae(["ariaLabel"])}),ce={[ee]:(e,a)=>a!==e,blur:e=>e instanceof FocusEvent,focus:e=>e instanceof FocusEvent,[W]:e=>s(e)||i(e),[J]:e=>s(e)||i(e)},pe=p({name:"ElInputNumber"});const ye=q(c(p({...pe,props:me,emits:ce,setup(e,{expose:a,emit:l}){const t=e,{t:n}=y(),u=v("input-number"),o=f(),r=h({currentValue:t.modelValue,userInput:null}),{formItem:d}=le(),m=b((()=>s(t.modelValue)&&t.modelValue<=t.min)),c=b((()=>s(t.modelValue)&&t.modelValue>=t.max)),p=b((()=>{const e=G(t.step);return V(t.precision)?Math.max(G(t.modelValue),e):(t.precision,t.precision)})),q=b((()=>t.controls&&"right"===t.controlsPosition)),z=te(),L=ne(),P=b((()=>{if(null!==r.userInput)return r.userInput;let e=r.currentValue;if(i(e))return"";if(s(e)){if(Number.isNaN(e))return"";V(t.precision)||(e=e.toFixed(t.precision))}return e})),Y=(e,a)=>{if(V(a)&&(a=p.value),0===a)return Math.round(e);let l=String(e);const t=l.indexOf(".");if(-1===t)return e;if(!l.replace(".","").split("")[t+a])return e;const n=l.length;return"5"===l.charAt(n-1)&&(l=`${l.slice(0,Math.max(0,n-1))}6`),Number.parseFloat(Number(l).toFixed(a))},G=e=>{if(i(e))return 0;const a=e.toString(),l=a.indexOf(".");let t=0;return-1!==l&&(t=a.length-l-1),t},Q=(e,a=1)=>s(e)?Y(e+t.step*a):r.currentValue,R=()=>{if(t.readonly||L.value||c.value)return;const e=Number(P.value)||0,a=Q(e);se(a),l(W,r.currentValue),ye()},ae=()=>{if(t.readonly||L.value||m.value)return;const e=Number(P.value)||0,a=Q(e,-1);se(a),l(W,r.currentValue),ye()},re=(e,a)=>{const{max:n,min:u,step:o,precision:r,stepStrictly:s,valueOnClear:d}=t;n<u&&oe("InputNumber","min should not be greater than max.");let m=Number(e);if(i(e)||Number.isNaN(m))return null;if(""===e){if(null===d)return null;m=K(d)?{min:u,max:n}[d]:d}return s&&(m=Y(Math.round(m/o)*o,r),m!==e&&a&&l(J,m)),V(r)||(m=Y(m,r)),(m>n||m<u)&&(m=m>n?n:u,a&&l(J,m)),m},se=(e,a=!0)=>{var n;const u=r.currentValue,o=re(e);a?u===o&&e||(r.userInput=null,l(J,o),u!==o&&l(ee,o,u),t.validateEvent&&(null==(n=null==d?void 0:d.validate)||n.call(d,"change").catch((e=>ue()))),r.currentValue=o):l(J,o)},ie=e=>{r.userInput=e;const a=""===e?null:Number(e);l(W,a),se(a,!1)},me=e=>{const a=""!==e?Number(e):"";(s(a)&&!Number.isNaN(a)||""===e)&&se(a),ye(),r.userInput=null},ce=e=>{l("focus",e)},pe=e=>{var a,n;r.userInput=null,Z()&&null===r.currentValue&&(null==(a=o.value)?void 0:a.input)&&(o.value.input.value=""),l("blur",e),t.validateEvent&&(null==(n=null==d?void 0:d.validate)||n.call(d,"blur").catch((e=>ue())))},ye=()=>{r.currentValue!==t.modelValue&&(r.currentValue=t.modelValue)},ve=e=>{document.activeElement===e.target&&e.preventDefault()};return x((()=>t.modelValue),((e,a)=>{const l=re(e,!0);null===r.userInput&&l!==a&&(r.currentValue=l)}),{immediate:!0}),g((()=>{var e;const{min:a,max:n,modelValue:u}=t,i=null==(e=o.value)?void 0:e.input;if(i.setAttribute("role","spinbutton"),Number.isFinite(n)?i.setAttribute("aria-valuemax",String(n)):i.removeAttribute("aria-valuemax"),Number.isFinite(a)?i.setAttribute("aria-valuemin",String(a)):i.removeAttribute("aria-valuemin"),i.setAttribute("aria-valuenow",r.currentValue||0===r.currentValue?String(r.currentValue):""),i.setAttribute("aria-disabled",String(L.value)),!s(u)&&null!=u){let e=Number(u);Number.isNaN(e)&&(e=null),l(J,e)}i.addEventListener("wheel",ve,{passive:!1})})),_((()=>{var e,a;const l=null==(e=o.value)?void 0:e.input;null==l||l.setAttribute("aria-valuenow",`${null!=(a=r.currentValue)?a:""}`)})),a({focus:()=>{var e,a;null==(a=null==(e=o.value)?void 0:e.focus)||a.call(e)},blur:()=>{var e,a;null==(a=null==(e=o.value)?void 0:e.blur)||a.call(e)}}),(e,a)=>(w(),k("div",{class:M([U(u).b(),U(u).m(U(z)),U(u).is("disabled",U(L)),U(u).is("without-controls",!e.controls),U(u).is("controls-right",U(q))]),onDragstart:O((()=>{}),["prevent"])},[e.controls?N((w(),k("span",{key:0,role:"button","aria-label":U(n)("el.inputNumber.decrease"),class:M([U(u).e("decrease"),U(u).is("disabled",U(m))]),onKeydown:j(ae,["enter"])},[C(e.$slots,"decrease-icon",{},(()=>[$(U(F),null,{default:E((()=>[U(q)?(w(),T(U(A),{key:0})):(w(),T(U(S),{key:1}))])),_:1})]))],42,["aria-label","onKeydown"])),[[U(de),ae]]):I("v-if",!0),e.controls?N((w(),k("span",{key:1,role:"button","aria-label":U(n)("el.inputNumber.increase"),class:M([U(u).e("increase"),U(u).is("disabled",U(c))]),onKeydown:j(R,["enter"])},[C(e.$slots,"increase-icon",{},(()=>[$(U(F),null,{default:E((()=>[U(q)?(w(),T(U(B),{key:0})):(w(),T(U(D),{key:1}))])),_:1})]))],42,["aria-label","onKeydown"])),[[U(de),R]]):I("v-if",!0),$(U(X),{id:e.id,ref_key:"input",ref:o,type:"number",step:e.step,"model-value":U(P),placeholder:e.placeholder,readonly:e.readonly,disabled:U(L),size:U(z),max:e.max,min:e.min,name:e.name,"aria-label":e.ariaLabel,"validate-event":!1,onKeydown:[j(O(R,["prevent"]),["up"]),j(O(ae,["prevent"]),["down"])],onBlur:pe,onFocus:ce,onInput:ie,onChange:me},H({_:2},[e.$slots.prefix?{name:"prefix",fn:E((()=>[C(e.$slots,"prefix")]))}:void 0,e.$slots.suffix?{name:"suffix",fn:E((()=>[C(e.$slots,"suffix")]))}:void 0]),1032,["id","step","model-value","placeholder","readonly","disabled","size","max","min","name","aria-label","onKeydown"])],42,["onDragstart"]))}}),[["__file","input-number.vue"]])),ve={class:"drawer-header",style:{padding:"20px","font-size":"16px"}},fe={class:"title"},he={class:"code-editor-wrapper"},be={class:"time-input-group"},Ve={class:"time-input-group"},xe={class:"time-input-group"},ge={class:"cycle-actions"},_e={class:"cycle-actions",style:{width:"100%"}},ke={style:{flex:"auto","text-align":"right",padding:"0 20px"}},we=re(p({__name:"add-task",props:{modelValue:{type:Boolean},type:{type:Boolean},formData:{}},emits:["update:modelValue","success","taskAdded"],setup(r,{emit:s}){const i=r,d=s,m=f(null),c=f(!1),p=f("rtl"),y=f(),v=f(""),b=[{day:"一",value:1},{day:"二",value:2},{day:"三",value:3},{day:"四",value:4},{day:"五",value:5},{day:"六",value:6},{day:"日",value:7}],V=h({name:"",command:"",cycles:[{type:"day",monthTimes:[{day:1,hour:0,minute:0}],weekTimes:[{day:1,hour:0,minute:0}],dayHour:0,dayMinute:0,hourMinute:0,customCron:"",n_minute:1}]}),g=h({name:[{required:!0,message:"请输入任务名称",trigger:"blur"}],command:[{required:!0,message:"请输入脚本内容",trigger:"blur",validator:(e,a,l)=>{a?l():l(new Error("请输入脚本内容"))}}]}),_=()=>{c.value=!1,d("update:modelValue",!1)},N=async()=>{y.value&&(V.cycles&&0!==V.cycles.length?await y.value.validate((async e=>{if(e)try{const e=V.cycles.flatMap((e=>{switch(e.type){case"minute":return["* * * * *"];case"hour":return[`${e.hourMinute} * * * *`];case"day":return[`${e.dayMinute} ${e.dayHour} * * *`];case"week":return e.weekTimes.map((e=>`${e.minute} ${e.hour} * * ${e.day}`));case"month":return e.monthTimes.map((e=>`${e.minute} ${e.hour} ${e.day} * *`));case"n_minute":return[C(e.n_minute,0)];default:return[]}}));let a={name:V.name,schedule:e,command:V.command,enabled:!0};!i.type&&i.formData&&i.formData.id?a.id=i.formData.id:delete a.id;const{data:l}=await o[i.type?"addPlanTask":"updataPlanTask"](a);d("taskAdded",l),R.success(i.type?"添加成功":"修改成功"),d("success"),_()}catch(a){R.error("操作失败")}})):R.error("请设置执行周期"))};x((()=>i.modelValue),(e=>{c.value=e})),x((()=>i.formData),(e=>{if(e&&!i.type){const a=e.schedule.split(",");V.name=e.name,V.cycles=[],V.command=e.command,V.name=e.name,v.value=e.command,a.forEach((e=>{const[a,l,t,n,u]=e.split(" ");let o={customCron:e};"* * * * *"===e?o.type="minute":"*"===l&&a.startsWith("*/")?(o.type="n_minute",o.n_minute=parseInt(a.split("/")[1])):"0"===l&&"0"===a&&"*"===t&&"*"===n&&"*"===u?(o.type="day",o.dayHour=0,o.dayMinute=0):"*"===t&&"*"===n&&/^\d+$/.test(u)?(o.type="week",o.weekTimes=[{day:parseInt(u),hour:parseInt(l),minute:parseInt(a)}]):"*"===n&&/^\d+$/.test(t)?(o.type="month",o.monthTimes=[{day:parseInt(t),hour:parseInt(l),minute:parseInt(a)}]):"*"===t&&"*"===n&&"*"===u&&(o.type="day",o.dayHour=parseInt(l),o.dayMinute=parseInt(a)),V.cycles.push(o)}))}else V.name="",V.command="",v.value="",V.cycles=[{type:"day",monthTimes:[{day:1,hour:0,minute:0}],weekTimes:[{day:1,hour:0,minute:0}],dayHour:0,dayMinute:0,hourMinute:0,customCron:"",n_minute:1}]}),{immediate:!0});const j=()=>{V.cycles.push({type:"day",monthTimes:[{day:1,hour:0,minute:0}],weekTimes:[{day:1,hour:0,minute:0}],dayHour:0,dayMinute:0,hourMinute:0,customCron:"",n_minute:1})};function C(e,a){let l=e%60,t=Math.floor(e/60)+a,n=1,u=1;return t>=24&&(n+=Math.floor(t/24),t%=24),n>30&&(u+=Math.floor(n/30),n%=30,0===n&&(n=30)),u>12&&(u%=12,0===u&&(u=12)),`${l} ${t} ${n} ${u} *`}const A=e=>{const a=e.target;a&&(V.command=a.innerText)};return(o,r)=>{const s=X,i=l,d=u,f=n,h=ye,x=F,C=t,S=a,B=e;return w(),T(B,{modelValue:c.value,"onUpdate:modelValue":r[1]||(r[1]=e=>c.value=e),direction:p.value,size:"50%","before-close":_},{header:E((()=>[z("div",ve,[z("span",fe,L(o.type?"添加计划任务":"修改计划任务"),1)])])),footer:E((()=>[z("div",ke,[$(C,{onClick:_},{default:E((()=>r[11]||(r[11]=[Q("取消")]))),_:1}),$(C,{type:"primary",onClick:N},{default:E((()=>r[12]||(r[12]=[Q("确定")]))),_:1})])])),default:E((()=>[$(S,{ref_key:"ruleFormRef",ref:y,model:V,rules:g,"label-position":"top",style:{padding:"0 20px"}},{default:E((()=>[$(i,{label:"任务名称",prop:"name",required:""},{default:E((()=>[$(s,{modelValue:V.name,"onUpdate:modelValue":r[0]||(r[0]=e=>V.name=e),placeholder:"请输入任务名称"},null,8,["modelValue"])])),_:1}),$(i,{label:"脚本内容",prop:"command"},{default:E((()=>[z("div",he,[z("pre",{class:"code-editor",contenteditable:"true",spellcheck:"false",onInput:A,ref_key:"codeEditorRef",ref:m},L(v.value),545)])])),_:1}),$(i,{label:"执行周期",required:""},{default:E((()=>[(w(!0),k(P,null,Y(V.cycles,((e,a)=>(w(),k("div",{key:a,class:"cycle-row"},[$(f,{modelValue:e.type,"onUpdate:modelValue":a=>e.type=a,onChange:e=>((e,a)=>{const l=V.cycles[a];switch(e){case"minute":l.customCron="* * * * *";break;case"hour":l.customCron="0 * * * *";break;case"day":l.customCron="0 0 * * *";break;case"week":l.customCron="0 0 * * 0";break;case"month":l.customCron="0 0 1 * *";break;case"n_minute":l.customCron=`*/${l.n_minute} * * * *`}})(e,a),placeholder:"请选择执行周期",style:{width:"100px"}},{default:E((()=>[$(d,{label:"每分钟",value:"minute"}),$(d,{label:"每小时",value:"hour"}),$(d,{label:"每天",value:"day"}),$(d,{label:"每周",value:"week"}),$(d,{label:"每月",value:"month"})])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),z("div",{class:M(["cycle-inputs",e.type])},["month"===e.type?(w(!0),k(P,{key:0},Y(e.monthTimes,((e,a)=>(w(),k("div",{key:a,class:"time-row"},[z("div",be,[$(h,{"controls-position":"right",modelValue:e.day,"onUpdate:modelValue":a=>e.day=a,min:1,max:31,placeholder:"请输入",style:{width:"120px"}},{suffix:E((()=>r[2]||(r[2]=[z("span",null,"日",-1)]))),_:2},1032,["modelValue","onUpdate:modelValue"])]),z("div",Ve,[$(h,{"controls-position":"right",modelValue:e.hour,"onUpdate:modelValue":a=>e.hour=a,min:0,max:23,placeholder:"请输入",style:{width:"120px"}},{suffix:E((()=>r[3]||(r[3]=[z("span",null,"时",-1)]))),_:2},1032,["modelValue","onUpdate:modelValue"])]),z("div",xe,[$(h,{"controls-position":"right",modelValue:e.minute,"onUpdate:modelValue":a=>e.minute=a,min:0,max:59,placeholder:"请输入",style:{width:"120px"}},{suffix:E((()=>r[4]||(r[4]=[z("span",null,"分",-1)]))),_:2},1032,["modelValue","onUpdate:modelValue"])])])))),128)):I("",!0),"week"===e.type?(w(!0),k(P,{key:1},Y(e.weekTimes,((e,a)=>(w(),k("div",{key:a,class:"time-row"},[$(f,{modelValue:e.day,"onUpdate:modelValue":a=>e.day=a,placeholder:"请输入"},{default:E((()=>[(w(),k(P,null,Y(b,(e=>$(d,{key:e.value,label:`周${e.day}`,value:e.value},null,8,["label","value"]))),64))])),_:2},1032,["modelValue","onUpdate:modelValue"]),$(h,{"controls-position":"right",modelValue:e.hour,"onUpdate:modelValue":a=>e.hour=a,min:0,max:23,placeholder:"请输入",style:{width:"120px"}},{suffix:E((()=>r[5]||(r[5]=[z("span",null,"时",-1)]))),_:2},1032,["modelValue","onUpdate:modelValue"]),$(h,{"controls-position":"right",modelValue:e.minute,"onUpdate:modelValue":a=>e.minute=a,min:0,max:59,placeholder:"请输入",style:{width:"120px"}},{suffix:E((()=>r[6]||(r[6]=[z("span",null,"分",-1)]))),_:2},1032,["modelValue","onUpdate:modelValue"])])))),128)):I("",!0),"day"===e.type?(w(),k(P,{key:2},[$(h,{"controls-position":"right",modelValue:e.dayHour,"onUpdate:modelValue":a=>e.dayHour=a,min:0,max:23,placeholder:"请输入",style:{width:"120px"}},{suffix:E((()=>r[7]||(r[7]=[z("span",null,"时",-1)]))),_:2},1032,["modelValue","onUpdate:modelValue"]),$(h,{"controls-position":"right",modelValue:e.dayMinute,"onUpdate:modelValue":a=>e.dayMinute=a,min:0,max:59,placeholder:"请输入",style:{width:"120px"}},{suffix:E((()=>r[8]||(r[8]=[z("span",null,"分",-1)]))),_:2},1032,["modelValue","onUpdate:modelValue"])],64)):I("",!0),"hour"===e.type?(w(),T(h,{key:3,"controls-position":"right",modelValue:e.hourMinute,"onUpdate:modelValue":a=>e.hourMinute=a,min:0,max:59,placeholder:"请输入",style:{width:"120px"}},{suffix:E((()=>r[9]||(r[9]=[z("span",null,"分",-1)]))),_:2},1032,["modelValue","onUpdate:modelValue"])):I("",!0),"n_minute"===e.type?(w(),T(h,{key:4,"controls-position":"right",modelValue:e.n_minute,"onUpdate:modelValue":a=>e.n_minute=a,min:1,placeholder:"请输入N值",style:{width:"120px"}},null,8,["modelValue","onUpdate:modelValue"])):I("",!0)],2),z("div",ge,[V.cycles.length>1?(w(),T(C,{key:0,type:"danger",link:"",onClick:e=>(e=>{V.cycles.length>1&&V.cycles.splice(e,1)})(a)},{default:E((()=>[$(x,null,{default:E((()=>[$(U(G))])),_:1})])),_:2},1032,["onClick"])):I("",!0)])])))),128)),z("div",_e,[$(C,{type:"primary",onClick:j},{default:E((()=>[$(x,null,{default:E((()=>[$(U(D)),r[10]||(r[10]=Q("添加"))])),_:1})])),_:1})])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","direction"])}}}),[["__scopeId","data-v-4e604b90"]]);export{we as default};
