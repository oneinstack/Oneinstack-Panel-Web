/* empty css             */import{E as e,a}from"./el-table-column-DufQ25bx.js";import"./el-checkbox-DQDwETtM.js";import"./el-tooltip-l0sNRNKZ.js";import"./el-popper-CgqLQvxz.js";import{E as t,a as l}from"./el-select-Diq8nzxA.js";import{S as n}from"./search-input-ByDnE0bW.js";import{E as r}from"./el-space-D4lKLniW.js";import{E as s}from"./el-button-C6SlJWJv.js";import{p as o,R as i,_ as d,d as c,a as u,b as p,o as m,ae as f,X as y,n as g,e as h,r as b,Z as v,$ as _,f as w,g as k,s as x,x as S,B as j,a3 as $,i as C,aM as T,aG as P,F as z,ck as B,cl as M,h as V,a1 as E}from"./index-B0-DY18Y.js";import{A}from"./Api-BE344Hwh.js";import F from"./add-task-CYxZzS6l.js";import{E as U}from"./index-Bl5XbKAU.js";import{_ as D}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./el-input-CCiT4Pw-.js";import"./_Uint8Array-D0RYPAnJ.js";import"./_initCloneObject-B_s4quhu.js";import"./isEqual-C6HWhcNO.js";import"./index-DSCusJxK.js";import"./castArray-DHQk_f1a.js";import"./vnode-C-JGoUos.js";import"./el-drawer-qVVuOe4K.js";import"./index-B8-5ocmZ.js";import"./el-overlay-n5HYZiIu.js";import"./el-form-item-DBl2iH2x.js";import"./validator-CE5lR2he.js";import"./index-DxVUW8ik.js";const H=o({header:{type:String,default:""},footer:{type:String,default:""},bodyStyle:{type:i([String,Object,Array]),default:""},bodyClass:String,shadow:{type:String,values:["always","hover","never"],default:"always"}}),L=c({name:"ElCard"});const O=k(d(c({...L,props:H,setup(e){const a=u("card");return(e,t)=>(m(),p("div",{class:g([h(a).b(),h(a).is(`${e.shadow}-shadow`)])},[e.$slots.header||e.header?(m(),p("div",{key:0,class:g(h(a).e("header"))},[b(e.$slots,"header",{},(()=>[v(_(e.header),1)]))],2)):f("v-if",!0),y("div",{class:g([h(a).e("body"),e.bodyClass]),style:w(e.bodyStyle)},[b(e.$slots,"default")],6),e.$slots.footer||e.footer?(m(),p("div",{key:1,class:g(h(a).e("footer"))},[b(e.$slots,"footer",{},(()=>[v(_(e.footer),1)]))],2)):f("v-if",!0)],2))}}),[["__file","card.vue"]]));function q(e){if(!e)return"";const a=e.split(","),t=[];return a.forEach((e=>{const a=e.split(" ");if(5!==a.length)return void t.push(`无效的 cron 表达式: ${e}`);const[l,n,r,s,o]=a;let i="";if("*"===s)i+="每月";else{if(!/^\d+$/.test(s))return void t.push(`无效的月份部分: ${s}`);i+=`每年 ${s} 月`}if("*"===r)"*"===o&&(i+="每日");else{if(!/^\d+$/.test(r))return void t.push(`无效的日期部分: ${r}`);i+=` ${r} 日`}if("*"!==o&&/^\d+$/.test(o)){i+=` 每周 ${["周日","周一","周二","周三","周四","周五","周六"][parseInt(o)]}`}if("*"===n&&"*"===l)i+=" 整时整分";else if("*"===n)i+=` 每分钟的第 ${l} 分`;else if("*"===l)i+=` 每小时的第 ${n} 时`;else{if(!/^\d+$/.test(n)||!/^\d+$/.test(l))return void t.push(`无效的时间部分: ${n}:${l}`);i+=` ${n}:${String(l).padStart(2,"0")}分`}t.push(i.trim())})),t.join("<br>")}const I={class:"container"},R={class:"",style:{display:"flex"}},X={class:"demo-form-inline flex",style:{"margin-left":"auto"}},Y={class:"box2"},Z={style:{display:"flex","flex-direction":"row","align-items":"center",cursor:"pointer"}},G=["onClick"],N=["onClick"],W={style:{display:"flex","flex-direction":"row","align-items":"center",cursor:"pointer"}},J=["innerHTML"],K={style:{display:"flex","flex-direction":"row","align-items":"center",cursor:"pointer"}},Q={colspan:"6"},ee={class:"table-pagination"},ae=D(c({__name:"scheduled",setup(o){const i=x(),d=x([]),c=S({currentPage:1,pageSize:10,total:0}),u=()=>{i.value&&i.value.clearSelection()};let g=x("");const b=x([]),w=async()=>{d.value=[];try{const{data:e}=await A.getPlanTaskList({page:c.currentPage,pageSize:c.pageSize,q:g.value});e?(b.value=e.data||[],c.total=e.total||0):E.error((null==e?void 0:e.message)||"获取数据失败")}catch(e){E.error("获取数据失败"),b.value=[],c.total=0}};x(["传统项目","swoole异步项目","thinkphp异步项目","异步项目","一键部署","批量创建"]),S({user:"",region:"",date:""});const k=()=>{c.pageSize=10,c.currentPage=1,g.value="",w()};x(),S({name:"Hello",region:"",count:"",desc:""});let D=x(!0),H=x({name:"",cron_type:"",schedule:"",created_at:"",deleted_at:"",id:"",command:"",enabled:!0,updated_at:""});x("");const L=e=>{if(!e)return"";const a=new Date(e);return`${a.getFullYear()}年${String(a.getMonth()+1).padStart(2,"0")}月${String(a.getDate()).padStart(2,"0")}日 ${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}:${String(a.getSeconds()).padStart(2,"0")}`},ae=x(!1),te=()=>{D.value=!0,ae.value=!0,H.value={name:"",cron_type:"",schedule:"",created_at:"",deleted_at:"",id:"",command:"",enabled:!0,updated_at:""}},le=e=>{w()},ne=e=>{d.value=e},re=async()=>{0!==d.value.length?U.confirm("确定要删除选中的任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=d.value.map((e=>e.id));try{await A.deletePlanTask({ids:e}),E.success("删除成功"),w()}catch(a){E.error("删除失败")}})).catch((()=>{E.info("取消删除")})):E.warning("请选择要删除的任务")},se=async()=>{const e=d.value.filter((e=>!0===e.enabled));0!==e.length?U.confirm("确定要禁止选中的任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const a=e.map((e=>e.id));try{await A.disablePlanTask({ids:a}),E.success("禁止成功"),w(),u()}catch(t){E.error("禁止失败")}})).catch((()=>{E.info("取消禁止")})):E.warning("请选择运行中的任务进行禁止")},oe=async()=>{const e=d.value.filter((e=>!1===e.enabled));0!==e.length?U.confirm("确定要开启选中的任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const a=e.map((e=>e.id));try{await A.enablePlanTask({ids:a}),E.success("开启成功"),w(),u()}catch(t){E.error("开启失败")}})).catch((()=>{E.info("取消开启")})):E.warning("请选择已停用的任务进行开启")},ie=async e=>{!1!==e.enabled?U.confirm("确定要禁用该任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{try{await A.disablePlanTask({ids:[e.id]}),E.success("禁用成功"),w()}catch(a){E.error("禁用失败")}})).catch((()=>{E.info("取消禁用")})):E.warning("该任务已停用，无需再次禁用")},de=async e=>{!0!==e.enabled?U.confirm("确定要开启该任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{try{await A.enablePlanTask({ids:[e.id]}),E.success("开启成功"),w()}catch(a){E.error("开启失败")}})).catch((()=>{E.info("取消开启")})):E.warning("该任务正在运行，无需再次开启")},ce=e=>!0,ue=()=>{c.currentPage>1&&(c.currentPage--,w())},pe=()=>{const e=Math.ceil(c.total/c.pageSize);c.currentPage<e&&(c.currentPage++,w())},me=e=>{c.pageSize=e,c.currentPage=1,w()};return j((()=>{w()})),(o,d)=>{const x=s,S=r,j=n,fe=O,ye=e,ge=z,he=l,be=t,ve=a;return m(),p("div",I,[$(fe,null,{default:C((()=>[y("div",R,[$(S,{class:"btn-group"},{default:C((()=>[$(x,{type:"primary",onClick:te},{default:C((()=>d[4]||(d[4]=[v("添加任务")]))),_:1}),$(x,{type:"primary",onClick:oe},{default:C((()=>d[5]||(d[5]=[v("启动任务")]))),_:1}),$(x,{type:"primary",onClick:se},{default:C((()=>d[6]||(d[6]=[v("停止任务")]))),_:1}),$(x,{type:"primary",onClick:re},{default:C((()=>d[7]||(d[7]=[v("删除任务")]))),_:1})])),_:1}),y("div",X,[$(j,{placeholder:"请输入域名或备注",style:{"margin-right":"18px"},modelValue:h(g),"onUpdate:modelValue":d[0]||(d[0]=e=>T(g)?g.value=e:g=e),onSearch:d[1]||(d[1]=e=>w())},null,8,["modelValue"]),$(x,{icon:h(P),type:"primary",onClick:k,style:{"margin-left":"auto"}},null,8,["icon"])])])])),_:1}),y("div",Y,[$(ve,{ref_key:"tableRef",ref:i,class:"fileTable",data:b.value,border:"",style:{width:"100%"},onSelectionChange:ne,"select-on-indeterminate":!1,"row-selectable":ce,"row-key":e=>e.id,"empty-text":"暂无数据"},{footer:C((()=>[y("tr",null,[y("td",Q,[y("div",ee,[$(be,{modelValue:c.pageSize,"onUpdate:modelValue":d[2]||(d[2]=e=>c.pageSize=e),onChange:me},{default:C((()=>[$(he,{label:"10",value:"10"}),$(he,{label:"20",value:"20"}),$(he,{label:"50",value:"50"})])),_:1},8,["modelValue"]),d[16]||(d[16]=y("span",null,"条/页",-1)),$(x,{onClick:ue,disabled:1===c.currentPage},{default:C((()=>d[14]||(d[14]=[v("上一页")]))),_:1},8,["disabled"]),y("span",null,_(c.currentPage)+" / "+_(Math.ceil(c.total/c.pageSize)),1),$(x,{onClick:pe,disabled:c.currentPage===Math.ceil(c.total/c.pageSize)},{default:C((()=>d[15]||(d[15]=[v("下一页")]))),_:1},8,["disabled"]),y("span",null,"共 "+_(c.total)+" 条记录",1)])])])])),default:C((()=>[$(ye,{type:"selection",width:"55","reserve-selection":!0,selectable:ce}),$(ye,{prop:"name",label:"任务名称",width:"180"}),$(ye,{prop:"enabled",label:"状态",width:"180"},{default:C((e=>[y("div",Z,[e.row.enabled?(m(),p("a",{key:0,style:{color:"#64ffc9","text-decoration":"underline",display:"flex"},class:"abox",onClick:a=>ie(e.row)},[d[8]||(d[8]=v(" 运行中 ")),$(ge,null,{default:C((()=>[$(h(B))])),_:1})],8,G)):e.row.enabled?f("",!0):(m(),p("a",{key:1,style:{color:"#FF4848","text-decoration":"underline"},class:"abox",onClick:a=>de(e.row)},[$(ge,null,{default:C((()=>[$(h(M))])),_:1}),d[9]||(d[9]=v(" 已停用 "))],8,N))])])),_:1}),$(ye,{prop:"address",label:"执行周期"},{default:C((e=>[y("div",W,[y("span",{innerHTML:h(q)(e.row.schedule)},null,8,J)])])),_:1}),$(ye,{prop:"updated_at",label:"上次执行时间"},{default:C((e=>[y("div",K,[y("span",null,_(L(e.row.updated_at)),1)])])),_:1}),$(ye,{prop:"address",label:"操作"},{default:C((e=>[e.row.enabled?f("",!0):(m(),V(x,{key:0,link:"",type:"primary",size:"small",onClick:a=>de(e.row)},{default:C((()=>d[10]||(d[10]=[v(" 开启 ")]))),_:2},1032,["onClick"])),e.row.enabled?(m(),V(x,{key:1,link:"",type:"primary",size:"small",onClick:a=>ie(e.row)},{default:C((()=>d[11]||(d[11]=[v(" 禁用 ")]))),_:2},1032,["onClick"])):f("",!0),$(x,{link:"",type:"primary",size:"small",onClick:a=>(async e=>{U.confirm("确定要删除该任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{try{await A.deletePlanTask({ids:[e.id]}),E.success("删除成功"),w(),u()}catch(a){E.error("删除失败")}})).catch((()=>{E.info("取消删除")}))})(e.row)},{default:C((()=>d[12]||(d[12]=[v(" 删除 ")]))),_:2},1032,["onClick"]),$(x,{link:"",type:"primary",size:"small",onClick:a=>(async e=>{D.value=!1,ae.value=!0,H.value={name:e.name,cron_type:e.cron_type,schedule:e.schedule,created_at:e.created_at,deleted_at:e.deleted_at,id:e.id,command:e.command,enabled:e.enabled,updated_at:e.updated_at}})(e.row)},{default:C((()=>d[13]||(d[13]=[v(" 更新 ")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","row-key"])]),$(F,{modelValue:ae.value,"onUpdate:modelValue":d[3]||(d[3]=e=>ae.value=e),type:h(D),onTaskAdded:le,formData:h(H)},null,8,["modelValue","type","formData"])])}}}),[["__scopeId","data-v-8d3b94e0"]]);export{ae as default};
