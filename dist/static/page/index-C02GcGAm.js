import{_ as e}from"./custom-dialog-C2QYRSKW.js";/* empty css             */import{E as a}from"./el-alert-PDfJOwOE.js";import{_ as t,a as i}from"./custom-form.vue_vue_type_script_setup_true_lang-BlN96ovS.js";/* empty css                 */import"./el-tag-Dxm_Axr8.js";import{E as l,a as r}from"./el-select-Bf0uoiH2.js";import"./el-popper-ClYUeexH.js";import{E as o}from"./el-space-DkFKfvgh.js";/* empty css                  */import{S as s}from"./search-input-Db0Tvbde.js";import{d as n,x as p,c as d,a1 as m,am as c,B as u,b as g,o as b,a3 as w,X as h,a4 as f,n as y,i as v,Z as x,e as j,aG as _,F as k,cm as C,h as D}from"./index-B5c3jFiu.js";import{C as I}from"./card-tabs-DNT8iyWf.js";import{C as A}from"./custom-table-M46h8iS8.js";import V from"./install-dialog-BEuCmNDh.js";import{A as z}from"./Api-99phi20S.js";import{d as F}from"./dayjs.min-JXL4yncH.js";import{E as S}from"./index-CY3iw2TW.js";import{E as U}from"./index-FXwX-Tc-.js";import{_ as W}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./el-dialog-C9RVZp-L.js";import"./index-DguJ4OYc.js";import"./vnode-wHVxG6yF.js";import"./index-DwJjVrn6.js";import"./scroll-CGLW73hp.js";import"./index-EHUqHs3S.js";import"./el-overlay-DfJ2upq2.js";import"./index-36sCsZ2B.js";import"./el-drawer-BeOw-O7q.js";import"./el-form-item-ey1Wr8cE.js";import"./castArray-DrYRfuDR.js";import"./_Uint8Array-D9m7vkXT.js";import"./_initCloneObject-CUocRwYS.js";import"./file-panel-w5NTE3Ff.js";/* empty css                   */import"./el-checkbox-WLPkjpqU.js";import"./isEqual-ClYigGjQ.js";import"./index-Ca4LNgmQ.js";/* empty css                          */import"./el-pagination-DKmoe1tS.js";import"./el-table-column-QyJit_Aw.js";import"./el-tooltip-l0sNRNKZ.js";import"./el-radio-D8A1MTN9.js";const Z={class:"website-container"},E={class:"main-content"},P={class:"tool-bar"},Y={class:"demo-form-inline"},q={class:"box2"},H={key:0,class:"mask-tip"},$=W(n({__name:"index",setup(n){const W=p({tabs:{activeIndex:0,list:[{name:"PHP项目",index:0,value:"php"},{name:"反向代理",index:5,value:"proxy"}],clickActive:e=>{W.tabs.activeIndex=e.index,W.website.params.type=e.value,W.website.getData()}},website:{data:[],total:0,selection:[],columns:[{prop:"name",label:"网站名",width:200},{prop:"domain",label:"其他域名",width:250},{prop:"dir",label:"目录",width:200},{prop:"type",label:"类型",width:200},{prop:"remark",label:"备注"},{prop:"create_time",label:"创建时间",width:200,formatter:e=>e.create_time?F(e.create_time).format("YYYY-MM-DD HH:mm:ss"):"-"},{prop:"action",label:"操作",align:"center",width:240,fixed:"right"}],handleSelectionChange:e=>{W.website.selection=e},params:{type:"php",page:1,pageSize:10},loading:!0,getData:async()=>{W.website.loading=!0;const{data:e}=await z.getWebsiteList(W.website.params);W.website.loading=!1,W.website.total=e.total,W.website.data=e.data},handleAdd:()=>{W.drawer.open("add"),W.form.data.value.type=W.website.params.type},websiteInfo:!1,getWebsiteInfo:async()=>{try{const{data:e}=await z.getWebsiteInfo();return e||!1===e?(W.website.websiteInfo=e,e):(W.website.websiteInfo=!1,!1)}catch(e){return W.website.websiteInfo=!1,m.error("获取网站信息失败"),!1}}},drawer:{show:!1,title:"创建网站",type:"add",loading:!1,open:(e,a)=>{var t;if(W.drawer.title="创建网站",W.drawer.type=e,"edit"===e){W.drawer.title="设置网站";const e=structuredClone(c(a)),i=null==(t=e.domain)?void 0:t.split(",");W.form.data.value=e,W.form.data.value.hostDomain=i[0].trim(),i.shift(),W.form.data.value.otherDomain=i.join("\n")}W.drawer.show=!0},onConfirm:()=>{var e;null==(e=W.form.instance)||e.validate((async e=>{if(e)try{W.drawer.loading=!0;const e="add"===W.drawer.type?z.addWebsite:z.updateWebsite,{data:a}=await e(W.form.data.value);m({type:"success",message:"add"===W.drawer.type?"创建网站成功":"更新网站成功"}),W.drawer.show=!1,W.website.getData()}catch(a){}finally{W.drawer.loading=!1}}))},onClose:()=>{var e,a;W.form.data.value={},null==(e=W.form.instance)||e.resetFields(),null==(a=W.form.instance)||a.clearValidate(),W.drawer.show=!1}},form:{instance:null,data:{value:{},items:d((()=>{switch(W.website.params.type){case"php":case"static":return[{label:"主域名",type:"input",placeholder:"支持域名:端口",prop:"name",rules:[{required:!0,message:"请输入主域名",trigger:"blur"},{pattern:/^(([a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}|((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))(:\d{1,5})?$/,message:"域名格式错误",trigger:"blur"}],change:e=>{if(!e)return;const a=e.split(":")[0];W.form.data.value.dir=`/${a}`}},{label:"其他域名",type:"textarea",placeholder:'一行一个域名，支持*和IP地址，支持"域名:端口"',prop:"domain"},{label:"目录",type:"input",prop:"dir",rules:[{required:!0,message:"请选择根目录",trigger:"blur"}]},{label:"备注",type:"textarea",prop:"remark"}];case"proxy":return W.form.data.value.pact="http",W.form.data.value.tar_url="$http_host",[{label:"主域名",type:"input",placeholder:"支持域名:端口",prop:"name",rules:[{required:!0,message:"请输入主域名",trigger:"blur"},{pattern:/^([0-9a-zA-Z-]{1,}\.)+([a-zA-Z]{2,})$/,message:"域名格式错误",trigger:"blur"}]},{label:"其他域名",type:"textarea",placeholder:'一行一个域名，支持*和IP地址，支持"域名:端口"',prop:"domain"},{label:"代理地址",type:"custom",placeholder:"例：127.0.0.1:8080",prop:"send_url",rules:[{required:!0,message:"请输入代理地址",trigger:"blur"}]},{label:"备注",type:"textarea",prop:"remark"}];default:return[]}}))}},dialog:{show:!1,title:"网站删除确认",type:"delete",row:{},open:(e,a)=>{if(W.dialog.type=e,W.dialog.row=a,"delete"===e)W.dialog.title="网站删除确认";W.dialog.show=!0},close:()=>{W.dialog.show=!1},confirm:async()=>{await z.delWebsite({id:W.dialog.row.id}),W.website.getData(),W.dialog.show=!1}}}),$=p({visible:!1}),M=()=>{$.visible=!0},B=()=>{W.website.websiteInfo=!0,m({type:"success",message:"安装成功"})};return u((()=>{W.website.getWebsiteInfo()})),W.website.getData(),(n,p)=>{const d=S,m=o,c=k,u=r,z=l,F=U,L=t,N=i,O=a,Q=e;return b(),g("div",Z,[w(I,{list:W.tabs.list,"active-index":W.tabs.activeIndex,"click-active":W.tabs.clickActive},null,8,["list","active-index","click-active"]),h("div",E,[h("div",{class:y({"blur-mask":!W.website.websiteInfo})},[h("div",P,[w(m,{class:"btn-group",size:14},{default:v((()=>[w(d,{type:"primary",onClick:W.website.handleAdd},{default:v((()=>p[8]||(p[8]=[x("添加站点")]))),_:1},8,["onClick"])])),_:1}),h("div",Y,[w(m,{class:"btn-group",size:14},{default:v((()=>[w(s,{modelValue:W.website.params.name,"onUpdate:modelValue":p[0]||(p[0]=e=>W.website.params.name=e),placeholder:"请输入域名",style:{"margin-right":"18px"},onSearch:p[1]||(p[1]=e=>W.website.getData())},null,8,["modelValue"]),w(d,{icon:j(_),type:"primary",onClick:p[2]||(p[2]=e=>W.website.getData())},null,8,["icon"])])),_:1})])]),h("div",q,[w(A,{page:W.website.params.page,"onUpdate:page":[p[3]||(p[3]=e=>W.website.params.page=e),W.website.getData],loading:W.website.loading,"empty-text":"暂无数据",data:W.website.data,columns:W.website.columns,"auto-pagination":!1,total:W.website.total,"page-size":W.website.params.pageSize,selection:!0,onSelectionChange:W.website.handleSelectionChange},{action:v((({row:e})=>[w(d,{type:"primary",link:"",style:{"margin-right":"8px"}},{default:v((()=>p[9]||(p[9]=[x("统计")]))),_:1}),p[13]||(p[13]=h("span",{style:{"border-right":"1px solid #D9D9D9",height:"12px","margin-right":"8px"}},null,-1)),w(d,{type:"primary",link:"",style:{"margin-right":"8px"}},{default:v((()=>p[10]||(p[10]=[x("WAF")]))),_:1}),p[14]||(p[14]=h("span",{style:{"border-right":"1px solid #D9D9D9",height:"12px","margin-right":"8px"}},null,-1)),w(d,{type:"primary",link:"",style:{"margin-right":"8px"},onClick:a=>W.drawer.open("edit",e)},{default:v((()=>p[11]||(p[11]=[x("设置")]))),_:2},1032,["onClick"]),p[15]||(p[15]=h("span",{style:{"border-right":"1px solid #D9D9D9",height:"12px","margin-right":"8px"}},null,-1)),w(d,{type:"danger",link:"",style:{color:"#FF4D4F","--el-button-hover-text-color":"#D9363E","--el-button-disabled-text-color":"#FFCCC7"},onClick:a=>W.dialog.open("delete",e)},{default:v((()=>p[12]||(p[12]=[x(" 删除 ")]))),_:2},1032,["onClick"])])),_:1},8,["page","loading","data","columns","total","page-size","onSelectionChange","onUpdate:page"])])],2)]),W.website.websiteInfo?f("",!0):(b(),g("div",H,[p[17]||(p[17]=h("img",{src:"/static/page/ins-Plugin-BHYTFVLQ.png",alt:"",class:"tip-image"},null,-1)),p[18]||(p[18]=h("div",{class:"tip-text"},[x(" 未安装运行环境，请点击下方按钮"),h("span",{class:"highlight"},"安装Nginx"),x("否则无法使用改页面 ")],-1)),w(d,{type:"primary",class:"install-btn",onClick:M},{default:v((()=>[p[16]||(p[16]=x(" 安装Nginx ")),w(c,{class:"el-icon--right"},{default:v((()=>[w(j(C))])),_:1})])),_:1})])),w(N,{visible:W.drawer.show,title:W.drawer.title,"empty-text":"暂无数据",loading:W.drawer.loading,"on-close":W.drawer.onClose,"on-confirm":W.drawer.onConfirm},{default:v((()=>[W.drawer.show?(b(),D(L,{key:0,data:W.form.data,"on-init":e=>W.form.instance=e},{send_url:v((({row:e})=>[w(F,{modelValue:W.form.data.value.send_url,"onUpdate:modelValue":p[5]||(p[5]=e=>W.form.data.value.send_url=e),placeholder:e.placeholder},{prepend:v((()=>[w(z,{modelValue:W.form.data.value.pact,"onUpdate:modelValue":p[4]||(p[4]=e=>W.form.data.value.pact=e),style:{width:"80px"}},{default:v((()=>[w(u,{label:"http",value:"http://"}),w(u,{label:"https",value:"https://"})])),_:1},8,["modelValue"])])),_:2},1032,["modelValue","placeholder"])])),_:1},8,["data","on-init"])):f("",!0)])),_:1},8,["visible","title","loading","on-close","on-confirm"]),w(Q,{modelValue:W.dialog.show,"onUpdate:modelValue":p[6]||(p[6]=e=>W.dialog.show=e),title:W.dialog.title},{footer:v((()=>[w(d,{onClick:W.dialog.close},{default:v((()=>p[19]||(p[19]=[x("取消")]))),_:1},8,["onClick"]),w(d,{type:"primary",onClick:W.dialog.confirm},{default:v((()=>p[20]||(p[20]=[x("确认")]))),_:1},8,["onClick"])])),default:v((()=>["delete"===W.dialog.type?(b(),D(O,{key:0,title:"确定删除所选网站？",type:"warning","show-icon":"",closable:!1})):f("",!0)])),_:1},8,["modelValue","title"]),w(V,{visible:$.visible,"onUpdate:visible":p[7]||(p[7]=e=>$.visible=e),onConfirm:B},null,8,["visible"])])}}}),[["__scopeId","data-v-3ecccdc3"]]);export{$ as default};
