{
  "version": 3,
  "sources": ["../../tools-websocket/dist/tools-websocket.js"],
  "sourcesContent": ["!function(){\"use strict\";function t(t,e,s,i){return new(s||(s=Promise))((function(n,o){function r(t){try{h(i.next(t))}catch(t){o(t)}}function a(t){try{h(i.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(r,a)}h((i=i.apply(t,e||[])).next())}))}var e;\"function\"==typeof SuppressedError&&SuppressedError,function(t){t[t.load=0]=\"load\",t[t.open=1]=\"open\",t[t.close=2]=\"close\"}(e||(e={}));class s{constructor(t){var e,s,i,n,o;this.failNum=0,this.timer=null,this.start=()=>{this.status&&null===this.timer&&(this.failNum=0,this.timer=setInterval((()=>{if(this.failNum>=this.heartFailNum)return this.stop(),void this.websocketbean.onerror();let t=this.heartSend;\"function\"==typeof this.heartSend&&(t=this.heartSend(this.websocketbean.param)),this.websocketbean.websocket.send(t),this.failNum++}),this.heartGapTime))},this.stop=()=>{this.status&&(clearInterval(this.timer),this.timer=null)},this.onmessage=t=>{var e,s;if(this.status)if(\"string\"==typeof this.heartGet){const i=null!==(e=this.websocketbean.param.messagePrefix)&&void 0!==e?e:\"\",n=null!==(s=this.websocketbean.param.messageSuffix)&&void 0!==s?s:\"\";t===i+this.heartGet+n&&(this.failNum=0)}else\"function\"==typeof this.heartGet&&this.heartGet(this.websocketbean.param,t)&&(this.failNum=0)},this.websocketbean=t,this.status=null!==(e=t.param.needHeart)&&void 0!==e&&e,this.heartSend=null!==(s=this.websocketbean.param.heartSend)&&void 0!==s?s:\"heartSend\",this.heartGet=null!==(i=this.websocketbean.param.heartGet)&&void 0!==i?i:\"heartGet\",this.heartGapTime=null!==(n=this.websocketbean.param.heartGapTime)&&void 0!==n?n:3e4,this.heartFailNum=null!==(o=this.websocketbean.param.heartFailNum)&&void 0!==o?o:10}}class i{constructor(t){var e,s,i;this.num=0,this.reconnectMaxNum=10,this.reconnectGapTime=3e4,this.timer=null,this.start=()=>{this.status&&null===this.timer&&(this.num=0,this.websocketbean.param.onreconnect&&this.websocketbean.param.onreconnect(),this.timer=setInterval((()=>{if(this.num>=this.reconnectMaxNum)return this.websocketbean.param.onFailReconnect&&this.websocketbean.param.onFailReconnect(),void this.stop();this.websocketbean.start(),this.num++}),this.reconnectGapTime))},this.stop=()=>{this.status&&(clearInterval(this.timer),this.timer=null)},this.websocketbean=t,this.status=null!==(e=t.param.needReconnect)&&void 0!==e&&e,this.reconnectMaxNum=null!==(s=this.websocketbean.param.reconnectMaxNum)&&void 0!==s?s:10,this.reconnectGapTime=null!==(i=this.websocketbean.param.reconnectGapTime)&&void 0!==i?i:3e4}}const n={WebSocketBean:class{constructor(n){this.status=null,this.websocket=null,this.heart=null,this.reconnect=null,this.onopen=()=>t(this,void 0,void 0,(function*(){this.reconnect.stop(),this.param.onopen&&this.param.onopen(),this.status=e.open,this.heart.start()})),this.onmessage=t=>{this.param.onmessage&&this.param.onmessage(t),this.heart.onmessage(t.data)},this.onerror=()=>{this.param.onerror&&this.param.onerror(),this.close(),\"hidden\"!=document.visibilityState?this.reconnect.start():this.hiddenReconnect=!0},this.start=t=>{this.close(),t?this.param=t:t=this.param,this.websocket=new WebSocket(t.url),t.binaryType||(t.binaryType=\"blob\"),this.websocket.binaryType=t.binaryType,this.status=e.load,this.websocket.onopen=this.onopen,this.websocket.onmessage=this.onmessage,this.websocket.onerror=this.onerror,this.websocket.onclose=this.onerror,this.heart=new s(this),null===this.reconnect&&(this.reconnect=new i(this)),window.addEventListener(\"beforeunload\",this.dispose)},this.hiddenReconnectVisibility=()=>{\"hidden\"!=document.visibilityState&&this.hiddenReconnect&&(this.hiddenReconnect=!1,this.reconnect.start())},this.hiddenReconnect=!1,this.send=e=>t(this,void 0,void 0,(function*(){const s=this.param.sendPrefix,i=this.param.sendSuffix;if(!s&&!i)return void this.websocket.send(e);const n=yield function(e){return t(this,void 0,void 0,(function*(){if(null==e)return{type:\"string\",data:e+\"\",str:e};if(\"string\"==typeof e)return{type:\"string\",data:e,str:e};if(e instanceof Blob)return new Promise(((t,s)=>{const i=new FileReader;i.onloadend=()=>t({type:\"blob\",data:e,str:i.result}),i.onerror=s,i.readAsText(e)}));if(e instanceof ArrayBuffer){const t=new TextDecoder(\"utf-8\");return{type:\"arraybuffer\",data:e,str:t.decode(new Uint8Array(e))}}if(\"object\"==typeof e||Array.isArray(e)){const t=JSON.stringify(e,((t,e)=>{if(\"function\"!=typeof e&&void 0!==e)return e}));return{type:\"object\",data:e,str:t}}throw new Error(\"Unsupported data type\")}))}(e),o=yield function(e,s,i,n){return t(this,void 0,void 0,(function*(){const t=`${i||\"\"}${e}${n||\"\"}`;return\"blob\"===s?new Blob([t],{type:\"text/plain\"}):\"arraybuffer\"===s?(new TextEncoder).encode(t).buffer:e}))}(n.str,n.type,this.param.sendPrefix,this.param.sendSuffix);this.websocket.send(o)})),this.close=()=>{null!==this.websocket&&(window.removeEventListener(\"beforeunload\",this.dispose),this.websocket&&(this.websocket.onerror=null,this.websocket.onmessage=null,this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.close(),this.websocket=null),this.heart&&(this.heart.stop(),this.heart=null),this.status=e.close)},this.dispose=()=>{this.close(),this.reconnect&&(this.reconnect.stop(),this.reconnect=null),document.removeEventListener(\"visibilitychange\",this.hiddenReconnectVisibility)},this.param=n,document.addEventListener(\"visibilitychange\",this.hiddenReconnectVisibility)}}};Object.keys(n).forEach((t=>{window[t]=n[t]}))}();\n"],
  "mappings": ";AAAA,CAAC,WAAU;AAAC;AAAa,WAAS,EAAEA,IAAEC,IAAEC,IAAEC,IAAE;AAAC,WAAO,KAAID,OAAIA,KAAE,UAAW,SAASE,IAAE,GAAE;AAAC,eAAS,EAAEJ,IAAE;AAAC,YAAG;AAAC,YAAEG,GAAE,KAAKH,EAAC,CAAC;AAAA,QAAC,SAAOA,IAAE;AAAC,YAAEA,EAAC;AAAA,QAAC;AAAA,MAAC;AAAC,eAAS,EAAEA,IAAE;AAAC,YAAG;AAAC,YAAEG,GAAE,MAAMH,EAAC,CAAC;AAAA,QAAC,SAAOA,IAAE;AAAC,YAAEA,EAAC;AAAA,QAAC;AAAA,MAAC;AAAC,eAAS,EAAEA,IAAE;AAAC,YAAIC;AAAE,QAAAD,GAAE,OAAKI,GAAEJ,GAAE,KAAK,KAAGC,KAAED,GAAE,OAAMC,cAAaC,KAAED,KAAE,IAAIC,GAAG,SAASF,IAAE;AAAC,UAAAA,GAAEC,EAAC;AAAA,QAAC,CAAE,GAAG,KAAK,GAAE,CAAC;AAAA,MAAC;AAAC,SAAGE,KAAEA,GAAE,MAAMH,IAAEC,MAAG,CAAC,CAAC,GAAG,KAAK,CAAC;AAAA,IAAC,CAAE;AAAA,EAAC;AAAC,MAAI;AAAE,gBAAY,OAAO,mBAAiB,iBAAgB,SAASD,IAAE;AAAC,IAAAA,GAAEA,GAAE,OAAK,CAAC,IAAE,QAAOA,GAAEA,GAAE,OAAK,CAAC,IAAE,QAAOA,GAAEA,GAAE,QAAM,CAAC,IAAE;AAAA,EAAO,EAAE,MAAI,IAAE,CAAC,EAAE;AAAA,EAAE,MAAM,EAAC;AAAA,IAAC,YAAYA,IAAE;AAAC,UAAIC,IAAEC,IAAEC,IAAEC,IAAE;AAAE,WAAK,UAAQ,GAAE,KAAK,QAAM,MAAK,KAAK,QAAM,MAAI;AAAC,aAAK,UAAQ,SAAO,KAAK,UAAQ,KAAK,UAAQ,GAAE,KAAK,QAAM,YAAa,MAAI;AAAC,cAAG,KAAK,WAAS,KAAK;AAAa,mBAAO,KAAK,KAAK,GAAE,KAAK,KAAK,cAAc,QAAQ;AAAE,cAAIJ,KAAE,KAAK;AAAU,wBAAY,OAAO,KAAK,cAAYA,KAAE,KAAK,UAAU,KAAK,cAAc,KAAK,IAAG,KAAK,cAAc,UAAU,KAAKA,EAAC,GAAE,KAAK;AAAA,QAAS,GAAG,KAAK,YAAY;AAAA,MAAE,GAAE,KAAK,OAAK,MAAI;AAAC,aAAK,WAAS,cAAc,KAAK,KAAK,GAAE,KAAK,QAAM;AAAA,MAAK,GAAE,KAAK,YAAU,CAAAA,OAAG;AAAC,YAAIC,IAAEC;AAAE,YAAG,KAAK;AAAO,cAAG,YAAU,OAAO,KAAK,UAAS;AAAC,kBAAMC,KAAE,UAAQF,KAAE,KAAK,cAAc,MAAM,kBAAgB,WAASA,KAAEA,KAAE,IAAGG,KAAE,UAAQF,KAAE,KAAK,cAAc,MAAM,kBAAgB,WAASA,KAAEA,KAAE;AAAG,YAAAF,OAAIG,KAAE,KAAK,WAASC,OAAI,KAAK,UAAQ;AAAA,UAAE;AAAK,0BAAY,OAAO,KAAK,YAAU,KAAK,SAAS,KAAK,cAAc,OAAMJ,EAAC,MAAI,KAAK,UAAQ;AAAA,MAAE,GAAE,KAAK,gBAAcA,IAAE,KAAK,SAAO,UAAQC,KAAED,GAAE,MAAM,cAAY,WAASC,MAAGA,IAAE,KAAK,YAAU,UAAQC,KAAE,KAAK,cAAc,MAAM,cAAY,WAASA,KAAEA,KAAE,aAAY,KAAK,WAAS,UAAQC,KAAE,KAAK,cAAc,MAAM,aAAW,WAASA,KAAEA,KAAE,YAAW,KAAK,eAAa,UAAQC,KAAE,KAAK,cAAc,MAAM,iBAAe,WAASA,KAAEA,KAAE,KAAI,KAAK,eAAa,UAAQ,IAAE,KAAK,cAAc,MAAM,iBAAe,WAAS,IAAE,IAAE;AAAA,IAAE;AAAA,EAAC;AAAA,EAAC,MAAM,EAAC;AAAA,IAAC,YAAYJ,IAAE;AAAC,UAAIC,IAAEC,IAAEC;AAAE,WAAK,MAAI,GAAE,KAAK,kBAAgB,IAAG,KAAK,mBAAiB,KAAI,KAAK,QAAM,MAAK,KAAK,QAAM,MAAI;AAAC,aAAK,UAAQ,SAAO,KAAK,UAAQ,KAAK,MAAI,GAAE,KAAK,cAAc,MAAM,eAAa,KAAK,cAAc,MAAM,YAAY,GAAE,KAAK,QAAM,YAAa,MAAI;AAAC,cAAG,KAAK,OAAK,KAAK;AAAgB,mBAAO,KAAK,cAAc,MAAM,mBAAiB,KAAK,cAAc,MAAM,gBAAgB,GAAE,KAAK,KAAK,KAAK;AAAE,eAAK,cAAc,MAAM,GAAE,KAAK;AAAA,QAAK,GAAG,KAAK,gBAAgB;AAAA,MAAE,GAAE,KAAK,OAAK,MAAI;AAAC,aAAK,WAAS,cAAc,KAAK,KAAK,GAAE,KAAK,QAAM;AAAA,MAAK,GAAE,KAAK,gBAAcH,IAAE,KAAK,SAAO,UAAQC,KAAED,GAAE,MAAM,kBAAgB,WAASC,MAAGA,IAAE,KAAK,kBAAgB,UAAQC,KAAE,KAAK,cAAc,MAAM,oBAAkB,WAASA,KAAEA,KAAE,IAAG,KAAK,mBAAiB,UAAQC,KAAE,KAAK,cAAc,MAAM,qBAAmB,WAASA,KAAEA,KAAE;AAAA,IAAG;AAAA,EAAC;AAAC,QAAM,IAAE,EAAC,eAAc,MAAK;AAAA,IAAC,YAAYC,IAAE;AAAC,WAAK,SAAO,MAAK,KAAK,YAAU,MAAK,KAAK,QAAM,MAAK,KAAK,YAAU,MAAK,KAAK,SAAO,MAAI,EAAE,MAAK,QAAO,QAAQ,aAAW;AAAC,aAAK,UAAU,KAAK,GAAE,KAAK,MAAM,UAAQ,KAAK,MAAM,OAAO,GAAE,KAAK,SAAO,EAAE,MAAK,KAAK,MAAM,MAAM;AAAA,MAAC,CAAE,GAAE,KAAK,YAAU,CAAAJ,OAAG;AAAC,aAAK,MAAM,aAAW,KAAK,MAAM,UAAUA,EAAC,GAAE,KAAK,MAAM,UAAUA,GAAE,IAAI;AAAA,MAAC,GAAE,KAAK,UAAQ,MAAI;AAAC,aAAK,MAAM,WAAS,KAAK,MAAM,QAAQ,GAAE,KAAK,MAAM,GAAE,YAAU,SAAS,kBAAgB,KAAK,UAAU,MAAM,IAAE,KAAK,kBAAgB;AAAA,MAAE,GAAE,KAAK,QAAM,CAAAA,OAAG;AAAC,aAAK,MAAM,GAAEA,KAAE,KAAK,QAAMA,KAAEA,KAAE,KAAK,OAAM,KAAK,YAAU,IAAI,UAAUA,GAAE,GAAG,GAAEA,GAAE,eAAaA,GAAE,aAAW,SAAQ,KAAK,UAAU,aAAWA,GAAE,YAAW,KAAK,SAAO,EAAE,MAAK,KAAK,UAAU,SAAO,KAAK,QAAO,KAAK,UAAU,YAAU,KAAK,WAAU,KAAK,UAAU,UAAQ,KAAK,SAAQ,KAAK,UAAU,UAAQ,KAAK,SAAQ,KAAK,QAAM,IAAI,EAAE,IAAI,GAAE,SAAO,KAAK,cAAY,KAAK,YAAU,IAAI,EAAE,IAAI,IAAG,OAAO,iBAAiB,gBAAe,KAAK,OAAO;AAAA,MAAC,GAAE,KAAK,4BAA0B,MAAI;AAAC,oBAAU,SAAS,mBAAiB,KAAK,oBAAkB,KAAK,kBAAgB,OAAG,KAAK,UAAU,MAAM;AAAA,MAAE,GAAE,KAAK,kBAAgB,OAAG,KAAK,OAAK,CAAAC,OAAG,EAAE,MAAK,QAAO,QAAQ,aAAW;AAAC,cAAMC,KAAE,KAAK,MAAM,YAAWC,KAAE,KAAK,MAAM;AAAW,YAAG,CAACD,MAAG,CAACC;AAAE,iBAAO,KAAK,KAAK,UAAU,KAAKF,EAAC;AAAE,cAAMG,KAAE,MAAM,SAASH,IAAE;AAAC,iBAAO,EAAE,MAAK,QAAO,QAAQ,aAAW;AAAC,gBAAG,QAAMA;AAAE,qBAAM,EAAC,MAAK,UAAS,MAAKA,KAAE,IAAG,KAAIA,GAAC;AAAE,gBAAG,YAAU,OAAOA;AAAE,qBAAM,EAAC,MAAK,UAAS,MAAKA,IAAE,KAAIA,GAAC;AAAE,gBAAGA,cAAa;AAAK,qBAAO,IAAI,QAAS,CAACD,IAAEE,OAAI;AAAC,sBAAMC,KAAE,IAAI;AAAW,gBAAAA,GAAE,YAAU,MAAIH,GAAE,EAAC,MAAK,QAAO,MAAKC,IAAE,KAAIE,GAAE,OAAM,CAAC,GAAEA,GAAE,UAAQD,IAAEC,GAAE,WAAWF,EAAC;AAAA,cAAC,CAAE;AAAE,gBAAGA,cAAa,aAAY;AAAC,oBAAMD,KAAE,IAAI,YAAY,OAAO;AAAE,qBAAM,EAAC,MAAK,eAAc,MAAKC,IAAE,KAAID,GAAE,OAAO,IAAI,WAAWC,EAAC,CAAC,EAAC;AAAA,YAAC;AAAC,gBAAG,YAAU,OAAOA,MAAG,MAAM,QAAQA,EAAC,GAAE;AAAC,oBAAMD,KAAE,KAAK,UAAUC,IAAG,CAACD,IAAEC,OAAI;AAAC,oBAAG,cAAY,OAAOA,MAAG,WAASA;AAAE,yBAAOA;AAAA,cAAC,CAAE;AAAE,qBAAM,EAAC,MAAK,UAAS,MAAKA,IAAE,KAAID,GAAC;AAAA,YAAC;AAAC,kBAAM,IAAI,MAAM,uBAAuB;AAAA,UAAC,CAAE;AAAA,QAAC,EAAEC,EAAC,GAAE,IAAE,MAAM,SAASA,IAAEC,IAAEC,IAAEC,IAAE;AAAC,iBAAO,EAAE,MAAK,QAAO,QAAQ,aAAW;AAAC,kBAAMJ,KAAE,GAAGG,MAAG,EAAE,GAAGF,EAAC,GAAGG,MAAG,EAAE;AAAG,mBAAM,WAASF,KAAE,IAAI,KAAK,CAACF,EAAC,GAAE,EAAC,MAAK,aAAY,CAAC,IAAE,kBAAgBE,KAAG,IAAI,cAAa,OAAOF,EAAC,EAAE,SAAOC;AAAA,UAAC,CAAE;AAAA,QAAC,EAAEG,GAAE,KAAIA,GAAE,MAAK,KAAK,MAAM,YAAW,KAAK,MAAM,UAAU;AAAE,aAAK,UAAU,KAAK,CAAC;AAAA,MAAC,CAAE,GAAE,KAAK,QAAM,MAAI;AAAC,iBAAO,KAAK,cAAY,OAAO,oBAAoB,gBAAe,KAAK,OAAO,GAAE,KAAK,cAAY,KAAK,UAAU,UAAQ,MAAK,KAAK,UAAU,YAAU,MAAK,KAAK,UAAU,UAAQ,MAAK,KAAK,UAAU,SAAO,MAAK,KAAK,UAAU,MAAM,GAAE,KAAK,YAAU,OAAM,KAAK,UAAQ,KAAK,MAAM,KAAK,GAAE,KAAK,QAAM,OAAM,KAAK,SAAO,EAAE;AAAA,MAAM,GAAE,KAAK,UAAQ,MAAI;AAAC,aAAK,MAAM,GAAE,KAAK,cAAY,KAAK,UAAU,KAAK,GAAE,KAAK,YAAU,OAAM,SAAS,oBAAoB,oBAAmB,KAAK,yBAAyB;AAAA,MAAC,GAAE,KAAK,QAAMA,IAAE,SAAS,iBAAiB,oBAAmB,KAAK,yBAAyB;AAAA,IAAC;AAAA,EAAC,EAAC;AAAE,SAAO,KAAK,CAAC,EAAE,QAAS,CAAAJ,OAAG;AAAC,WAAOA,EAAC,IAAE,EAAEA,EAAC;AAAA,EAAC,CAAE;AAAC,EAAE;",
  "names": ["t", "e", "s", "i", "n"]
}
