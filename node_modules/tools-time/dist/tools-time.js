!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).toolsTime={})}(this,(function(t){"use strict";class e{static lerp({start:t,end:e,percent:s}){return t+(e-t)*s}static lerpColor({start:t,end:e,percent:s}){const i=(t,e,s)=>{function i(t){let e=parseInt(t.slice(1),16);return[e>>16&255,e>>8&255,255&e]}function n(t,e,s){return t+(e-t)*s}let o=i(t),r=i(e),a=[Math.round(n(o[0],r[0],s)),Math.round(n(o[1],r[1],s)),Math.round(n(o[2],r[2],s))];return"#"+((1<<24)+(a[0]<<16)+(a[1]<<8)+a[2]).toString(16).slice(1).toUpperCase()};let n="";if(Array.isArray(t)){n=[];for(let o=0;o<t.length;o++)n[o]=i(t[o],e[o],s)}else n=i(t,e,s);return n}}const s={final:()=>{},updateBefore:()=>{},update:()=>{},ease:{},delay:0,duration:1e3,loop:0,time:0},i=Object.keys(s);class n{target;options;optionsSource={};percent=0;usedTime=0;paused=!0;reversed=!1;usedLoop=0;speed=1;easeMap={};constructor(t){this.target=t.target,this.setOption(t),this.setOptionSource()}setOptionSource(t=this.target){this.optionsSource={};for(const e in t)this.optionsSource[e]=t[e]||0;this.easeMap={}}setOption(t){t.time&&(t.duration=t.time),this.options=(t=>{const e=Object.keys(s);for(let i=0;i<e.length;i++){const n=e[i];t[n]||(t[n]=s[n])}return t})({...t}),this.options.ease.default||(this.options.ease.default=e.lerp),this.easeMap={}}start(){this.usedLoop=0,this.init()}init(){this.reversed=!1,this.paused=!1,this.percent=0,this.usedTime=0}update(t){if(this.paused)return;t*=this.speed,this.reversed?this.usedTime-=t:this.usedTime+=t;const e=this.options.duration+this.options.delay;this.usedTime>e?this.usedTime=e:this.usedTime<0&&(this.usedTime=0);let s=this.usedTime-this.options.delay;s<0&&(s=0),this.percent=s/this.options.duration,this.options.updateBefore(this),this.animate()}animate=()=>{if(this.render(),!(this.options.delay>0&&this.usedTime>0&&this.usedTime<=this.options.delay)&&(this.percent>=1&&!this.reversed||this.percent<=0&&this.reversed))if(this.options.loop&&this.usedLoop!=this.options.loop){this.options.loop>0&&this.usedLoop++;for(const t in this.optionsSource)this.target[t]=this.optionsSource[t];this.init()}else this.pause(),this.options.final(this,!0)};render=()=>{for(const t in this.options)if(!i.includes(t)&&(["number","string"].includes(typeof this.options[t])||Array.isArray(this.options[t])))if(this.easeMap[t])this.target[t]=this.easeMap[t][parseInt(1e4*this.percent)];else{const s={key:t,start:this.optionsSource[t]||0,end:this.options[t]||0,percent:this.percent},i=this.options.action?this.options.action(s,this):void 0;if(void 0!==i)Array.isArray(i)?(this.easeMap[t]=i,this.target[t]=this.easeMap[t][parseInt(1e4*this.percent)]):this.target[t]=i;else{let i=[];const n=String(Array.isArray(s.end)?s.end[0]:s.end).startsWith("#")?e.lerpColor:this.options.ease[t]?this.options.ease[t]:this.options.ease.default;for(let e=0;e<=1e4;e++)i.push(n({key:t,start:s.start,end:s.end,percent:e/1e4},this));this.easeMap[t]=i}}this.options.update(this)};pause(){this.paused=!0}resume(){this.paused=!1}reverse(){this.reversed=!this.reversed}seek(t,e){e||(e=t/this.options.duration),this.percent=e,this.usedTime=t,this.paused&&this.render()}progress(t){this.seek(this.options.duration*t,t)}scale(t){this.speed=t}kill(){this.pause(),this.options.final(this,!1)}}class o{static render=null;static uuid=1e3;static getId=()=>(this.uuid++,this.uuid+"");static run=()=>{this.render||(this.updateLastTime=Date.now(),this.render="undefined"!=typeof window&&(window.requestAnimationFrame&&window.requestAnimationFrame.bind(window)||window.msRequestAnimationFrame&&window.msRequestAnimationFrame.bind(window)||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame)||function(t){setTimeout(t,16)},this.update())};static stop=()=>{this.render=null,this.map={}};static updateLastTime=0;static getUpdateLastTime=()=>{const t=Date.now(),e=t-this.updateLastTime;return this.updateLastTime=t,e};static update=()=>{const t=this.getUpdateLastTime(),e=Object.keys(this.map);for(let s=0;s<e.length;s++){const i=e[s];this.map[i]?.update(t)}this.render?.(this.update)};static map={};static add=t=>{const e=this.getId();return this.map[e]=t,e};static remove=t=>{const e=this.map[t];delete this.map[t],e?.kill()}}class r{static to=t=>{if(Array.isArray(t))return void t.forEach((t=>{r.to(t)}));const e=t.final;t.final=(t,i)=>{i&&e?.(t,i),p&&s()};const s=()=>{p=null,o.remove(a),i=null};t.kill=s;let i=new n(t);i.paused=!1;const a=o.add(i);let p={bean:i,kill:s};return p};static toLine=(t,e=!1)=>{let s={},i={};const a=t.final;t.loop=0,t.final=(t,e)=>{if(e&&a?.(t,e),s?.ctx){const t=((t,e)=>{for(e||(e=t.ctx?.preTo);e?.ctx;){if(t.ctx?.bean.target.name===e.ctx.bean.target.name)return t.ctx.preTo;e=e.ctx.preTo}return null})(s);t&&s.ctx.bean.setOptionSource(t.ctx.bean.target),s.ctx.bean.paused=!1}i&&p()};const p=()=>{h&&(i?.ctx&&(i.ctx.nextTo.ctx=null),i=null,s=null,u=null,o.remove(d),h=null)};t.kill=p;let h=new n(t);h.paused=e;const d=o.add(h);let u={bean:h,nextTo:s,preTo:i,toLine:t=>(s.ctx=r.toLine(t,!0),u.toLine=s.ctx.toLine,s.ctx.preTo.ctx=u,s.ctx),killSelf:p,kill:()=>{(t=>{let e=t,s=[];for(;e.nextTo?.ctx;)s.push(e.nextTo?.ctx?.killSelf),e=e.nextTo?.ctx;let i=t;for(;i.preTo?.ctx;)s.push(i.preTo?.ctx?.killSelf),i=i.preTo?.ctx;s.forEach((t=>t())),t.killSelf()})(u)}};return u};static stop=(...t)=>{const e=Object.keys(o.map);for(let s=0;s<e.length;s++){const i=o.map[e[s]];t.includes(i.target.name)&&i.options.kill?.()}}}t.Time=r,t.TimeAction=e,t.TimeBean=n,t.TimeRender=o}));
