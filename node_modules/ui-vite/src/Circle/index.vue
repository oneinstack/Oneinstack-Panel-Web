<template>
    <div
        style="font-size: 24px; position: relative; display: inline-block"
        :style="{ width: `${width}px`, height: `${width}px` }"
    >
        <svg viewBox="0 0 100 100">
            <defs v-if="bgColors.length > 0">
                <linearGradient :id="conf.bgid" x1="100%" y1="0%" x2="0%" y2="0%">
                    <stop offset="0" :stop-color="bgColors[0]" />
                    <stop offset="100%" :stop-color="bgColors[1]" />
                </linearGradient>
            </defs>

            <defs v-if="runColors.length > 0">
                <linearGradient :id="conf.runid" x1="100%" y1="0%" x2="0%" y2="0%">
                    <stop offset="0" :stop-color="runColors[0]" />
                    <stop offset="100%" :stop-color="runColors[1]" />
                </linearGradient>
            </defs>

            <defs v-if="successColors.length > 0">
                <linearGradient :id="conf.successid" x1="100%" y1="0%" x2="0%" y2="0%">
                    <stop offset="0" :stop-color="successColors[0]" />
                    <stop offset="100%" :stop-color="successColors[1]" />
                </linearGradient>
            </defs>

            <path
                :d="`M 50,50 m -${conf.r},0 a ${conf.r},${conf.r} 0 1,0 ${conf.r * 2},0 a ${conf.r},${conf.r} 0 1,0 -${
                    conf.r * 2
                },0`"
                stroke-linecap="round"
                :stroke-width="strokeWidth"
                fill-opacity="0"
                class="v-progress-circle-run-svg"
                :style="{
                    stroke: `${bgColors.length > 0 ? 'url(#' + conf.bgid + ')' : bgColor}`,
                    strokeDasharray: `${conf.total}px, ${conf.total}px`
                }"
            />
            <path
                :d="`M 50,50 m -${conf.r},0 a ${conf.r},${conf.r} 0 1,0 ${conf.r * 2},0 a ${conf.r},${conf.r} 0 1,0 -${
                    conf.r * 2
                },0`"
                stroke-linecap="round"
                :stroke-width="strokeWidth"
                :opacity="conf.status == 0 ? 0 : 1"
                fill-opacity="0"
                class="v-progress-circle-run-svg"
                :style="{
                    stroke: `${
                        conf.status != 1
                            ? `${runColors.length > 0 ? 'url(#' + conf.runid + ')' : runColor}`
                            : `${successColors.length > 0 ? 'url(#' + conf.successid + ')' : successColor}`
                    }`,
                    strokeDasharray: `${getLength()}px, ${conf.total}px`
                }"
            />
        </svg>

        <span class="v-progress-circle-text">
            <slot name="content" :data="length">{{ length }}%</slot>
        </span>
    </div>
</template>

<script lang="ts" setup>
/**
    <v-circle
        :length="50"
        :width="100"
        runColor="#C2EDCBFF"
        successColor="#C2EDCBFF"
        bgColor="#ffffff00"
        :strokeWidth="8"
    >
        <template #content="data">
            <span style="color: #3eb958; font-family: Rajdhani; font-size: 20px">{{ data.data }}%</span>
        </template>
    </v-circle>
 */
import { computed, reactive } from 'vue'

let props = defineProps({
    /**
     * 进度，0-100
     */
    length: { default: 50 },
    /**
     * 背景色
     */
    bgColor: { default: '#f5f5f5' },
    /**
     * 背景色-渐变
     */
    bgColors: { default: [] },
    /**
     * 底色
     */
    runColor: { default: '#1890ff' },
    /**
     * 底色-渐变
     */
    runColors: { default: [] },
    /**
     * 进度色
     */
    successColor: { default: '#52c41a' },
    /**
     * 进度色-渐变
     */
    successColors: { default: [] },
    /**
     * 进度条厚度
     */
    strokeWidth: { default: 10 },
    /**
     * 进度条宽度
     */
    width: { default: 120 }
})
const conf = reactive({
    r: (100 - props.strokeWidth) / 2,
    bgid: 'svg-lg-' + StrUtil.getId(),
    runid: 'svg-lg-' + StrUtil.getId(),
    successid: 'svg-lg-' + StrUtil.getId(),
    total: 2 * Math.PI * (50 - props.strokeWidth / 2),
    length: computed(() => props.length),
    status: props.length == 0 ? 0 : props.length == 100 ? 1 : -1 //0-为空,-1-没满，1-满了
})

const getLength = () => {
    let l = conf.total * (conf.length / 100)
    if (conf.length < 100 && conf.length > 0) conf.status = -1
    setTimeout(() => {
        conf.status = conf.length == 0 ? 0 : conf.length == 100 ? 1 : -1
    }, 300)
    return l
}
</script>
