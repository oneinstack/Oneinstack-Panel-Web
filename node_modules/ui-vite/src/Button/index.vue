<template>
    <button
        :type="(htmlType as any)"
        v-if="text == null"
        @click="ok"
        :disabled="disabled === '' || disabled || conf.loading ? true : false"
        :class="[
            'v-btn',
            `v-btn-${size}`,
            long != null ? 'v-btn-long' : undefined,
            conf.loading ? 'v-btn-loading' : '',
            `v-btn-${type}`,
            ghost != null ? `v-btn-${type}-ghost` : undefined
        ]"
    >
        <div class="flex flex-center no-wrap">
            <svg
                v-if="conf.loading"
                class="icon"
                :style="{ marginRight: '5px' }"
                width="20"
                height="20"
                viewBox="0 0 1024 1024"
                xmlns="http://www.w3.org/2000/svg"
            >
                <animateTransform
                    attributeType="xml"
                    attributeName="transform"
                    type="rotate"
                    values="0;360"
                    dur="2s"
                    repeatCount="indefinite"
                />
                <path
                    fill="currentColor"
                    d="M512 64a32 32 0 0132 32v192a32 32 0 01-64 0V96a32 32 0 0132-32zm0 640a32 32 0 0132 32v192a32 32 0 11-64 0V736a32 32 0 0132-32zm448-192a32 32 0 01-32 32H736a32 32 0 110-64h192a32 32 0 0132 32zm-640 0a32 32 0 01-32 32H96a32 32 0 010-64h192a32 32 0 0132 32zM195.2 195.2a32 32 0 0145.248 0L376.32 331.008a32 32 0 01-45.248 45.248L195.2 240.448a32 32 0 010-45.248zm452.544 452.544a32 32 0 0145.248 0L828.8 783.552a32 32 0 01-45.248 45.248L647.744 692.992a32 32 0 010-45.248zM828.8 195.264a32 32 0 010 45.184L692.992 376.32a32 32 0 01-45.248-45.248l135.808-135.808a32 32 0 0145.248 0zm-452.544 452.48a32 32 0 010 45.248L240.448 828.8a32 32 0 01-45.248-45.248l135.808-135.808a32 32 0 0145.248 0z"
                />
            </svg>
            <slot>{{ type }}</slot>
        </div>
    </button>

    <div v-else-if="text != null" class="flex flex-center no-wrap">
        <div @click="ok" style="display: inline-block; padding: 2px 5px; cursor: pointer">
            <div class="flex flex-center no-wrapr">
                <slot>{{ type }}</slot>
            </div>
        </div>
    </div>
</template>

<script lang="ts" setup>
import { reactive } from 'vue'

let props = defineProps({
    /**
     * 图标的class样式
     */
    icon: { default: '' },
    /**
     * text样式
     */
    text: { default: null as any },
    /**
     * 幽灵样式
     */
    ghost: { default: null as any },
    /**
     * 样式类型
     */
    type: { default: 'primary' as 'primary' | 'success' | 'error' | 'warning' },
    /**
     * 大小
     */
    size: { default: 'middle' as 'large' | 'middle' | 'small' },
    /**
     * 铺满
     */
    long: { default: null as any },
    /**
     * 加载状态
     */
    loading: { default: null as any },
    /**
     * 点击函数
     */
    cmd: { default: null as any | Function },
    /**
     * 按钮类型
     */
    htmlType: { default: 'button' },
    /**
     * 点击状态
     */
    disabled: { default: null as any }
})

const conf = reactive({
    loading: props.loading as any,
    hover: false,
    active: false,
    type: {
        default: {
            d: { color: '#fff', bgColor: '#353D3DFF', bdColor: '#353D3DFF' },
            h: { color: '#fff', bgColor: '#4B6060FF', bdColor: '#4B6060FF' }
        },
        primary: {
            d: { color: '#fff', bgColor: '#2d8cf0', bdColor: '#2d8cf0' },
            h: { color: '#fff', bgColor: '#57a3f3', bdColor: '#57a3f3' }
        },
        success: {
            d: {
                color: 'var(--v-color-btn-font)',
                bgColor: 'var(--v-color-btn-success)',
                bdColor: 'var(--v-color-btn-success)'
            },
            h: {
                color: 'var(--v-color-btn-font)',
                bgColor: 'var(--v-color-btn-success-hover)',
                bdColor: 'var(--v-color-btn-success-hover)'
            }
        },
        error: {
            d: {
                color: 'var(--v-color-btn-font)',
                bgColor: 'var(--v-color-btn-error)',
                bdColor: 'var(--v-color-btn-error)'
            },
            h: {
                color: 'var(--v-color-btn-font)',
                bgColor: 'var(--v-color-btn-error-hover)',
                bdColor: 'var(--v-color-btn-error-hover)'
            }
        },
        warning: {
            d: { color: '#fff', bgColor: '#f90', bdColor: '#f90' },
            h: { color: '#fff', bgColor: '#ffad33', bdColor: '#ffad33' }
        },
        info: {
            d: { color: '#fff', bgColor: '#1890FFFF', bdColor: '#1890FFFF' },
            h: { color: '#fff', bgColor: '#59AFFFFF', bdColor: '#59AFFFFF' }
        }
    } as any
})

const ok = async () => {
    if (props.cmd instanceof Function) {
        if (conf.loading != null) conf.loading = true
        await props.cmd()
        if (conf.loading != null) conf.loading = false
    }
}
</script>
